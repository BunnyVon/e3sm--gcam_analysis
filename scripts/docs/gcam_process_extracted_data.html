<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GCAM Data Processing Script Documentation</title>
    <style>
/* 
 * Documentation Stylesheet for GCAM Synthetic Data Generation Script
 * A modern, colorful design with good readability
 */

/* ===== ROOT VARIABLES ===== */
:root {
    /* Color Palette */
    --primary-blue: #2563eb;
    --primary-blue-light: #3b82f6;
    --primary-blue-dark: #1e40af;
    --accent-green: #10b981;
    --accent-orange: #f59e0b;
    --accent-purple: #8b5cf6;
    --accent-red: #ef4444;
    
    /* Background Colors */
    --bg-main: #f8fafc;
    --bg-code: #1e293b;
    --bg-code-inline: #e2e8f0;
    --bg-table-header: #1e40af;
    --bg-table-row-even: #f1f5f9;
    --bg-table-row-odd: #ffffff;
    --bg-note: #fef3c7;
    --bg-warning: #fee2e2;
    --bg-info: #dbeafe;
    --bg-success: #d1fae5;
    
    /* Text Colors */
    --text-main: #1e293b;
    --text-secondary: #64748b;
    --text-code: #e2e8f0;
    --text-link: #2563eb;
    --text-link-hover: #1e40af;
    
    /* Border Colors */
    --border-light: #e2e8f0;
    --border-medium: #cbd5e1;
    --border-dark: #94a3b8;
    
    /* Spacing */
    --spacing-xs: 0.25rem;
    --spacing-sm: 0.5rem;
    --spacing-md: 1rem;
    --spacing-lg: 1.5rem;
    --spacing-xl: 2rem;
    --spacing-2xl: 3rem;
}

/* ===== BASE STYLES ===== */
* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}

body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    line-height: 1.7;
    color: var(--text-main);
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    padding: var(--spacing-xl) var(--spacing-md);
    font-size: 16px;
}

/* Main Container */
.container {
    max-width: 1200px;
    margin: 0 auto;
    background: var(--bg-main);
    padding: var(--spacing-2xl);
    border-radius: 12px;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
}

/* ===== TYPOGRAPHY ===== */
h1 {
    font-size: 2.5rem;
    color: var(--primary-blue-dark);
    margin-bottom: var(--spacing-xl);
    padding-bottom: var(--spacing-md);
    border-bottom: 4px solid var(--primary-blue);
    font-weight: 700;
    background: linear-gradient(135deg, var(--primary-blue) 0%, var(--accent-purple) 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

h2 {
    font-size: 2rem;
    color: var(--primary-blue);
    margin-top: var(--spacing-2xl);
    margin-bottom: var(--spacing-lg);
    padding-left: var(--spacing-md);
    border-left: 5px solid var(--accent-green);
    font-weight: 600;
}

h3 {
    font-size: 1.5rem;
    color: var(--primary-blue-dark);
    margin-top: var(--spacing-xl);
    margin-bottom: var(--spacing-md);
    font-weight: 600;
    display: flex;
    align-items: center;
}

h3::before {
    content: "▸";
    color: var(--accent-orange);
    margin-right: var(--spacing-sm);
    font-size: 1.2rem;
}

h4 {
    font-size: 1.25rem;
    color: var(--accent-purple);
    margin-top: var(--spacing-lg);
    margin-bottom: var(--spacing-sm);
    font-weight: 600;
}

p {
    margin-bottom: var(--spacing-md);
    color: var(--text-main);
}

/* ===== LINKS ===== */
a {
    color: var(--text-link);
    text-decoration: none;
    font-weight: 500;
    border-bottom: 2px solid transparent;
    transition: all 0.3s ease;
}

a:hover {
    color: var(--text-link-hover);
    border-bottom-color: var(--text-link-hover);
}

/* ===== LISTS ===== */
ul, ol {
    margin-left: var(--spacing-xl);
    margin-bottom: var(--spacing-md);
}

li {
    margin-bottom: var(--spacing-sm);
    padding-left: var(--spacing-sm);
}

ul li::marker {
    color: var(--accent-green);
    font-size: 1.2em;
}

ol li::marker {
    color: var(--primary-blue);
    font-weight: 600;
}

/* ===== CODE BLOCKS ===== */
code {
    font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
    font-size: 0.9em;
    padding: var(--spacing-xs) var(--spacing-sm);
    background: var(--bg-code-inline);
    color: var(--accent-red);
    border-radius: 4px;
    font-weight: 500;
}

pre {
    background: var(--bg-code);
    color: var(--text-code);
    padding: var(--spacing-lg);
    border-radius: 8px;
    overflow-x: auto;
    margin: var(--spacing-lg) 0;
    border-left: 4px solid var(--accent-green);
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

pre code {
    background: transparent;
    color: var(--text-code);
    padding: 0;
    font-size: 0.95em;
    line-height: 1.5;
}

/* ===== TABLES ===== */
table {
    width: 100%;
    border-collapse: collapse;
    margin: var(--spacing-xl) 0;
    background: white;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

thead {
    background: linear-gradient(135deg, var(--primary-blue) 0%, var(--primary-blue-dark) 100%);
    color: white;
}

th {
    padding: var(--spacing-md);
    text-align: left;
    font-weight: 600;
    font-size: 1.05em;
    border-bottom: 3px solid var(--accent-orange);
}

td {
    padding: var(--spacing-md);
    border-bottom: 1px solid var(--border-light);
}

tbody tr:nth-child(even) {
    background: var(--bg-table-row-even);
}

tbody tr:nth-child(odd) {
    background: var(--bg-table-row-odd);
}

tbody tr:hover {
    background: #e0f2fe;
    transform: scale(1.01);
    transition: all 0.2s ease;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
}

/* ===== BLOCKQUOTES ===== */
blockquote {
    margin: var(--spacing-lg) 0;
    padding: var(--spacing-md) var(--spacing-lg);
    background: var(--bg-info);
    border-left: 5px solid var(--primary-blue);
    border-radius: 0 8px 8px 0;
    font-style: italic;
    color: var(--primary-blue-dark);
}

/* ===== HORIZONTAL RULES ===== */
hr {
    border: none;
    height: 3px;
    background: linear-gradient(90deg, var(--accent-green) 0%, var(--primary-blue) 50%, var(--accent-purple) 100%);
    margin: var(--spacing-2xl) 0;
    border-radius: 2px;
}

/* ===== SPECIAL BOXES ===== */
.note {
    background: var(--bg-note);
    border-left: 5px solid var(--accent-orange);
    padding: var(--spacing-md) var(--spacing-lg);
    margin: var(--spacing-lg) 0;
    border-radius: 0 8px 8px 0;
}

.warning {
    background: var(--bg-warning);
    border-left: 5px solid var(--accent-red);
    padding: var(--spacing-md) var(--spacing-lg);
    margin: var(--spacing-lg) 0;
    border-radius: 0 8px 8px 0;
}

.info {
    background: var(--bg-info);
    border-left: 5px solid var(--primary-blue);
    padding: var(--spacing-md) var(--spacing-lg);
    margin: var(--spacing-lg) 0;
    border-radius: 0 8px 8px 0;
}

.success {
    background: var(--bg-success);
    border-left: 5px solid var(--accent-green);
    padding: var(--spacing-md) var(--spacing-lg);
    margin: var(--spacing-lg) 0;
    border-radius: 0 8px 8px 0;
}

/* ===== BADGES ===== */
.badge {
    display: inline-block;
    padding: var(--spacing-xs) var(--spacing-md);
    border-radius: 20px;
    font-size: 0.85em;
    font-weight: 600;
    margin: 0 var(--spacing-xs);
}

.badge-required {
    background: var(--accent-red);
    color: white;
}

.badge-optional {
    background: var(--accent-green);
    color: white;
}

.badge-default {
    background: var(--primary-blue);
    color: white;
}

/* ===== STRONG & EM ===== */
strong {
    color: var(--primary-blue-dark);
    font-weight: 700;
}

em {
    color: var(--accent-purple);
    font-style: italic;
}

/* ===== IMAGES ===== */
img {
    max-width: 100%;
    height: auto;
    border-radius: 8px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    margin: var(--spacing-lg) 0;
}

/* ===== SCROLLBAR STYLING ===== */
::-webkit-scrollbar {
    width: 12px;
    height: 12px;
}

::-webkit-scrollbar-track {
    background: var(--bg-table-row-even);
    border-radius: 10px;
}

::-webkit-scrollbar-thumb {
    background: linear-gradient(135deg, var(--primary-blue) 0%, var(--accent-purple) 100%);
    border-radius: 10px;
}

::-webkit-scrollbar-thumb:hover {
    background: linear-gradient(135deg, var(--primary-blue-dark) 0%, var(--accent-purple) 100%);
}

/* ===== PRINT STYLES ===== */
@media print {
    body {
        background: white;
        padding: 0;
    }
    
    .container {
        box-shadow: none;
        max-width: 100%;
    }
    
    h1, h2, h3 {
        page-break-after: avoid;
    }
    
    pre, table {
        page-break-inside: avoid;
    }
}

/* ===== RESPONSIVE DESIGN ===== */
@media (max-width: 768px) {
    body {
        padding: var(--spacing-md) var(--spacing-sm);
        font-size: 14px;
    }
    
    .container {
        padding: var(--spacing-lg);
    }
    
    h1 {
        font-size: 2rem;
    }
    
    h2 {
        font-size: 1.5rem;
    }
    
    h3 {
        font-size: 1.25rem;
    }
    
    table {
        font-size: 0.9em;
    }
    
    th, td {
        padding: var(--spacing-sm);
    }
}

/* ===== ADDITIONAL UTILITY CLASSES ===== */
.text-center {
    text-align: center;
}

.text-right {
    text-align: right;
}

.margin-top-lg {
    margin-top: var(--spacing-2xl);
}

.margin-bottom-lg {
    margin-bottom: var(--spacing-2xl);
}

.highlight {
    background: linear-gradient(120deg, #fef3c7 0%, #fde68a 100%);
    padding: 0 var(--spacing-xs);
    border-radius: 3px;
}

/* ===== SECTION DIVIDERS ===== */
.section-divider {
    display: flex;
    align-items: center;
    text-align: center;
    margin: var(--spacing-2xl) 0;
}

.section-divider::before,
.section-divider::after {
    content: '';
    flex: 1;
    border-bottom: 2px solid var(--border-medium);
}

.section-divider::before {
    margin-right: var(--spacing-md);
}

.section-divider::after {
    margin-left: var(--spacing-md);
}

/* ===== FOOTER ===== */
footer {
    margin-top: var(--spacing-2xl);
    padding-top: var(--spacing-lg);
    border-top: 2px solid var(--border-light);
    text-align: center;
    color: var(--text-secondary);
    font-size: 0.9em;
}

    </style>
</head>
<body>
    <div class="container">
<h1>GCAM Data Processing Script Documentation</h1>
<h2>Overview</h2>
<p>The <code>gcam_process_extracted_data.py</code> script is a Python tool for processing raw data extracted from GCAM (Global Change Analysis Model) project files. It transforms, cleans, aggregates, and standardizes GCAM output data, preparing it for analysis and visualization. The script is particularly useful for handling land allocation data, commodity prices, emissions data, and other GCAM outputs.</p>
<h2>Table of Contents</h2>
<ol>
<li><a href="#installation--requirements">Installation &amp; Requirements</a></li>
<li><a href="#basic-usage">Basic Usage</a></li>
<li><a href="#configuration-file-structure">Configuration File Structure</a></li>
<li><a href="#configuration-parameters">Configuration Parameters</a></li>
<li><a href="#data-processing-operations">Data Processing Operations</a></li>
<li><a href="#examples">Examples</a></li>
<li><a href="#advanced-features">Advanced Features</a></li>
<li><a href="#understanding-gcam-land-types">Understanding GCAM Land Types</a></li>
<li><a href="#troubleshooting">Troubleshooting</a></li>
</ol>
<hr />
<h2>Installation &amp; Requirements</h2>
<h3>Required Python Libraries</h3>
<div class="codehilite"><pre><span></span><code>pip<span class="w"> </span>install<span class="w"> </span>pandas<span class="w"> </span>numpy
</code></pre></div>

<h3>Required Utility Modules</h3>
<p>The script imports several utility modules that must be in the same directory or Python path:<br />
- <code>utility_dataframes</code> - Functions for reading/writing data files<br />
- <code>utility_gcam</code> - GCAM-specific functions for crop name standardization and land type grouping</p>
<hr />
<h2>Basic Usage</h2>
<h3>Command Line Execution</h3>
<div class="codehilite"><pre><span></span><code>python<span class="w"> </span>gcam_process_extracted_data.py<span class="w"> </span>path/to/config.json
</code></pre></div>

<p>You can also specify multiple JSON configuration files:</p>
<div class="codehilite"><pre><span></span><code>python<span class="w"> </span>gcam_process_extracted_data.py<span class="w"> </span>config1.json<span class="w"> </span>config2.json<span class="w"> </span>config3.json
</code></pre></div>

<p>The script will process all files in parallel using all available CPU cores for maximum efficiency.</p>
<h3>What the Script Does</h3>
<p>The script performs the following operations on each input file:</p>
<ol>
<li><strong>Reads</strong> the raw CSV data extracted from GCAM</li>
<li><strong>Drops</strong> unnecessary columns (e.g., index columns, unit columns)</li>
<li><strong>Splits</strong> composite columns into separate columns</li>
<li><strong>Sorts</strong> data by year and other key columns</li>
<li><strong>Aggregates</strong> data when multiple rows share the same keys</li>
<li><strong>Standardizes</strong> crop names to a common naming convention</li>
<li><strong>Writes</strong> the processed data to an output file</li>
</ol>
<hr />
<h2>Configuration File Structure</h2>
<p>The configuration file is a JSON array where each object specifies the processing parameters for one input file. Here's a minimal example:</p>
<div class="codehilite"><pre><span></span><code><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;input_file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;./data/land_allocation.csv&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;output_file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;./data/land_allocation_processed.csv&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;key_columns&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;scenario&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;region&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;basin&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;landtype&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;year&quot;</span><span class="p">]</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">]</span>
</code></pre></div>

<hr />
<h2>Configuration Parameters</h2>
<h3>Required Parameters</h3>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>input_file</code></td>
<td>string</td>
<td>Path to the raw CSV file extracted from GCAM</td>
</tr>
<tr>
<td><code>output_file</code></td>
<td>string</td>
<td>Path where the processed CSV file will be saved</td>
</tr>
</tbody>
</table>
<h3>Optional Parameters</h3>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>columns_to_drop</code></td>
<td>list</td>
<td><code>None</code></td>
<td>Column names to remove from the dataset</td>
</tr>
<tr>
<td><code>columns_to_split</code></td>
<td>dictionary</td>
<td><code>None</code></td>
<td>Columns to split (key: column name, value: new column names)</td>
</tr>
<tr>
<td><code>key_columns</code></td>
<td>list</td>
<td><code>None</code></td>
<td>Columns that uniquely identify rows for aggregation</td>
</tr>
<tr>
<td><code>mean_or_sum_if_more_than_one_row_in_same_landtype_group</code></td>
<td>string</td>
<td><code>None</code></td>
<td>Aggregation method: <code>"mean"</code> or <code>"sum"</code></td>
</tr>
<tr>
<td><code>call_modify_crop_names</code></td>
<td>boolean</td>
<td><code>false</code></td>
<td>Whether to modify/standardize crop names</td>
</tr>
</tbody>
</table>
<hr />
<h2>Data Processing Operations</h2>
<h3>1. Column Dropping</h3>
<p>Remove unnecessary columns that were included in the GCAM extraction but aren't needed for analysis.</p>
<p><strong>Example:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;columns_to_drop&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;Unnamed: 0&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Units&quot;</span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Common columns to drop:</strong><br />
- <code>Unnamed: 0</code> - Auto-generated index column<br />
- <code>Units</code> - Unit information (often redundant if units are consistent)</p>
<h3>2. Column Splitting</h3>
<p>Split composite columns (where multiple pieces of information are concatenated with underscores) into separate columns.</p>
<p><strong>Example:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;columns_to_split&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;landleaf&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;landtype&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;basin&quot;</span><span class="p">]</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>What this does:</strong><br />
- Takes a column like <code>landleaf</code> with values like <code>"Forest_Amazon"</code><br />
- Splits it into <code>landtype</code> = <code>"Forest"</code> and <code>basin</code> = <code>"Amazon"</code></p>
<h3>3. Column Sorting and Selection</h3>
<p>Automatically sorts data and selects relevant columns based on <code>key_columns</code>.</p>
<p><strong>Example:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;key_columns&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;scenario&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;region&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;basin&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;landtype&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;year&quot;</span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Result:</strong><br />
- Data is sorted by these columns in order<br />
- Only these columns plus <code>value</code> are retained in output</p>
<h3>4. Data Aggregation</h3>
<p>When multiple rows have the same key column values, they can be aggregated.</p>
<p><strong>Aggregation Methods:</strong></p>
<table>
<thead>
<tr>
<th>Method</th>
<th>Description</th>
<th>Use Case</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>"sum"</code></td>
<td>Add all values together</td>
<td>Land areas, total production</td>
</tr>
<tr>
<td><code>"mean"</code></td>
<td>Calculate average</td>
<td>Prices, scalars, ratios</td>
</tr>
<tr>
<td><code>None</code></td>
<td>No aggregation</td>
<td>When each row is already unique</td>
</tr>
</tbody>
</table>
<p><strong>Example:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;mean_or_sum_if_more_than_one_row_in_same_landtype_group&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sum&quot;</span>
<span class="p">}</span>
</code></pre></div>

<h3>5. Crop Name Standardization</h3>
<p>GCAM uses various crop naming conventions. This feature standardizes them to a common set.</p>
<p><strong>Example:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;call_modify_crop_names&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Crop modification/standardization examples:</strong><br />
- <code>biomass</code>, <code>biomassGrass</code>, <code>biomassTree</code> → <code>BioenergyCrop</code><br />
- <code>CornC4</code> → <code>Corn</code><br />
- <code>OilPalmTree</code> → <code>OilPalm</code><br />
- <code>SugarCropC4</code> → <code>SugarCrop</code></p>
<p><strong>Complete mapping:</strong></p>
<div class="codehilite"><pre><span></span><code>Original Name       →  Standard Name
─────────────────────────────────────
biomass             →  BioenergyCrop
biomassGrass        →  BioenergyCrop
biomassTree         →  BioenergyCrop
CornC4              →  Corn
FodderHerbC4        →  FodderHerb
FruitsTree          →  Fruits
MiscCropC4          →  MiscCrop
MiscCropTree        →  MiscCrop
NutsSeedsTree       →  NutsSeeds
OilCropTree         →  OilCrop
OilPalmTree         →  OilPalm
OtherGrainC4        →  OtherGrain
SugarCropC4         →  SugarCrop
</code></pre></div>

<hr />
<h2>Examples</h2>
<h3>Example 1: Processing Land Allocation Data</h3>
<p><strong>Purpose:</strong> Convert raw GCAM land allocation data into a clean format with standardized crop names.</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;input_file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;./data/land_allocation.csv&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;output_file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;./data/land_allocation_processed.csv&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;columns_to_drop&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;Unnamed: 0&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Units&quot;</span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;columns_to_split&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;landleaf&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;landtype&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;basin&quot;</span><span class="p">]</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;key_columns&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;scenario&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;region&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;basin&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;landtype&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;year&quot;</span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;mean_or_sum_if_more_than_one_row_in_same_landtype_group&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sum&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;call_modify_crop_names&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>What happens:</strong><br />
1. Drops the index column and units column<br />
2. Splits <code>landleaf</code> (e.g., <code>"Corn_Amazon"</code>) into <code>landtype</code> and <code>basin</code><br />
3. Sorts by scenario, region, basin, landtype, and year<br />
4. Sums areas when multiple crops map to the same standardized name<br />
5. Standardizes crop names (e.g., <code>CornC4</code> → <code>Corn</code>)<br />
6. Saves processed data</p>
<p><strong>Input data structure:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="n">scenario</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">region</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">landleaf</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">year</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Units</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nl">Unnamed:</span><span class="w"> </span><span class="mh">0</span>
<span class="o">---------|--------|-----------------|------|-------|-------|------------</span>
<span class="n">Control</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">USA</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">Corn_Amazon</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="mh">2020</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mf">150.5</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">km²</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="mh">0</span>
<span class="n">Control</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">USA</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">CornC4_Amazon</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="mh">2020</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mf">75.3</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">km²</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="mh">1</span>
</code></pre></div>

<p><strong>Output data structure:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nx">scenario</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nx">region</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nx">basin</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="nx">landtype</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nx">year</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nx">value</span>
<span class="o">---------|--------|--------|----------|------|-------</span>
<span class="nx">Control</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="nx">USA</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="nx">Amazon</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nx">Corn</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="mi">2020</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="m m-Double">225.8</span>
</code></pre></div>

<h3>Example 2: Processing Land Allocation with Original Crop Names</h3>
<p><strong>Purpose:</strong> Process the same data but keep original GCAM crop names.</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;input_file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;./data/land_allocation.csv&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;output_file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;./data/land_allocation_processed_original_crop_names.csv&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;columns_to_drop&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;Unnamed: 0&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Units&quot;</span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;columns_to_split&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;landleaf&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;landtype&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;basin&quot;</span><span class="p">]</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;key_columns&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;scenario&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;region&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;basin&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;landtype&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;year&quot;</span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;mean_or_sum_if_more_than_one_row_in_same_landtype_group&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sum&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;call_modify_crop_names&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Difference from Example 1:</strong><br />
- <code>call_modify_crop_names</code> is <code>false</code><br />
- Crop names remain as they appear in GCAM output<br />
- Useful when you need to track specific crop variants (e.g., C3 vs C4)</p>
<h3>Example 3: Processing Agricultural Commodity Prices</h3>
<p><strong>Purpose:</strong> Clean and aggregate commodity price data.</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;input_file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;./data/ag_commodity_prices.csv&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;output_file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;./data/ag_commodity_prices_processed.csv&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;columns_to_drop&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;Unnamed: 0&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Units&quot;</span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;key_columns&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;scenario&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;region&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;sector&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;year&quot;</span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;mean_or_sum_if_more_than_one_row_in_same_landtype_group&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;mean&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;call_modify_crop_names&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Key differences:</strong><br />
- No column splitting (price data doesn't need it)<br />
- Uses <code>"mean"</code> aggregation (prices should be averaged, not summed)<br />
- <code>sector</code> instead of <code>landtype</code> and <code>basin</code><br />
- Standardizes crop names for consistency with other analyses</p>
<p><strong>Why use "mean" for prices:</strong><br />
- If multiple price quotes exist for the same commodity/region/year, averaging gives a representative price<br />
- Summing prices would give meaningless values</p>
<h3>Example 4: Processing CO₂ Emissions by Sector</h3>
<p><strong>Purpose:</strong> Process emissions data with no crop name standardization needed.</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;input_file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;./data/co2_emissions_sectors.csv&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;output_file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;./data/co2_emissions_sectors_processed.csv&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;columns_to_drop&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;Unnamed: 0&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Units&quot;</span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;key_columns&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;scenario&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;region&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;sector&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;year&quot;</span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>What happens:</strong><br />
1. Drops unnecessary columns<br />
2. Sorts by scenario, region, sector, and year<br />
3. No aggregation (each row should already be unique)<br />
4. No crop name modification (not applicable to emissions data)</p>
<h3>Example 5: Processing CO₂ Emissions by Region</h3>
<p><strong>Purpose:</strong> Process regional aggregate emissions data.</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;input_file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;./data/co2_emissions_regions.csv&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;output_file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;./data/co2_emissions_regions_processed.csv&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;columns_to_drop&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;Unnamed: 0&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Units&quot;</span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;key_columns&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;scenario&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;region&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;year&quot;</span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Simplest case:</strong><br />
- Minimal processing needed<br />
- No sector breakdown (regional totals only)<br />
- Straightforward cleaning and sorting</p>
<hr />
<h2>Advanced Features</h2>
<h3>Understanding Aggregation with Crop Name Standardization</h3>
<p>When you enable crop name standardization, multiple original crop types may map to the same standardized name. The script handles this intelligently:</p>
<p><strong>Example scenario:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nx">Original</span><span class="w"> </span><span class="nx">Data</span><span class="p">:</span>
<span class="nx">scenario</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nx">region</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nx">landtype</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="nx">year</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nx">value</span>
<span class="o">---------|--------|---------------|------|-------</span>
<span class="nx">Control</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="nx">USA</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="nx">biomass</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="mi">2030</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">50</span>
<span class="nx">Control</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="nx">USA</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="nx">biomassGrass</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="mi">2030</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">30</span>
<span class="nx">Control</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="nx">USA</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="nx">biomassTree</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="mi">2030</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">20</span>
</code></pre></div>

<p><strong>With <code>"mean_or_sum_if_more_than_one_row_in_same_landtype_group": "sum"</code>:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="k">Proc</span><span class="nv">essed</span><span class="w"> </span><span class="nv">Data</span><span class="p">:</span>
<span class="nf">scenario</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nv">region</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nv">landtype</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="nv">year</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nv">value</span>
<span class="err">---------|--------|----------------|------|-------</span>
<span class="nf">Control</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="nv">USA</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="nv">BioenergyCrop</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="mi">2030</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">100</span>
</code></pre></div>

<p><strong>With <code>"mean_or_sum_if_more_than_one_row_in_same_landtype_group": "mean"</code>:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="k">Proc</span><span class="nv">essed</span><span class="w"> </span><span class="nv">Data</span><span class="p">:</span>
<span class="nf">scenario</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nv">region</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nv">landtype</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="nv">year</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nv">value</span>
<span class="err">---------|--------|----------------|------|-------</span>
<span class="nf">Control</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="nv">USA</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="nv">BioenergyCrop</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="mi">2030</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mf">33.33</span>
</code></pre></div>

<h3>Column Name Normalization</h3>
<p>All column names are automatically converted to lowercase. This ensures consistency:</p>
<p><strong>Input columns:</strong> <code>Scenario</code>, <code>Region</code>, <code>YEAR</code>, <code>Value</code><br />
<strong>Output columns:</strong> <code>scenario</code>, <code>region</code>, <code>year</code>, <code>value</code></p>
<h3>Automatic Sorting</h3>
<p>Data is always sorted by year first, then by key columns if specified. This ensures:<br />
- Chronological ordering for time series analysis<br />
- Consistent row ordering across files<br />
- Easier debugging and manual inspection</p>
<hr />
<h2>Understanding GCAM Land Types</h2>
<h3>Standard Land Type Groups</h3>
<p>GCAM organizes land into several major categories. The <code>utility_gcam.py</code> module defines these groups:</p>
<table>
<thead>
<tr>
<th>Group</th>
<th>Land Types Included</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>forest</strong></td>
<td>Forest, ProtectedUnmanagedForest, UnmanagedForest</td>
</tr>
<tr>
<td><strong>pasture</strong></td>
<td>Pasture, UnmanagedPasture, ProtectedUnmanagedPasture</td>
</tr>
<tr>
<td><strong>grass</strong></td>
<td>Grassland, ProtectedGrassland</td>
</tr>
<tr>
<td><strong>crop</strong></td>
<td>18 standardized crop types (see below)</td>
</tr>
<tr>
<td><strong>shrub</strong></td>
<td>Shrubland, ProtectedShrubland</td>
</tr>
<tr>
<td><strong>urban</strong></td>
<td>UrbanLand</td>
</tr>
<tr>
<td><strong>other</strong></td>
<td>RockIceDesert, Tundra</td>
</tr>
</tbody>
</table>
<h3>Standardized Crop Types</h3>
<p>After name standardization, crops are consolidated into 18 types:</p>
<ol>
<li>BioenergyCrop</li>
<li>Corn</li>
<li>FiberCrop</li>
<li>FodderGrass</li>
<li>FodderHerb</li>
<li>Fruits</li>
<li>Legumes</li>
<li>MiscCrop</li>
<li>NutsSeeds</li>
<li>OilCrop</li>
<li>OilPalm</li>
<li>OtherGrain</li>
<li>Rice</li>
<li>RootTuber</li>
<li>Soybean</li>
<li>SugarCrop</li>
<li>Vegetables</li>
<li>Wheat</li>
</ol>
<h3>Original Crop Types (Before Standardization)</h3>
<p>GCAM's original crop list includes 29 types, many with C3/C4 variants or tree/grass variants:</p>
<ul>
<li>biomass, biomassGrass, biomassTree</li>
<li>Corn, CornC4</li>
<li>FiberCrop</li>
<li>FodderGrass, FodderHerb, FodderHerbC4</li>
<li>Fruits, FruitsTree</li>
<li>Legumes</li>
<li>MiscCrop, MiscCropC4, MiscCropTree</li>
<li>NutsSeeds, NutsSeedsTree</li>
<li>OilCrop, OilCropTree, OilPalmTree</li>
<li>OtherGrain, OtherGrainC4</li>
<li>Rice</li>
<li>RootTuber</li>
<li>Soybean</li>
<li>SugarCrop, SugarCropC4</li>
<li>Vegetables</li>
<li>Wheat</li>
</ul>
<hr />
<h2>Troubleshooting</h2>
<h3>Common Issues</h3>
<p><strong>Problem:</strong> <code>FileNotFoundError</code> when running the script</p>
<div class="codehilite"><pre><span></span><code><span class="n">Solution</span><span class="o">:</span><span class="w"> </span><span class="n">Check</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">input_file</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">correct</span><span class="o">.</span><span class="w"> </span><span class="n">Use</span><span class="w"> </span><span class="n">absolute</span><span class="w"> </span><span class="n">paths</span><span class="w"> </span>
<span class="k">if</span><span class="w"> </span><span class="n">running</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">different</span><span class="w"> </span><span class="n">directory</span><span class="o">.</span>
</code></pre></div>

<p><strong>Problem:</strong> Missing columns after processing</p>
<div class="codehilite"><pre><span></span><code><span class="n">Solution</span><span class="o">:</span><span class="w"> </span><span class="n">Verify</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">key_columns</span><span class="w"> </span><span class="n">exactly</span><span class="w"> </span><span class="n">match</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">column</span><span class="w"> </span><span class="n">names</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">your</span><span class="w"> </span>
<span class="n">input</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="o">(</span><span class="k">case</span><span class="o">-</span><span class="n">insensitive</span><span class="w"> </span><span class="n">after</span><span class="w"> </span><span class="n">processing</span><span class="o">).</span><span class="w"> </span><span class="n">Check</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">typos</span><span class="o">.</span>
</code></pre></div>

<p><strong>Problem:</strong> Unexpected aggregation results</p>
<div class="codehilite"><pre><span></span><code><span class="n">Solution</span><span class="o">:</span><span class="w"> </span><span class="n">Check</span><span class="w"> </span><span class="n">your</span><span class="w"> </span><span class="n">choice</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="s2">&quot;mean&quot;</span><span class="w"> </span><span class="n">vs</span><span class="w"> </span><span class="s2">&quot;sum&quot;</span><span class="o">.</span><span class="w"> </span><span class="n">Prices</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="s2">&quot;mean&quot;</span><span class="o">,</span><span class="w"> </span>
<span class="n">areas</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="s2">&quot;sum&quot;</span><span class="o">.</span><span class="w"> </span><span class="n">If</span><span class="w"> </span><span class="n">you</span><span class="err">&#39;</span><span class="n">re</span><span class="w"> </span><span class="n">getting</span><span class="w"> </span><span class="n">zeros</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">very</span><span class="w"> </span><span class="n">large</span><span class="w"> </span><span class="n">values</span><span class="o">,</span><span class="w"> </span><span class="n">you</span><span class="w"> </span>
<span class="n">may</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">chosen</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">wrong</span><span class="w"> </span><span class="n">method</span><span class="o">.</span>
</code></pre></div>

<p><strong>Problem:</strong> Crop names not being standardized</p>
<div class="codehilite"><pre><span></span><code><span class="n">Solution</span><span class="o">:</span><span class="w"> </span><span class="n">Ensure</span><span class="w"> </span><span class="n">call_modify_crop_names</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="kd">set</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="o">(</span><span class="n">not</span><span class="w"> </span><span class="s2">&quot;true&quot;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">a</span><span class="w"> </span>
<span class="n">string</span><span class="o">).</span><span class="w"> </span><span class="n">Check</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">your</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">actually</span><span class="w"> </span><span class="n">contains</span><span class="w"> </span><span class="n">crop</span><span class="w"> </span><span class="n">types</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">need</span><span class="w"> </span>
<span class="n">standardization</span><span class="o">.</span>
</code></pre></div>

<p><strong>Problem:</strong> Output file is empty or has very few rows</p>
<div class="codehilite"><pre><span></span><code><span class="n">Solution</span><span class="o">:</span><span class="w"> </span><span class="n">Check</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">your</span><span class="w"> </span><span class="n">columns_to_drop</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="n">accidentally</span><span class="w"> </span><span class="n">includes</span><span class="w"> </span><span class="n">critical</span><span class="w"> </span>
<span class="n">columns</span><span class="o">.</span><span class="w"> </span><span class="n">Verify</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">key_columns</span><span class="w"> </span><span class="n">doesn</span><span class="err">&#39;</span><span class="n">t</span><span class="w"> </span><span class="n">over</span><span class="o">-</span><span class="n">specify</span><span class="w"> </span><span class="n">uniqueness</span><span class="o">,</span><span class="w"> </span><span class="n">causing</span><span class="w"> </span>
<span class="n">rows</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">dropped</span><span class="o">.</span>
</code></pre></div>

<h3>Input File Requirements</h3>
<p>Your CSV file should have:<br />
- A <code>year</code> column for temporal data<br />
- A <code>value</code> column containing the numeric data<br />
- Other columns for categorization (scenario, region, sector, landtype, etc.)<br />
- Consistent naming conventions</p>
<p><strong>Example of well-formed input:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="n">scenario</span><span class="p">,</span><span class="n">region</span><span class="p">,</span><span class="n">landleaf</span><span class="p">,</span><span class="n">year</span><span class="p">,</span><span class="n">value</span><span class="p">,</span><span class="n">Units</span><span class="p">,</span><span class="nl">Unnamed:</span><span class="w"> </span><span class="mh">0</span>
<span class="n">Control</span><span class="p">,</span><span class="n">USA</span><span class="p">,</span><span class="n">Corn_Amazon</span><span class="p">,</span><span class="mh">2020</span><span class="p">,</span><span class="mf">150.5</span><span class="p">,</span><span class="n">km²</span><span class="p">,</span><span class="mh">0</span>
<span class="n">Control</span><span class="p">,</span><span class="n">USA</span><span class="p">,</span><span class="n">Wheat_Mississippi</span><span class="p">,</span><span class="mh">2020</span><span class="p">,</span><span class="mf">200.3</span><span class="p">,</span><span class="n">km²</span><span class="p">,</span><span class="mh">1</span>
</code></pre></div>

<h3>Performance Tips</h3>
<ol>
<li><strong>Multiple Files:</strong> Process multiple files at once by listing them all in one JSON config</li>
<li><strong>Parallel Processing:</strong> The script automatically uses all CPU cores</li>
<li><strong>Large Files:</strong> For very large files (&gt;1GB), ensure sufficient RAM is available</li>
<li><strong>Debugging:</strong> Process one file at a time first to verify configuration before batch processing</li>
</ol>
<hr />
<h2>Best Practices</h2>
<h3>1. Keep Original Data</h3>
<p>Always preserve original GCAM extraction files. Create processed versions with different names:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;input_file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;./data/raw/land_allocation.csv&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;output_file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;./data/processed/land_allocation_processed.csv&quot;</span>
<span class="p">}</span>
</code></pre></div>

<h3>2. Maintain Two Versions When Needed</h3>
<p>For crop data, consider creating both standardized and original versions:</p>
<div class="codehilite"><pre><span></span><code><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;input_file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;./data/land_allocation.csv&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;output_file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;./data/land_allocation_standardized.csv&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;call_modify_crop_names&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;input_file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;./data/land_allocation.csv&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;output_file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;./data/land_allocation_original.csv&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;call_modify_crop_names&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">]</span>
</code></pre></div>

<h3>3. Document Your Aggregation Choices</h3>
<p>Keep notes about why you chose "mean" vs "sum" for different datasets:</p>
<ul>
<li><strong>Sum:</strong> Land areas, production quantities, emissions totals</li>
<li><strong>Mean:</strong> Prices, rates, scalars, percentages</li>
</ul>
<h3>4. Use Consistent Key Columns</h3>
<p>Maintain consistent key column ordering across related datasets for easier merging later:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">&quot;key_columns&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;scenario&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;region&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;basin&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;landtype&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;year&quot;</span><span class="p">]</span>
</code></pre></div>

<h3>5. Verify Output</h3>
<p>After processing, check the output file:<br />
- Row counts make sense<br />
- Value ranges are reasonable<br />
- No unexpected NaN or zero values<br />
- Column names are as expected</p>
<hr />
<h2>Integration with Other GCAM Scripts</h2>
<p>This data processing script works in conjunction with other GCAM analysis tools:</p>
<h3>Workflow Example</h3>
<div class="codehilite"><pre><span></span><code><span class="mf">1.</span><span class="w"> </span><span class="n">Extract</span><span class="w"> </span><span class="kd">data</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">GCAM</span><span class="w"> </span><span class="err">→</span><span class="w"> </span><span class="n">raw</span><span class="w"> </span><span class="n">CSV</span><span class="w"> </span><span class="n">files</span>
<span class="mf">2.</span><span class="w"> </span><span class="n">Process</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">gcam_process_extracted_data</span><span class="mf">.</span><span class="n">py</span><span class="w"> </span><span class="err">→</span><span class="w"> </span><span class="n">cleaned</span><span class="w"> </span><span class="n">CSV</span><span class="w"> </span><span class="n">files</span>
<span class="mf">3.</span><span class="w"> </span><span class="n">Visualize</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">gcam_plot_box_and_whiskers</span><span class="mf">.</span><span class="n">py</span><span class="w"> </span><span class="err">→</span><span class="w"> </span><span class="n">box</span><span class="w"> </span><span class="n">plots</span>
<span class="mf">4.</span><span class="w"> </span><span class="n">Further</span><span class="w"> </span><span class="n">analysis</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">time</span><span class="w"> </span><span class="n">series</span><span class="w"> </span><span class="n">scripts</span><span class="w"> </span><span class="err">→</span><span class="w"> </span><span class="n">trend</span><span class="w"> </span><span class="n">plots</span>
</code></pre></div>

<h3>Data Flow</h3>
<div class="codehilite"><pre><span></span><code>GCAM Model Output
       ↓
[Raw CSV Files]
       ↓
gcam_process_extracted_data.py
       ↓
[Processed CSV Files]
       ↓
┌──────┴──────┬──────────────┬────────────┐
│             │              │            │
Box Plots   Time Series   Statistics   Custom
                                        Analysis
</code></pre></div>

<hr />
<h2>Output File Characteristics</h2>
<h3>Structure</h3>
<p>Processed files have a consistent structure:<br />
- <strong>Columns:</strong> Only key columns plus <code>value</code><br />
- <strong>Sorting:</strong> By year, then by other key columns<br />
- <strong>Format:</strong> CSV with headers<br />
- <strong>Encoding:</strong> UTF-8</p>
<h3>Example Output</h3>
<div class="codehilite"><pre><span></span><code><span class="nx">scenario</span><span class="p">,</span><span class="nx">region</span><span class="p">,</span><span class="nx">basin</span><span class="p">,</span><span class="nx">landtype</span><span class="p">,</span><span class="nx">year</span><span class="p">,</span><span class="nx">value</span>
<span class="nx">Control</span><span class="p">,</span><span class="nx">USA</span><span class="p">,</span><span class="nx">Amazon</span><span class="p">,</span><span class="nx">BioenergyCrop</span><span class="p">,</span><span class="mi">2015</span><span class="p">,</span><span class="m m-Double">45.2</span>
<span class="nx">Control</span><span class="p">,</span><span class="nx">USA</span><span class="p">,</span><span class="nx">Amazon</span><span class="p">,</span><span class="nx">BioenergyCrop</span><span class="p">,</span><span class="mi">2020</span><span class="p">,</span><span class="m m-Double">52.1</span>
<span class="nx">Control</span><span class="p">,</span><span class="nx">USA</span><span class="p">,</span><span class="nx">Amazon</span><span class="p">,</span><span class="nx">BioenergyCrop</span><span class="p">,</span><span class="mi">2025</span><span class="p">,</span><span class="m m-Double">58.7</span>
<span class="nx">Control</span><span class="p">,</span><span class="nx">USA</span><span class="p">,</span><span class="nx">Amazon</span><span class="p">,</span><span class="nx">Corn</span><span class="p">,</span><span class="mi">2015</span><span class="p">,</span><span class="m m-Double">145.8</span>
<span class="nx">Control</span><span class="p">,</span><span class="nx">USA</span><span class="p">,</span><span class="nx">Amazon</span><span class="p">,</span><span class="nx">Corn</span><span class="p">,</span><span class="mi">2020</span><span class="p">,</span><span class="m m-Double">152.3</span>
</code></pre></div>

<hr />
<h2>Execution Time</h2>
<p>Processing times vary based on:<br />
- <strong>File size:</strong> 10MB file ≈ 1-2 seconds<br />
- <strong>Number of files:</strong> Parallel processing scales well<br />
- <strong>Operations:</strong> Column splitting and crop name standardization add minimal overhead<br />
- <strong>System:</strong> More CPU cores = faster parallel processing</p>
<p><strong>Example output:</strong></p>
<div class="codehilite"><pre><span></span><code>Elapsed time for producing land_allocation_processed.csv: 1.23 seconds
Elapsed time for producing ag_commodity_prices_processed.csv: 0.87 seconds
Elapsed time for producing all files: 1.45 seconds
</code></pre></div>

<hr />
<h2>Version Information</h2>
<p><strong>Script:</strong> gcam_process_extracted_data.py<br />
<strong>Documentation Version:</strong> 1.0<br />
<strong>Last Updated:</strong> January 2026<br />
<strong>Python Version:</strong> 3.7+</p>
<hr />
<h2>Appendix: Complete Configuration Reference</h2>
<h3>Full Parameter List</h3>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Required</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>input_file</code></td>
<td>string</td>
<td>✓</td>
<td>-</td>
<td>Path to input CSV file</td>
</tr>
<tr>
<td><code>output_file</code></td>
<td>string</td>
<td>✓</td>
<td>-</td>
<td>Path to output CSV file</td>
</tr>
<tr>
<td><code>columns_to_drop</code></td>
<td>list</td>
<td>✗</td>
<td><code>None</code></td>
<td>Columns to remove</td>
</tr>
<tr>
<td><code>columns_to_split</code></td>
<td>dict</td>
<td>✗</td>
<td><code>None</code></td>
<td>Columns to split into new columns</td>
</tr>
<tr>
<td><code>key_columns</code></td>
<td>list</td>
<td>✗</td>
<td><code>None</code></td>
<td>Columns for sorting and grouping</td>
</tr>
<tr>
<td><code>mean_or_sum_if_more_than_one_row_in_same_landtype_group</code></td>
<td>string</td>
<td>✗</td>
<td><code>None</code></td>
<td>Aggregation method: <code>"mean"</code> or <code>"sum"</code></td>
</tr>
<tr>
<td><code>call_modify_crop_names</code></td>
<td>boolean</td>
<td>✗</td>
<td><code>false</code></td>
<td>Enable crop name standardization</td>
</tr>
</tbody>
</table>
<h3>Template Configuration</h3>
<div class="codehilite"><pre><span></span><code><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;input_file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;./path/to/input.csv&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;output_file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;./path/to/output.csv&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;columns_to_drop&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;Unnamed: 0&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Units&quot;</span><span class="p">],</span>
<span class="w">        </span><span class="nt">&quot;columns_to_split&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;composite_column&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;new_col1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;new_col2&quot;</span><span class="p">]</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nt">&quot;key_columns&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;scenario&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;region&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;sector&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;year&quot;</span><span class="p">],</span>
<span class="w">        </span><span class="nt">&quot;mean_or_sum_if_more_than_one_row_in_same_landtype_group&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;mean&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;call_modify_crop_names&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">]</span>
</code></pre></div>

<hr />
<h2>Support and Feedback</h2>
<p>For issues or questions:<br />
1. Verify your JSON configuration is valid (use a JSON validator)<br />
2. Check that utility modules are in the Python path<br />
3. Review console output for specific error messages<br />
4. Ensure input file format matches expected structure<br />
5. Test with a small subset of data first</p>
<p>This documentation provides comprehensive guidance for using the GCAM data processing script to prepare GCAM model outputs for analysis and visualization.</p>
        
        <footer>
            <p>
                Documentation generated for the E3SM-GCAM Analysis Scripts<br>
                <strong>Script:</strong> gcam_process_extracted_data.py<br>
                <strong>Documentation Version:</strong> 1.0<br>
                <strong>Last Updated:</strong> January 2026
            </p>
        </footer>
    </div>
</body>
</html>
