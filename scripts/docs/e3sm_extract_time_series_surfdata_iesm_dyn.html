<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E3SM Surface Data Time Series Extraction Script Documentation</title>
    <style>
/* 
 * Documentation Stylesheet for GCAM Synthetic Data Generation Script
 * A modern, colorful design with good readability
 */

/* ===== ROOT VARIABLES ===== */
:root {
    /* Color Palette */
    --primary-blue: #2563eb;
    --primary-blue-light: #3b82f6;
    --primary-blue-dark: #1e40af;
    --accent-green: #10b981;
    --accent-orange: #f59e0b;
    --accent-purple: #8b5cf6;
    --accent-red: #ef4444;
    
    /* Background Colors */
    --bg-main: #f8fafc;
    --bg-code: #1e293b;
    --bg-code-inline: #e2e8f0;
    --bg-table-header: #1e40af;
    --bg-table-row-even: #f1f5f9;
    --bg-table-row-odd: #ffffff;
    --bg-note: #fef3c7;
    --bg-warning: #fee2e2;
    --bg-info: #dbeafe;
    --bg-success: #d1fae5;
    
    /* Text Colors */
    --text-main: #1e293b;
    --text-secondary: #64748b;
    --text-code: #e2e8f0;
    --text-link: #2563eb;
    --text-link-hover: #1e40af;
    
    /* Border Colors */
    --border-light: #e2e8f0;
    --border-medium: #cbd5e1;
    --border-dark: #94a3b8;
    
    /* Spacing */
    --spacing-xs: 0.25rem;
    --spacing-sm: 0.5rem;
    --spacing-md: 1rem;
    --spacing-lg: 1.5rem;
    --spacing-xl: 2rem;
    --spacing-2xl: 3rem;
}

/* ===== BASE STYLES ===== */
* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}

body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    line-height: 1.7;
    color: var(--text-main);
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    padding: var(--spacing-xl) var(--spacing-md);
    font-size: 16px;
}

/* Main Container */
.container {
    max-width: 1200px;
    margin: 0 auto;
    background: var(--bg-main);
    padding: var(--spacing-2xl);
    border-radius: 12px;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
}

/* ===== TYPOGRAPHY ===== */
h1 {
    font-size: 2.5rem;
    color: var(--primary-blue-dark);
    margin-bottom: var(--spacing-xl);
    padding-bottom: var(--spacing-md);
    border-bottom: 4px solid var(--primary-blue);
    font-weight: 700;
    background: linear-gradient(135deg, var(--primary-blue) 0%, var(--accent-purple) 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

h2 {
    font-size: 2rem;
    color: var(--primary-blue);
    margin-top: var(--spacing-2xl);
    margin-bottom: var(--spacing-lg);
    padding-left: var(--spacing-md);
    border-left: 5px solid var(--accent-green);
    font-weight: 600;
}

h3 {
    font-size: 1.5rem;
    color: var(--primary-blue-dark);
    margin-top: var(--spacing-xl);
    margin-bottom: var(--spacing-md);
    font-weight: 600;
    display: flex;
    align-items: center;
}

h3::before {
    content: "▸";
    color: var(--accent-orange);
    margin-right: var(--spacing-sm);
    font-size: 1.2rem;
}

h4 {
    font-size: 1.25rem;
    color: var(--accent-purple);
    margin-top: var(--spacing-lg);
    margin-bottom: var(--spacing-sm);
    font-weight: 600;
}

p {
    margin-bottom: var(--spacing-md);
    color: var(--text-main);
}

/* ===== LINKS ===== */
a {
    color: var(--text-link);
    text-decoration: none;
    font-weight: 500;
    border-bottom: 2px solid transparent;
    transition: all 0.3s ease;
}

a:hover {
    color: var(--text-link-hover);
    border-bottom-color: var(--text-link-hover);
}

/* ===== LISTS ===== */
ul, ol {
    margin-left: var(--spacing-xl);
    margin-bottom: var(--spacing-md);
}

li {
    margin-bottom: var(--spacing-sm);
    padding-left: var(--spacing-sm);
}

ul li::marker {
    color: var(--accent-green);
    font-size: 1.2em;
}

ol li::marker {
    color: var(--primary-blue);
    font-weight: 600;
}

/* ===== CODE BLOCKS ===== */
code {
    font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
    font-size: 0.9em;
    padding: var(--spacing-xs) var(--spacing-sm);
    background: var(--bg-code-inline);
    color: var(--accent-red);
    border-radius: 4px;
    font-weight: 500;
}

pre {
    background: var(--bg-code);
    color: var(--text-code);
    padding: var(--spacing-lg);
    border-radius: 8px;
    overflow-x: auto;
    margin: var(--spacing-lg) 0;
    border-left: 4px solid var(--accent-green);
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

pre code {
    background: transparent;
    color: var(--text-code);
    padding: 0;
    font-size: 0.95em;
    line-height: 1.5;
}

/* ===== TABLES ===== */
table {
    width: 100%;
    border-collapse: collapse;
    margin: var(--spacing-xl) 0;
    background: white;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

thead {
    background: linear-gradient(135deg, var(--primary-blue) 0%, var(--primary-blue-dark) 100%);
    color: white;
}

th {
    padding: var(--spacing-md);
    text-align: left;
    font-weight: 600;
    font-size: 1.05em;
    border-bottom: 3px solid var(--accent-orange);
}

td {
    padding: var(--spacing-md);
    border-bottom: 1px solid var(--border-light);
}

tbody tr:nth-child(even) {
    background: var(--bg-table-row-even);
}

tbody tr:nth-child(odd) {
    background: var(--bg-table-row-odd);
}

tbody tr:hover {
    background: #e0f2fe;
    transform: scale(1.01);
    transition: all 0.2s ease;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
}

/* ===== BLOCKQUOTES ===== */
blockquote {
    margin: var(--spacing-lg) 0;
    padding: var(--spacing-md) var(--spacing-lg);
    background: var(--bg-info);
    border-left: 5px solid var(--primary-blue);
    border-radius: 0 8px 8px 0;
    font-style: italic;
    color: var(--primary-blue-dark);
}

/* ===== HORIZONTAL RULES ===== */
hr {
    border: none;
    height: 3px;
    background: linear-gradient(90deg, var(--accent-green) 0%, var(--primary-blue) 50%, var(--accent-purple) 100%);
    margin: var(--spacing-2xl) 0;
    border-radius: 2px;
}

/* ===== SPECIAL BOXES ===== */
.note {
    background: var(--bg-note);
    border-left: 5px solid var(--accent-orange);
    padding: var(--spacing-md) var(--spacing-lg);
    margin: var(--spacing-lg) 0;
    border-radius: 0 8px 8px 0;
}

.warning {
    background: var(--bg-warning);
    border-left: 5px solid var(--accent-red);
    padding: var(--spacing-md) var(--spacing-lg);
    margin: var(--spacing-lg) 0;
    border-radius: 0 8px 8px 0;
}

.info {
    background: var(--bg-info);
    border-left: 5px solid var(--primary-blue);
    padding: var(--spacing-md) var(--spacing-lg);
    margin: var(--spacing-lg) 0;
    border-radius: 0 8px 8px 0;
}

.success {
    background: var(--bg-success);
    border-left: 5px solid var(--accent-green);
    padding: var(--spacing-md) var(--spacing-lg);
    margin: var(--spacing-lg) 0;
    border-radius: 0 8px 8px 0;
}

/* ===== BADGES ===== */
.badge {
    display: inline-block;
    padding: var(--spacing-xs) var(--spacing-md);
    border-radius: 20px;
    font-size: 0.85em;
    font-weight: 600;
    margin: 0 var(--spacing-xs);
}

.badge-required {
    background: var(--accent-red);
    color: white;
}

.badge-optional {
    background: var(--accent-green);
    color: white;
}

.badge-default {
    background: var(--primary-blue);
    color: white;
}

/* ===== STRONG & EM ===== */
strong {
    color: var(--primary-blue-dark);
    font-weight: 700;
}

em {
    color: var(--accent-purple);
    font-style: italic;
}

/* ===== IMAGES ===== */
img {
    max-width: 100%;
    height: auto;
    border-radius: 8px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    margin: var(--spacing-lg) 0;
}

/* ===== SCROLLBAR STYLING ===== */
::-webkit-scrollbar {
    width: 12px;
    height: 12px;
}

::-webkit-scrollbar-track {
    background: var(--bg-table-row-even);
    border-radius: 10px;
}

::-webkit-scrollbar-thumb {
    background: linear-gradient(135deg, var(--primary-blue) 0%, var(--accent-purple) 100%);
    border-radius: 10px;
}

::-webkit-scrollbar-thumb:hover {
    background: linear-gradient(135deg, var(--primary-blue-dark) 0%, var(--accent-purple) 100%);
}

/* ===== PRINT STYLES ===== */
@media print {
    body {
        background: white;
        padding: 0;
    }
    
    .container {
        box-shadow: none;
        max-width: 100%;
    }
    
    h1, h2, h3 {
        page-break-after: avoid;
    }
    
    pre, table {
        page-break-inside: avoid;
    }
}

/* ===== RESPONSIVE DESIGN ===== */
@media (max-width: 768px) {
    body {
        padding: var(--spacing-md) var(--spacing-sm);
        font-size: 14px;
    }
    
    .container {
        padding: var(--spacing-lg);
    }
    
    h1 {
        font-size: 2rem;
    }
    
    h2 {
        font-size: 1.5rem;
    }
    
    h3 {
        font-size: 1.25rem;
    }
    
    table {
        font-size: 0.9em;
    }
    
    th, td {
        padding: var(--spacing-sm);
    }
}

/* ===== ADDITIONAL UTILITY CLASSES ===== */
.text-center {
    text-align: center;
}

.text-right {
    text-align: right;
}

.margin-top-lg {
    margin-top: var(--spacing-2xl);
}

.margin-bottom-lg {
    margin-bottom: var(--spacing-2xl);
}

.highlight {
    background: linear-gradient(120deg, #fef3c7 0%, #fde68a 100%);
    padding: 0 var(--spacing-xs);
    border-radius: 3px;
}

/* ===== SECTION DIVIDERS ===== */
.section-divider {
    display: flex;
    align-items: center;
    text-align: center;
    margin: var(--spacing-2xl) 0;
}

.section-divider::before,
.section-divider::after {
    content: '';
    flex: 1;
    border-bottom: 2px solid var(--border-medium);
}

.section-divider::before {
    margin-right: var(--spacing-md);
}

.section-divider::after {
    margin-left: var(--spacing-md);
}

/* ===== FOOTER ===== */
footer {
    margin-top: var(--spacing-2xl);
    padding-top: var(--spacing-lg);
    border-top: 2px solid var(--border-light);
    text-align: center;
    color: var(--text-secondary);
    font-size: 0.9em;
}

    </style>
</head>
<body>
    <div class="container">
<h1>E3SM Surface Data Time Series Extraction Script Documentation</h1>
<h2>Overview</h2>
<p><strong>Script Name:</strong> <code>e3sm_extract_time_series_surfdata_iesm_dyn.py</code></p>
<p><strong>Purpose:</strong> Extracts annual time series data from the E3SM Human Component (EHC) dynamically-generated land surface data file (<code>surfdata_iESM_dyn.nc</code>). This script specifically processes human-related land management activities including grazing and wood harvesting (various harvest types), aggregates data spatially, and outputs annual time series for global or regional analysis.</p>
<p><strong>Key Difference from h0 Script:</strong> Unlike <code>e3sm_extract_time_series_h0.py</code> which processes monthly ELM/EAM output files, this script processes a <strong>single NetCDF file</strong> containing time-varying land use data that is updated dynamically during E3SM-GCAM coupled simulations.</p>
<p><strong>Author:</strong> Philip Myint (myint1@llnl.gov) and Dalei Hao (dalei.hao@pnnl.gov)</p>
<p><strong>Repository:</strong> <a href="https://github.com/philipmyint/e3sm--gcam_analysis">E3SM-GCAM Analysis Scripts</a></p>
<hr />
<h2>Table of Contents</h2>
<ol>
<li><a href="#overview">Overview</a></li>
<li><a href="#installation--requirements">Installation &amp; Requirements</a></li>
<li><a href="#basic-usage">Basic Usage</a></li>
<li><a href="#e3sm-human-component-background">E3SM Human Component Background</a></li>
<li><a href="#complete-parameter-reference-table">Complete Parameter Reference Table</a></li>
<li><a href="#detailed-parameter-descriptions">Detailed Parameter Descriptions</a></li>
<li><a href="#available-variables">Available Variables</a></li>
<li><a href="#variable-processing">Variable Processing</a></li>
<li><a href="#regional-analysis">Regional Analysis</a></li>
<li><a href="#json-configuration-examples">JSON Configuration Examples</a></li>
<li><a href="#output-files">Output Files</a></li>
<li><a href="#troubleshooting">Troubleshooting</a></li>
<li><a href="#best-practices">Best Practices</a></li>
<li><a href="#comparison-with-h0-extraction-script">Comparison with h0 Extraction Script</a></li>
</ol>
<hr />
<h2>Installation &amp; Requirements</h2>
<h3>Required Python Libraries</h3>
<div class="codehilite"><pre><span></span><code>pip<span class="w"> </span>install<span class="w"> </span>pandas<span class="w"> </span>numpy<span class="w"> </span>xarray<span class="w"> </span>netCDF4<span class="w"> </span>multiprocessing
</code></pre></div>

<h3>Required Utility Modules</h3>
<p>The script imports several utility modules that must be in the same directory or Python path:<br />
- <code>utility_constants</code> - Physical constants (conversion factors)<br />
- <code>utility_dataframes</code> - DataFrame manipulation functions<br />
- <code>utility_functions</code> - General utility functions<br />
- <code>utility_e3sm_netcdf</code> - E3SM-specific NetCDF handling functions</p>
<h3>System Requirements</h3>
<ul>
<li>Python 3.7+</li>
<li>Multi-core processor (script uses parallel processing)</li>
<li>Sufficient RAM for NetCDF file processing (4+ GB recommended)</li>
<li>Access to E3SM simulation output directories</li>
</ul>
<hr />
<h2>Basic Usage</h2>
<h3>Command Line Execution</h3>
<div class="codehilite"><pre><span></span><code>python<span class="w"> </span>e3sm_extract_time_series_surfdata_iesm_dyn.py<span class="w"> </span>path/to/config.json
</code></pre></div>

<p><strong>Multiple Configuration Files:</strong></p>
<div class="codehilite"><pre><span></span><code>python<span class="w"> </span>e3sm_extract_time_series_surfdata_iesm_dyn.py<span class="w"> </span>config1.json<span class="w"> </span>config2.json<span class="w"> </span>config3.json
</code></pre></div>

<h3>What the Script Does</h3>
<p>For each configuration block in the JSON file, the script:<br />
1. <strong>Locates</strong> the <code>surfdata_iESM_dyn.nc</code> file in simulation directory<br />
2. <strong>Extracts</strong> specified variables for each year in the range<br />
3. <strong>Processes</strong> PFT (Plant Functional Type) data automatically<br />
4. <strong>Converts</strong> grazing/harvest fractions to areas (km²)<br />
5. <strong>Aggregates</strong> spatially (area-weighted sum over lat/lon)<br />
6. <strong>Filters</strong> by region (optional - global, Amazon, CONUS, etc.)<br />
7. <strong>Calculates</strong> total harvest from individual harvest types<br />
8. <strong>Outputs</strong> annual time series to formatted text file<br />
9. <strong>Uses</strong> parallel processing (one process per year)</p>
<hr />
<h2>E3SM Human Component Background</h2>
<h3>The E3SM Human Component (EHC)</h3>
<p>The <strong>E3SM Human Component (EHC)</strong> is a module within E3SM that represents human activities affecting the land surface, particularly in E3SM-GCAM coupled simulations. The EHC:</p>
<ul>
<li><strong>Bridges</strong> E3SM (Earth system model) and GCAM (integrated assessment model)</li>
<li><strong>Updates</strong> land use dynamically during simulation</li>
<li><strong>Tracks</strong> human land management activities</li>
<li><strong>Generates</strong> <code>surfdata_iESM_dyn.nc</code> file at runtime</li>
</ul>
<h3>The surfdata_iESM_dyn.nc File</h3>
<p><strong>Purpose:</strong> Land surface data file dynamically updated during E3SM-GCAM coupled runs</p>
<p><strong>Key Characteristics:</strong><br />
- <strong>Single file</strong> (not monthly like h0 files)<br />
- <strong>Multi-year</strong> (contains data for all simulation years)<br />
- <strong>Annual data</strong> (one timestep per year)<br />
- <strong>Human activities</strong> (grazing, harvest)<br />
- <strong>PFT distributions</strong> (plant functional types)</p>
<p><strong>File Location:</strong></p>
<div class="codehilite"><pre><span></span><code>simulation_path/
└── surfdata_iESM_dyn.nc  (single file)
</code></pre></div>

<p><strong>Typical Size:</strong> 1-5 GB (depending on simulation length)</p>
<p><strong>Time Dimension:</strong></p>
<div class="codehilite"><pre><span></span><code>time = year values (e.g., 2015, 2016, ..., 2100)
</code></pre></div>

<h3>Human Land Management Variables</h3>
<p><strong>Grazing:</strong><br />
- <code>GRAZING</code> - Fraction of grassland grazed by livestock<br />
- Units: Dimensionless fraction (0-1)<br />
- Converted to area (km²) by script</p>
<p><strong>Wood Harvesting:</strong><br />
- <code>HARVEST_VH1</code> - Very heavy harvest intensity 1<br />
- <code>HARVEST_VH2</code> - Very heavy harvest intensity 2<br />
- <code>HARVEST_SH1</code> - Secondary heavy harvest intensity 1<br />
- <code>HARVEST_SH2</code> - Secondary heavy harvest intensity 2<br />
- <code>HARVEST_SH3</code> - Secondary heavy harvest intensity 3<br />
- Units: Dimensionless fractions (0-1)<br />
- Converted to forest area (km²) by script</p>
<p><strong>Land Cover:</strong><br />
- <code>PCT_NATVEG</code> - Percent natural vegetation<br />
- <code>PCT_NAT_PFT</code> - Percent of each plant functional type<br />
- Used to calculate PFT areas</p>
<hr />
<h2>Complete Parameter Reference Table</h2>
<h3>Required Parameters</h3>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>simulation_path</code></td>
<td>string</td>
<td><strong>Yes</strong></td>
<td>Path to E3SM simulation directory containing surfdata_iESM_dyn.nc</td>
</tr>
<tr>
<td><code>output_file</code></td>
<td>string</td>
<td><strong>Yes</strong></td>
<td>Path/name for output time series file</td>
</tr>
<tr>
<td><code>variables</code></td>
<td>list</td>
<td><strong>Yes</strong></td>
<td>Variables to extract from surfdata file</td>
</tr>
</tbody>
</table>
<h3>Optional Parameters</h3>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Required</th>
<th>Default</th>
<th>Possible Values</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>region</code></td>
<td>string</td>
<td>No</td>
<td><code>None</code> (global)</td>
<td>Region name or <code>None</code></td>
<td>Geographic region to extract</td>
</tr>
<tr>
<td><code>start_year</code></td>
<td>integer</td>
<td>No</td>
<td><code>2015</code></td>
<td>Any year</td>
<td>First year to extract</td>
</tr>
<tr>
<td><code>end_year</code></td>
<td>integer</td>
<td>No</td>
<td><code>2100</code></td>
<td>Any year</td>
<td>Last year to extract</td>
</tr>
<tr>
<td><code>write_to_csv</code></td>
<td>boolean</td>
<td>No</td>
<td><code>false</code></td>
<td><code>true</code>, <code>false</code></td>
<td>Output as CSV instead of fixed-width</td>
</tr>
</tbody>
</table>
<hr />
<h2>Detailed Parameter Descriptions</h2>
<h3>Core Required Parameters</h3>
<h4><code>simulation_path</code></h4>
<p><strong>Type:</strong> String (directory path)<br />
<strong>Required:</strong> Yes<br />
<strong>Description:</strong> Complete path to directory containing the <code>surfdata_iESM_dyn.nc</code> file.</p>
<p><strong>Examples:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nt">&quot;simulation_path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/lcrc/group/e3sm/ac.eva.sinha/20240730_SSP245_ZATM_BGC_ne30pg2_f09_oEC60to30v3_without_feedbacks/run&quot;</span>
</code></pre></div>

<p><strong>Requirements:</strong><br />
- Must be valid directory path<br />
- Must contain <code>surfdata_iESM_dyn.nc</code> file<br />
- File must follow E3SM naming convention</p>
<p><strong>File Location:</strong></p>
<div class="codehilite"><pre><span></span><code>simulation_path/
└── surfdata_iESM_dyn.nc  ← Script looks for this exact filename
</code></pre></div>

<hr />
<h4><code>output_file</code></h4>
<p><strong>Type:</strong> String (file path)<br />
<strong>Required:</strong> Yes<br />
<strong>Description:</strong> Path and filename for output time series data.</p>
<p><strong>Examples:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nt">&quot;output_file&quot;</span><span class="p">:</span><span class="w"> </span><span class="nt">&quot;./../2025_DiVittorio_et_al_e3sm/control_time_series_surfdata_iESM_dyn_20240730.dat&quot;</span>
<span class="nt">&quot;output_file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;./output/amazon_harvest_grazing.csv&quot;</span>
</code></pre></div>

<p><strong>File Formats:</strong><br />
- <strong>Fixed-width (.dat)</strong> - Default, human-readable, aligned columns<br />
- <strong>CSV (.csv)</strong> - If filename ends in .csv or <code>write_to_csv: true</code></p>
<p><strong>Output Structure:</strong></p>
<div class="codehilite"><pre><span></span><code>Year  FRAC_VEG  GRAZING_AREA (km^2)  HARVEST_VH1_AREA (km^2)  HARVEST_AREA (km^2)  ...
2015    0.6234        1234.56                567.89                2345.67
2016    0.6198        1289.34                578.12                2401.23
...
</code></pre></div>

<hr />
<h4><code>variables</code></h4>
<p><strong>Type:</strong> List of strings<br />
<strong>Required:</strong> Yes<br />
<strong>Description:</strong> Variables to extract from surfdata_iESM_dyn.nc file.</p>
<p><strong>Format:</strong> Simple list (not nested like in h0 script)</p>
<p><strong>Common Usage:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nt">&quot;variables&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;GRAZING&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;HARVEST_SH1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;HARVEST_SH2&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;HARVEST_SH3&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;HARVEST_VH1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;HARVEST_VH2&quot;</span><span class="p">]</span>
</code></pre></div>

<p><strong>Available Variables:</strong></p>
<p><strong>Human Management:</strong><br />
- <code>GRAZING</code> - Grazing fraction on grasslands<br />
- <code>HARVEST_VH1</code> - Very heavy harvest 1<br />
- <code>HARVEST_VH2</code> - Very heavy harvest 2<br />
- <code>HARVEST_SH1</code> - Secondary heavy harvest 1<br />
- <code>HARVEST_SH2</code> - Secondary heavy harvest 2<br />
- <code>HARVEST_SH3</code> - Secondary heavy harvest 3</p>
<p><strong>Land Cover (Automatically included if needed):</strong><br />
- <code>PCT_NATVEG</code> - Natural vegetation percent<br />
- <code>PCT_NAT_PFT</code> - PFT percentages</p>
<p><strong>Note:</strong> If you request grazing or harvest variables, the script automatically includes <code>PCT_NATVEG</code> and <code>PCT_NAT_PFT</code> to calculate areas.</p>
<hr />
<h3>Optional Parameters</h3>
<h4><code>region</code></h4>
<p><strong>Type:</strong> String or <code>None</code><br />
<strong>Required:</strong> No<br />
<strong>Default:</strong> <code>None</code> (global - no filtering)<br />
<strong>Possible Values:</strong> Region names or <code>None</code></p>
<p><strong>Description:</strong> Geographic region to filter data extraction.</p>
<p><strong>Example:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nt">&quot;region&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;amazon&quot;</span>
</code></pre></div>

<p><strong>Available Regions:</strong></p>
<p><strong>North America:</strong><br />
- <code>"noam"</code> - North America<br />
- <code>"bona"</code> - Boreal North America<br />
- <code>"tena"</code> - Temperate North America<br />
- <code>"conus"</code> - Continental United States<br />
- <code>"columbia"</code> - Columbia River watershed<br />
- <code>"ceam"</code> - Central America</p>
<p><strong>South America:</strong><br />
- <code>"soam"</code> - South America<br />
- <code>"nhsa"</code> - Northern Hemisphere South America<br />
- <code>"shsa"</code> - Southern Hemisphere South America<br />
- <code>"amazon"</code> - Amazon Basin</p>
<p><strong>Europe/Middle East:</strong><br />
- <code>"euro"</code> - Europe<br />
- <code>"mide"</code> - Middle East</p>
<p><strong>Africa:</strong><br />
- <code>"afrc"</code> - Africa<br />
- <code>"nhaf"</code> - Northern Hemisphere Africa<br />
- <code>"shaf"</code> - Southern Hemisphere Africa</p>
<p><strong>Asia:</strong><br />
- <code>"asia"</code> - Asia<br />
- <code>"boas"</code> - Boreal Asia<br />
- <code>"ceas"</code> - Central Asia<br />
- <code>"seas"</code> - Southeast Asia<br />
- <code>"eqas"</code> - Equatorial Asia</p>
<p><strong>Australia:</strong><br />
- <code>"aust"</code> - Australia</p>
<p><strong>Usage:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Global (default)</span>
<span class="nt">&quot;region&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>

<span class="c1">// Amazon only</span>
<span class="nt">&quot;region&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;amazon&quot;</span>
</code></pre></div>

<hr />
<h4><code>start_year</code> and <code>end_year</code></h4>
<p><strong>Type:</strong> Integer<br />
<strong>Required:</strong> No<br />
<strong>Defaults:</strong> <code>start_year: 2015</code>, <code>end_year: 2100</code></p>
<p><strong>Description:</strong> Year range for time series extraction.</p>
<p><strong>Example:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nt">&quot;start_year&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2020</span><span class="p">,</span>
<span class="nt">&quot;end_year&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2050</span>
</code></pre></div>

<p><strong>Usage:</strong><br />
- Extracts data only for years within this range<br />
- Reduces processing time for subset analysis<br />
- Useful for specific time periods</p>
<p><strong>Data Selection:</strong></p>
<div class="codehilite"><pre><span></span><code>Year 2019 → Excluded (&lt; start_year 2020)
Year 2020 → Included
Year 2050 → Included
Year 2051 → Excluded (&gt; end_year 2050)
</code></pre></div>

<hr />
<h4><code>write_to_csv</code></h4>
<p><strong>Type:</strong> Boolean<br />
<strong>Required:</strong> No<br />
<strong>Default:</strong> <code>false</code></p>
<p><strong>Description:</strong> Force output to CSV format.</p>
<p><strong>Behavior:</strong><br />
- <code>false</code> → Fixed-width format (.dat)<br />
- <code>true</code> → CSV format<br />
- Automatically <code>true</code> if <code>output_file</code> ends in <code>.csv</code></p>
<p><strong>Example:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nt">&quot;write_to_csv&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
</code></pre></div>

<p><strong>Comparison:</strong></p>
<p><strong>Fixed-width (.dat):</strong></p>
<div class="codehilite"><pre><span></span><code>Year  FRAC_VEG  GRAZING_AREA (km^2)
2015    0.6234        1234.56
2016    0.6198        1289.34
</code></pre></div>

<p><strong>CSV (.csv):</strong></p>
<div class="codehilite"><pre><span></span><code>Year,FRAC_VEG,GRAZING_AREA (km^2)
2015,0.6234,1234.56
2016,0.6198,1289.34
</code></pre></div>

<hr />
<h2>Available Variables</h2>
<h3>Direct Extraction Variables</h3>
<p>These are variables that exist directly in the surfdata_iESM_dyn.nc file:</p>
<h4>Grazing</h4>
<p><strong>Variable:</strong> <code>GRAZING</code><br />
<strong>Original Units:</strong> Dimensionless fraction (0-1)<br />
<strong>Output Units:</strong> km² (after processing)<br />
<strong>Description:</strong> Fraction of grassland area used for livestock grazing<br />
<strong>Output Column:</strong> <code>GRAZING_AREA (km^2)</code></p>
<p><strong>Calculation:</strong></p>
<div class="codehilite"><pre><span></span><code>GRAZING_AREA (km²) = GRAZING × GRASS_AREA (km²)
</code></pre></div>

<h4>Wood Harvesting</h4>
<p><strong>Variable:</strong> <code>HARVEST_VH1</code><br />
<strong>Original Units:</strong> Dimensionless fraction (0-1)<br />
<strong>Output Units:</strong> km² (after processing)<br />
<strong>Description:</strong> Very heavy harvest intensity 1 - fraction of forest harvested<br />
<strong>Output Column:</strong> <code>HARVEST_VH1_AREA (km^2)</code></p>
<p><strong>Variable:</strong> <code>HARVEST_VH2</code><br />
<strong>Original Units:</strong> Dimensionless fraction (0-1)<br />
<strong>Output Units:</strong> km² (after processing)<br />
<strong>Description:</strong> Very heavy harvest intensity 2 - fraction of forest harvested<br />
<strong>Output Column:</strong> <code>HARVEST_VH2_AREA (km^2)</code></p>
<p><strong>Variable:</strong> <code>HARVEST_SH1</code><br />
<strong>Original Units:</strong> Dimensionless fraction (0-1)<br />
<strong>Output Units:</strong> km² (after processing)<br />
<strong>Description:</strong> Secondary heavy harvest 1 - fraction of forest harvested<br />
<strong>Output Column:</strong> <code>HARVEST_SH1_AREA (km^2)</code></p>
<p><strong>Variable:</strong> <code>HARVEST_SH2</code><br />
<strong>Original Units:</strong> Dimensionless fraction (0-1)<br />
<strong>Output Units:</strong> km² (after processing)<br />
<strong>Description:</strong> Secondary heavy harvest 2 - fraction of forest harvested<br />
<strong>Output Column:</strong> <code>HARVEST_SH2_AREA (km^2)</code></p>
<p><strong>Variable:</strong> <code>HARVEST_SH3</code><br />
<strong>Original Units:</strong> Dimensionless fraction (0-1)<br />
<strong>Output Units:</strong> km² (after processing)<br />
<strong>Description:</strong> Secondary heavy harvest 3 - fraction of forest harvested<br />
<strong>Output Column:</strong> <code>HARVEST_SH3_AREA (km^2)</code></p>
<p><strong>Harvest Calculation:</strong></p>
<div class="codehilite"><pre><span></span><code>HARVEST_*_AREA (km²) = HARVEST_* × FOREST_AREA (km²)
</code></pre></div>

<h4>Vegetation Cover</h4>
<p><strong>Variable:</strong> <code>PCT_NATVEG</code><br />
<strong>Original Units:</strong> Percent (0-100)<br />
<strong>Output Units:</strong> Fraction (0-1)<br />
<strong>Description:</strong> Percentage of grid cell covered by natural vegetation<br />
<strong>Output Column:</strong> <code>FRAC_VEG</code></p>
<p><strong>Variable:</strong> <code>PCT_NAT_PFT</code><br />
<strong>Original Units:</strong> Percent (0-100)<br />
<strong>Output Units:</strong> km² (individual PFT areas)<br />
<strong>Description:</strong> Percentage of each plant functional type<br />
<strong>Output Columns:</strong> Individual and aggregated PFT areas</p>
<hr />
<h3>Derived Variables</h3>
<p>These are calculated by the script from other variables:</p>
<h4>Total Harvest Area</h4>
<p><strong>Variable:</strong> Automatically created<br />
<strong>Output Column:</strong> <code>HARVEST_AREA (km^2)</code><br />
<strong>Description:</strong> Total forest area harvested (sum of all harvest types)</p>
<p><strong>Calculation:</strong></p>
<div class="codehilite"><pre><span></span><code>HARVEST_AREA (km²) = HARVEST_VH1_AREA + HARVEST_VH2_AREA + 
                      HARVEST_SH1_AREA + HARVEST_SH2_AREA + HARVEST_SH3_AREA
</code></pre></div>

<h4>Grid Cell Area</h4>
<p><strong>Variable:</strong> Automatically included<br />
<strong>Output Column:</strong> <code>AREA (km^2)</code><br />
<strong>Description:</strong> Total grid cell area</p>
<h4>PFT Areas</h4>
<p><strong>Variables:</strong> Automatically calculated when PCT_NAT_PFT requested<br />
<strong>Output Columns:</strong><br />
- Individual PFTs: <code>PFT_1_AREA (km^2)</code> through <code>PFT_16_AREA (km^2)</code><br />
- Aggregated groups:<br />
  - <code>BARE_AREA (km^2)</code> - Bare soil<br />
  - <code>FOREST_AREA (km^2)</code> - All tree PFTs (1-8)<br />
  - <code>SHRUB_AREA (km^2)</code> - All shrub PFTs (9-11)<br />
  - <code>GRASS_AREA (km^2)</code> - All grass PFTs (12-14)<br />
  - <code>CROP_AREA (km^2)</code> - Crop PFT (15)</p>
<p><strong>17 PFTs in E3SM:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="mi">0</span><span class="o">:</span><span class="w">      </span><span class="n">Bare</span><span class="w"> </span><span class="n">soil</span>
<span class="mi">1</span><span class="o">-</span><span class="mi">8</span><span class="o">:</span><span class="w">    </span><span class="n">Trees</span><span class="w"> </span><span class="o">(</span><span class="mi">8</span><span class="w"> </span><span class="n">types</span><span class="o">)</span>
<span class="mi">9</span><span class="o">-</span><span class="mi">11</span><span class="o">:</span><span class="w">   </span><span class="n">Shrubs</span><span class="w"> </span><span class="o">(</span><span class="mi">3</span><span class="w"> </span><span class="n">types</span><span class="o">)</span>
<span class="mi">12</span><span class="o">-</span><span class="mi">14</span><span class="o">:</span><span class="w">  </span><span class="n">Grasses</span><span class="w"> </span><span class="o">(</span><span class="mi">3</span><span class="w"> </span><span class="n">types</span><span class="o">)</span>
<span class="mi">15</span><span class="o">:</span><span class="w">     </span><span class="n">Crop</span>
<span class="mi">16</span><span class="o">:</span><span class="w">     </span><span class="n">Empty</span><span class="w"> </span><span class="o">(</span><span class="n">ignored</span><span class="o">)</span>
</code></pre></div>

<p><strong>Calculation:</strong></p>
<div class="codehilite"><pre><span></span><code>PFT_AREA (km²) = AREA (km²) × FRAC_VEG × PFT_fraction
</code></pre></div>

<hr />
<h2>Variable Processing</h2>
<h3>Automatic Processing Steps</h3>
<p>The script performs several automatic processing steps:</p>
<h4>1. PFT Data Inclusion</h4>
<p><strong>Automatic Action:</strong> If any grazing or harvest variable is requested, script automatically includes <code>PCT_NAT_PFT</code> and <code>PCT_NATVEG</code></p>
<p><strong>Reason:</strong> Needed to convert fractions to areas</p>
<p><strong>Example:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1">// You specify:</span>
<span class="nt">&quot;variables&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;GRAZING&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;HARVEST_VH1&quot;</span><span class="p">]</span>

<span class="c1">// Script automatically adds:</span>
<span class="c1">// - PCT_NATVEG</span>
<span class="c1">// - PCT_NAT_PFT</span>
</code></pre></div>

<hr />
<h4>2. Duplicate Time Value Removal</h4>
<p><strong>Processing:</strong> Removes duplicate time coordinate values, keeping last occurrence</p>
<p><strong>Reason:</strong> Simulation restarts can create duplicate time entries</p>
<p><strong>Example:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="n">Before</span><span class="o">:</span><span class="w"> </span><span class="n">time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="mi">2015</span><span class="o">,</span><span class="w"> </span><span class="mi">2016</span><span class="o">,</span><span class="w"> </span><span class="mi">2016</span><span class="o">*,</span><span class="w"> </span><span class="mi">2017</span><span class="o">]</span><span class="w">  </span><span class="o">(*</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">restart</span><span class="o">)</span>
<span class="n">After</span><span class="o">:</span><span class="w">  </span><span class="n">time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="mi">2015</span><span class="o">,</span><span class="w"> </span><span class="mi">2016</span><span class="o">,</span><span class="w"> </span><span class="mi">2017</span><span class="o">]</span>
</code></pre></div>

<hr />
<h4>3. Vegetation Fraction Calculation</h4>
<p><strong>Input:</strong> <code>PCT_NATVEG</code> (percent, 0-100)</p>
<p><strong>Processing:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="n">FRAC_VEG</span> <span class="o">=</span> <span class="n">PCT_NATVEG</span> <span class="o">/</span> <span class="mi">100</span>
</code></pre></div>

<p><strong>Output:</strong> <code>FRAC_VEG</code> (fraction, 0-1)</p>
<hr />
<h4>4. PFT Area Calculation</h4>
<p><strong>For Each PFT:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="n">PFT_AREA</span> <span class="p">(</span><span class="n">km</span><span class="err">²</span><span class="p">)</span> <span class="o">=</span> <span class="n">AREA</span> <span class="p">(</span><span class="n">km</span><span class="err">²</span><span class="p">)</span> <span class="err">×</span> <span class="n">FRAC_VEG</span> <span class="err">×</span> <span class="p">(</span><span class="n">PCT_NAT_PFT</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span>
</code></pre></div>

<p><strong>Aggregated Groups:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="n">FOREST_AREA</span> <span class="p">(</span><span class="n">km</span><span class="err">²</span><span class="p">)</span> <span class="o">=</span> <span class="nb">sum</span> <span class="n">of</span> <span class="n">PFTs</span> <span class="mi">1</span><span class="o">-</span><span class="mi">8</span>
<span class="n">SHRUB_AREA</span> <span class="p">(</span><span class="n">km</span><span class="err">²</span><span class="p">)</span> <span class="o">=</span> <span class="nb">sum</span> <span class="n">of</span> <span class="n">PFTs</span> <span class="mi">9</span><span class="o">-</span><span class="mi">11</span>
<span class="n">GRASS_AREA</span> <span class="p">(</span><span class="n">km</span><span class="err">²</span><span class="p">)</span> <span class="o">=</span> <span class="nb">sum</span> <span class="n">of</span> <span class="n">PFTs</span> <span class="mi">12</span><span class="o">-</span><span class="mi">14</span>
</code></pre></div>

<hr />
<h4>5. Grazing Area Conversion</h4>
<p><strong>Input:</strong> <code>GRAZING</code> (fraction, 0-1)</p>
<p><strong>Processing:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="n">GRAZING_AREA</span> <span class="p">(</span><span class="n">km</span><span class="err">²</span><span class="p">)</span> <span class="o">=</span> <span class="n">GRAZING</span> <span class="err">×</span> <span class="n">GRASS_AREA</span> <span class="p">(</span><span class="n">km</span><span class="err">²</span><span class="p">)</span>
</code></pre></div>

<p><strong>Reason:</strong> Grazing only occurs on grasslands</p>
<p><strong>Output:</strong> <code>GRAZING_AREA (km^2)</code> column</p>
<hr />
<h4>6. Harvest Area Conversion</h4>
<p><strong>Input:</strong> <code>HARVEST_*</code> variables (fractions, 0-1)</p>
<p><strong>Processing:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="n">HARVEST_VH1_AREA</span> <span class="p">(</span><span class="n">km</span><span class="err">²</span><span class="p">)</span> <span class="o">=</span> <span class="n">HARVEST_VH1</span> <span class="err">×</span> <span class="n">FOREST_AREA</span> <span class="p">(</span><span class="n">km</span><span class="err">²</span><span class="p">)</span>
<span class="n">HARVEST_VH2_AREA</span> <span class="p">(</span><span class="n">km</span><span class="err">²</span><span class="p">)</span> <span class="o">=</span> <span class="n">HARVEST_VH2</span> <span class="err">×</span> <span class="n">FOREST_AREA</span> <span class="p">(</span><span class="n">km</span><span class="err">²</span><span class="p">)</span>
<span class="n">HARVEST_SH1_AREA</span> <span class="p">(</span><span class="n">km</span><span class="err">²</span><span class="p">)</span> <span class="o">=</span> <span class="n">HARVEST_SH1</span> <span class="err">×</span> <span class="n">FOREST_AREA</span> <span class="p">(</span><span class="n">km</span><span class="err">²</span><span class="p">)</span>
<span class="n">HARVEST_SH2_AREA</span> <span class="p">(</span><span class="n">km</span><span class="err">²</span><span class="p">)</span> <span class="o">=</span> <span class="n">HARVEST_SH2</span> <span class="err">×</span> <span class="n">FOREST_AREA</span> <span class="p">(</span><span class="n">km</span><span class="err">²</span><span class="p">)</span>
<span class="n">HARVEST_SH3_AREA</span> <span class="p">(</span><span class="n">km</span><span class="err">²</span><span class="p">)</span> <span class="o">=</span> <span class="n">HARVEST_SH3</span> <span class="err">×</span> <span class="n">FOREST_AREA</span> <span class="p">(</span><span class="n">km</span><span class="err">²</span><span class="p">)</span>
</code></pre></div>

<p><strong>Reason:</strong> Harvesting only occurs on forests</p>
<p><strong>Output:</strong> Individual <code>HARVEST_*_AREA (km^2)</code> columns</p>
<hr />
<h4>7. Total Harvest Calculation</h4>
<p><strong>Processing:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="n">HARVEST_AREA</span> <span class="p">(</span><span class="n">km</span><span class="err">²</span><span class="p">)</span> <span class="o">=</span> <span class="nb">sum</span> <span class="n">of</span> <span class="nb">all</span> <span class="n">HARVEST_</span><span class="o">*</span><span class="n">_AREA</span> <span class="n">columns</span> <span class="n">present</span>
</code></pre></div>

<p><strong>Output:</strong> <code>HARVEST_AREA (km^2)</code> column (placed after individual harvest columns)</p>
<hr />
<h4>8. Spatial Aggregation</h4>
<p><strong>For All Variables:</strong><br />
- Sum over all latitude/longitude coordinates<br />
- Creates global or regional totals</p>
<p><strong>For FRAC_VEG:</strong><br />
- Calculate area-weighted mean<br />
- Formula: <code>Σ(FRAC_VEG × AREA) / Σ(AREA)</code></p>
<hr />
<h2>Regional Analysis</h2>
<h3>How Regional Filtering Works</h3>
<ol>
<li><strong>Load NetCDF file</strong></li>
<li><strong>Apply regional bounds</strong> (if region specified)<br />
   - Filter gridcells outside lat/lon bounding box</li>
<li><strong>Process data</strong> for regional gridcells only</li>
<li><strong>Aggregate</strong> over regional gridcells</li>
</ol>
<h3>Regional Bounds</h3>
<p>Defined by lat/lon bounding boxes in <code>utility_e3sm_netcdf.py</code>:</p>
<p><strong>Example Regions:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="n">amazon</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">85</span><span class="err">°</span><span class="p">,</span> <span class="o">-</span><span class="mi">35</span><span class="err">°</span><span class="p">]</span> <span class="n">longitude</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">25</span><span class="err">°</span><span class="p">,</span> <span class="mi">15</span><span class="err">°</span><span class="p">]</span> <span class="n">latitude</span>
<span class="n">conus</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">125.25</span><span class="err">°</span><span class="p">,</span> <span class="o">-</span><span class="mf">66.25</span><span class="err">°</span><span class="p">]</span> <span class="n">longitude</span><span class="p">,</span> <span class="p">[</span><span class="mf">23.25</span><span class="err">°</span><span class="p">,</span> <span class="mf">54.75</span><span class="err">°</span><span class="p">]</span> <span class="n">latitude</span>
</code></pre></div>

<h3>Example: Amazon Harvest Analysis</h3>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;simulation_path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/path/to/simulation&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;output_file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;./amazon_harvest.dat&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;variables&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;HARVEST_SH1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;HARVEST_SH2&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;HARVEST_SH3&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;HARVEST_VH1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;HARVEST_VH2&quot;</span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;region&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;amazon&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;start_year&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2015</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;end_year&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2100</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Output:</strong><br />
- Harvest areas for Amazon Basin only<br />
- Regional totals (not global)</p>
<hr />
<h2>JSON Configuration Examples</h2>
<h3>Example 1: Global Grazing and Harvest</h3>
<p><strong>Purpose:</strong> Extract all grazing and harvest activities globally</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;simulation_path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/lcrc/group/e3sm/ac.eva.sinha/20240730_SSP245_ZATM_BGC_ne30pg2_f09_oEC60to30v3_without_feedbacks/run&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;output_file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;./../2025_DiVittorio_et_al_e3sm/control_time_series_surfdata_iESM_dyn_20240730.dat&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;variables&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;GRAZING&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;HARVEST_SH1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;HARVEST_SH2&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;HARVEST_SH3&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;HARVEST_VH1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;HARVEST_VH2&quot;</span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;start_year&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2015</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;end_year&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2100</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>What it does:</strong><br />
- Extracts grazing on grasslands<br />
- Extracts all 5 harvest types on forests<br />
- Calculates total harvest area automatically<br />
- Global aggregation (no regional filtering)<br />
- 86 years of annual data (2015-2100)</p>
<p><strong>Output Columns:</strong></p>
<div class="codehilite"><pre><span></span><code>Year
FRAC_VEG
AREA (km^2)
PFT_1_AREA (km^2) ... PFT_16_AREA (km^2)
BARE_AREA (km^2)
FOREST_AREA (km^2)
SHRUB_AREA (km^2)
GRASS_AREA (km^2)
CROP_AREA (km^2)
GRAZING_AREA (km^2)
HARVEST_SH1_AREA (km^2)
HARVEST_SH2_AREA (km^2)
HARVEST_SH3_AREA (km^2)
HARVEST_VH1_AREA (km^2)
HARVEST_VH2_AREA (km^2)
HARVEST_AREA (km^2)
</code></pre></div>

<hr />
<h3>Example 2: Regional Analysis (Amazon)</h3>
<p><strong>Purpose:</strong> Focus on Amazon Basin grazing and harvest</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;simulation_path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/lcrc/group/e3sm/ac.eva.sinha/20240730_SSP245_ZATM_BGC_ne30pg2_f09_oEC60to30v3_without_feedbacks/run&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;output_file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;./../2025_DiVittorio_et_al_e3sm/control_time_series_surfdata_iESM_dyn_20240730_amazon.dat&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;variables&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;GRAZING&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;HARVEST_SH1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;HARVEST_SH2&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;HARVEST_SH3&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;HARVEST_VH1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;HARVEST_VH2&quot;</span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;region&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;amazon&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;start_year&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2015</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;end_year&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2100</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>What it does:</strong><br />
- Filters to Amazon Basin coordinates<br />
- Extracts grazing and harvest for Amazon only<br />
- Regional totals (not global)<br />
- Same variables as Example 1, but for Amazon</p>
<p><strong>Use Case:</strong><br />
- Analyzing deforestation in Amazon<br />
- Tracking agricultural expansion<br />
- Regional land use impacts</p>
<hr />
<h3>Example 3: Grazing Only</h3>
<p><strong>Purpose:</strong> Extract only grazing data (no harvest)</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;simulation_path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/lcrc/group/e3sm/simulation/run&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;output_file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;./grazing_only.dat&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;variables&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;GRAZING&quot;</span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;start_year&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2015</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;end_year&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2100</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>What it does:</strong><br />
- Extracts grazing fraction<br />
- Automatically includes PCT_NAT_PFT and PCT_NATVEG<br />
- Calculates grass area<br />
- Converts grazing to area (km²)</p>
<p><strong>Output Focus:</strong><br />
- <code>GRAZING_AREA (km^2)</code><br />
- <code>GRASS_AREA (km^2)</code><br />
- PFT areas included for context</p>
<hr />
<h3>Example 4: Harvest Only</h3>
<p><strong>Purpose:</strong> Extract only harvest activities (no grazing)</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;simulation_path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/lcrc/group/e3sm/simulation/run&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;output_file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;./harvest_only.dat&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;variables&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;HARVEST_SH1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;HARVEST_SH2&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;HARVEST_SH3&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;HARVEST_VH1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;HARVEST_VH2&quot;</span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;start_year&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2015</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;end_year&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2100</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>What it does:</strong><br />
- Extracts all 5 harvest types<br />
- Calculates total harvest automatically<br />
- Converts to forest area harvested (km²)</p>
<p><strong>Output Focus:</strong><br />
- Individual harvest areas<br />
- <code>HARVEST_AREA (km^2)</code> (total)<br />
- <code>FOREST_AREA (km^2)</code> for context</p>
<hr />
<h3>Example 5: Short Time Period for Testing</h3>
<p><strong>Purpose:</strong> Quick test with subset of data</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;simulation_path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/lcrc/group/e3sm/simulation/run&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;output_file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;./test_surfdata.dat&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;variables&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;GRAZING&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;HARVEST_VH1&quot;</span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;start_year&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2015</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;end_year&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2020</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>What it does:</strong><br />
- Only 6 years of data (2015-2020)<br />
- Fast execution for testing<br />
- Verify configuration before full run<br />
- Two representative variables</p>
<hr />
<h3>Example 6: CSV Output</h3>
<p><strong>Purpose:</strong> Output in CSV format for easy import to other tools</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;simulation_path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/lcrc/group/e3sm/simulation/run&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;output_file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;./harvest_grazing.csv&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;variables&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;GRAZING&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;HARVEST_SH1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;HARVEST_SH2&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;HARVEST_SH3&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;HARVEST_VH1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;HARVEST_VH2&quot;</span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;start_year&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2015</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;end_year&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2100</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;write_to_csv&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>What it does:</strong><br />
- Same as Example 1 but CSV output<br />
- Comma-separated values<br />
- Easy import to Excel, R, Python pandas</p>
<hr />
<h3>Example 7: Multiple Regions in One JSON</h3>
<p><strong>Purpose:</strong> Process multiple regions with one command</p>
<div class="codehilite"><pre><span></span><code><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;simulation_path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/lcrc/group/e3sm/simulation/run&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;output_file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;./global_harvest_grazing.dat&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;variables&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;GRAZING&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;HARVEST_VH1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;HARVEST_VH2&quot;</span><span class="p">],</span>
<span class="w">        </span><span class="nt">&quot;start_year&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2015</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;end_year&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2100</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;simulation_path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/lcrc/group/e3sm/simulation/run&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;output_file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;./amazon_harvest_grazing.dat&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;variables&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;GRAZING&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;HARVEST_VH1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;HARVEST_VH2&quot;</span><span class="p">],</span>
<span class="w">        </span><span class="nt">&quot;region&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;amazon&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;start_year&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2015</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;end_year&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2100</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;simulation_path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/lcrc/group/e3sm/simulation/run&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;output_file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;./conus_harvest_grazing.dat&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;variables&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;GRAZING&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;HARVEST_VH1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;HARVEST_VH2&quot;</span><span class="p">],</span>
<span class="w">        </span><span class="nt">&quot;region&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;conus&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;start_year&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2015</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;end_year&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2100</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">]</span>
</code></pre></div>

<p><strong>What it does:</strong><br />
- Processes three configurations in one run<br />
- Global, Amazon, and CONUS analyses<br />
- Efficient batch processing</p>
<hr />
<h2>Output Files</h2>
<h3>Fixed-Width Format (.dat)</h3>
<p><strong>Default format</strong> - Human-readable with aligned columns</p>
<p><strong>Example:</strong></p>
<div class="codehilite"><pre><span></span><code>Year  FRAC_VEG  GRAZING_AREA (km^2)  HARVEST_VH1_AREA (km^2)  HARVEST_AREA (km^2)
2015    0.6234        1234.56                567.89                2345.67
2016    0.6198        1289.34                578.12                2401.23
2017    0.6175        1301.45                589.34                2456.78
</code></pre></div>

<p><strong>Characteristics:</strong><br />
- Spaces used for padding<br />
- Columns aligned<br />
- Easy to read<br />
- Standard for E3SM analysis</p>
<hr />
<h3>CSV Format (.csv)</h3>
<p><strong>Optional format</strong> - Machine-readable</p>
<p><strong>Example:</strong></p>
<div class="codehilite"><pre><span></span><code>Year,FRAC_VEG,GRAZING_AREA (km^2),HARVEST_VH1_AREA (km^2),HARVEST_AREA (km^2)
2015,0.6234,1234.56,567.89,2345.67
2016,0.6198,1289.34,578.12,2401.23
2017,0.6175,1301.45,589.34,2456.78
</code></pre></div>

<p><strong>Characteristics:</strong><br />
- Comma-separated<br />
- Smaller file size<br />
- Easy import to Excel, pandas, R</p>
<hr />
<h3>Output Structure</h3>
<p><strong>Temporal Organization:</strong><br />
- One row per year<br />
- Sorted by Year<br />
- Annual time series (not monthly)</p>
<p><strong>Column Organization:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="p">[</span><span class="n">Year</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">FRAC_VEG</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">AREA</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">PFT</span><span class="w"> </span><span class="n">areas</span><span class="p">...]</span><span class="w"> </span><span class="p">[</span><span class="n">Grazing</span><span class="w"> </span><span class="n">area</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">Harvest</span><span class="w"> </span><span class="n">areas</span><span class="p">...]</span><span class="w"> </span><span class="p">[</span><span class="n">Total</span><span class="w"> </span><span class="n">harvest</span><span class="p">]</span>
</code></pre></div>

<p><strong>Column Headers:</strong></p>
<div class="codehilite"><pre><span></span><code>Variable_name (units)

Examples:
Year
FRAC_VEG
GRAZING_AREA (km^2)
HARVEST_VH1_AREA (km^2)
HARVEST_AREA (km^2)
FOREST_AREA (km^2)
</code></pre></div>

<hr />
<h2>Troubleshooting</h2>
<h3>Issue 1: File Not Found</h3>
<p><strong>Error Message:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="n">FileNotFoundError</span><span class="o">:</span><span class="w"> </span><span class="n">surfdata_iESM_dyn</span><span class="o">.</span><span class="na">nc</span>
</code></pre></div>

<p><strong>Causes:</strong><br />
- Incorrect <code>simulation_path</code><br />
- File doesn't exist<br />
- Wrong simulation directory</p>
<p><strong>Solutions:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Check directory exists</span>
ls<span class="w"> </span>-la<span class="w"> </span>/path/to/simulation/

<span class="c1"># Check for surfdata file</span>
ls<span class="w"> </span>/path/to/simulation/surfdata_iESM_dyn.nc

<span class="c1"># Verify exact filename</span>
<span class="c1"># Must be: surfdata_iESM_dyn.nc</span>
</code></pre></div>

<hr />
<h3>Issue 2: Variable Not Found</h3>
<p><strong>Error Message:</strong></p>
<div class="codehilite"><pre><span></span><code>KeyError: &#39;VARIABLE_NAME&#39;
</code></pre></div>

<p><strong>Causes:</strong><br />
- Variable not in surfdata file<br />
- Typo in variable name<br />
- File doesn't contain requested variable</p>
<p><strong>Solutions:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Check what variables are in file</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">xarray</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">xr</span>
<span class="n">ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="s1">&#39;surfdata_iESM_dyn.nc&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">data_vars</span><span class="p">))</span>

<span class="c1"># Common variables:</span>
<span class="c1"># GRAZING, HARVEST_VH1, HARVEST_VH2, HARVEST_SH1, HARVEST_SH2, HARVEST_SH3</span>
<span class="c1"># PCT_NATVEG, PCT_NAT_PFT</span>
</code></pre></div>

<hr />
<h3>Issue 3: Memory Error</h3>
<p><strong>Error Message:</strong></p>
<div class="codehilite"><pre><span></span><code>MemoryError
</code></pre></div>

<p><strong>Causes:</strong><br />
- Large surfdata file<br />
- Long time series<br />
- Many variables<br />
- Insufficient RAM</p>
<p><strong>Solutions:</strong><br />
1. <strong>Reduce year range:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nt">&quot;start_year&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2015</span><span class="p">,</span>
<span class="nt">&quot;end_year&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2050</span><span class="w">  </span><span class="c1">// Instead of 2100</span>
</code></pre></div>

<ol start="2">
<li><strong>Process fewer variables:</strong></li>
</ol>
<div class="codehilite"><pre><span></span><code><span class="nt">&quot;variables&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;GRAZING&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;HARVEST_VH1&quot;</span><span class="p">]</span><span class="w">  </span><span class="c1">// Instead of all harvest types</span>
</code></pre></div>

<ol start="3">
<li>
<p><strong>Run on larger memory machine</strong></p>
</li>
<li>
<p><strong>Process in chunks:</strong></p>
</li>
</ol>
<div class="codehilite"><pre><span></span><code><span class="c1">// Config 1</span>
<span class="p">{</span><span class="nt">&quot;start_year&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2015</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;end_year&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2050</span><span class="p">}</span>

<span class="c1">// Config 2</span>
<span class="p">{</span><span class="nt">&quot;start_year&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2051</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;end_year&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2100</span><span class="p">}</span>
</code></pre></div>

<hr />
<h3>Issue 4: Duplicate Time Values</h3>
<p><strong>Error Message:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="n">Warning</span><span class="o">:</span><span class="w"> </span><span class="n">Duplicate</span><span class="w"> </span><span class="n">time</span><span class="w"> </span><span class="n">values</span><span class="w"> </span><span class="n">found</span>
</code></pre></div>

<p><strong>Cause:</strong><br />
- Simulation restarts create duplicate time entries<br />
- Script handles this automatically</p>
<p><strong>Behavior:</strong><br />
- Script removes duplicates, keeping last occurrence<br />
- No user action needed<br />
- Informational warning only</p>
<hr />
<h3>Issue 5: Slow Execution</h3>
<p><strong>Symptom:</strong> Script taking longer than expected</p>
<p><strong>Causes:</strong><br />
- Large surfdata file<br />
- Many years to process<br />
- Limited CPU cores</p>
<p><strong>Solutions:</strong></p>
<ol>
<li>
<p><strong>Parallel processing (already built-in):</strong><br />
Script automatically uses all CPU cores</p>
</li>
<li>
<p><strong>Reduce year range:</strong></p>
</li>
</ol>
<div class="codehilite"><pre><span></span><code><span class="nt">&quot;start_year&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2080</span><span class="p">,</span>
<span class="nt">&quot;end_year&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2100</span><span class="w">  </span><span class="c1">// Only 21 years</span>
</code></pre></div>

<ol start="3">
<li>
<p><strong>Run on HPC:</strong><br />
Use high-performance computing cluster</p>
</li>
<li>
<p><strong>Monitor progress:</strong><br />
Script prints completion time</p>
</li>
</ol>
<p><strong>Typical Timing:</strong><br />
- 86 years, 6 variables: 30-120 seconds<br />
- Depends on file size and CPU count</p>
<hr />
<h3>Issue 6: Regional Bounds Error</h3>
<p><strong>Error Message:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="n">Did</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="n">recognize</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">selected</span><span class="w"> </span><span class="n">region</span><span class="o">!</span>
</code></pre></div>

<p><strong>Cause:</strong><br />
- Region name typo<br />
- Region not in predefined list</p>
<p><strong>Solutions:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Check spelling (case-sensitive)</span>
<span class="nt">&quot;region&quot;</span><span class="p">:</span><span class="w"> </span><span class="nt">&quot;amazon&quot;</span><span class="w">  </span><span class="c1">// Correct</span>
<span class="nt">&quot;region&quot;</span><span class="p">:</span><span class="w"> </span><span class="nt">&quot;Amazon&quot;</span><span class="w">  </span><span class="c1">// Wrong</span>

<span class="c1">// Use null for global</span>
<span class="nt">&quot;region&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>

<span class="c1">// Check available regions in utility_e3sm_netcdf.py</span>
</code></pre></div>

<hr />
<h2>Best Practices</h2>
<h3>1. Directory Organization</h3>
<p><strong>Recommended Structure:</strong></p>
<div class="codehilite"><pre><span></span><code>project/
├── simulations/
│   ├── control/
│   │   └── run/
│   │       └── surfdata_iESM_dyn.nc
│   ├── scenario1/
│   │   └── run/
│   │       └── surfdata_iESM_dyn.nc
│   └── scenario2/
│       └── run/
│           └── surfdata_iESM_dyn.nc
├── output/
│   ├── surfdata_time_series/
│   └── processed/
├── configs/
│   └── surfdata_extraction_configs.json
└── analysis/
    └── scripts/
</code></pre></div>

<hr />
<h3>2. Configuration File Organization</h3>
<p><strong>Use descriptive names:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="n">configs</span><span class="o">/</span>
<span class="err">├──</span><span class="w"> </span><span class="n">global_harvest_grazing_extraction</span><span class="p">.</span><span class="n">json</span>
<span class="err">├──</span><span class="w"> </span><span class="n">regional_amazon_extraction</span><span class="p">.</span><span class="n">json</span>
<span class="err">└──</span><span class="w"> </span><span class="n">testing_2015_2020</span><span class="p">.</span><span class="n">json</span>
</code></pre></div>

<p><strong>Group related extractions:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="p">[</span>
<span class="w">    </span><span class="p">{</span><span class="nt">&quot;output_file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;control_global.dat&quot;</span><span class="p">,</span><span class="w"> </span><span class="err">...</span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="nt">&quot;output_file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;control_amazon.dat&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;region&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;amazon&quot;</span><span class="p">,</span><span class="w"> </span><span class="err">...</span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="nt">&quot;output_file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;scenario_global.dat&quot;</span><span class="p">,</span><span class="w"> </span><span class="err">...</span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="nt">&quot;output_file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;scenario_amazon.dat&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;region&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;amazon&quot;</span><span class="p">,</span><span class="w"> </span><span class="err">...</span><span class="p">}</span>
<span class="p">]</span>
</code></pre></div>

<hr />
<h3>3. Testing Strategy</h3>
<p><strong>Start small:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;start_year&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2015</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;end_year&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2016</span><span class="p">,</span><span class="w">  </span><span class="c1">// Just 2 years</span>
<span class="w">    </span><span class="nt">&quot;variables&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;GRAZING&quot;</span><span class="p">]</span><span class="w">  </span><span class="c1">// One variable</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Then scale up:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;start_year&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2015</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;end_year&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2100</span><span class="p">,</span><span class="w">  </span><span class="c1">// Full range</span>
<span class="w">    </span><span class="nt">&quot;variables&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;GRAZING&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;HARVEST_VH1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;HARVEST_VH2&quot;</span><span class="p">,</span><span class="w"> </span><span class="err">...</span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div>

<hr />
<h3>4. Variable Selection</h3>
<p><strong>All human activities (comprehensive):</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nt">&quot;variables&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;GRAZING&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;HARVEST_SH1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;HARVEST_SH2&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;HARVEST_SH3&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;HARVEST_VH1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;HARVEST_VH2&quot;</span><span class="p">]</span>
</code></pre></div>

<p><strong>Grazing focus:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nt">&quot;variables&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;GRAZING&quot;</span><span class="p">]</span>
</code></pre></div>

<p><strong>Harvest focus:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nt">&quot;variables&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;HARVEST_SH1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;HARVEST_SH2&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;HARVEST_SH3&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;HARVEST_VH1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;HARVEST_VH2&quot;</span><span class="p">]</span>
</code></pre></div>

<p><strong>Simplified (only major harvest):</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nt">&quot;variables&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;HARVEST_VH1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;HARVEST_VH2&quot;</span><span class="p">]</span>
</code></pre></div>

<hr />
<h3>5. Regional vs Global</h3>
<p><strong>When to use global:</strong><br />
- Earth system scale analysis<br />
- Total land use impacts<br />
- Global harvest/grazing trends</p>
<p><strong>When to use regional:</strong><br />
- Hotspot analysis (Amazon deforestation)<br />
- Regional impacts (CONUS agriculture)<br />
- Policy-relevant scales</p>
<p><strong>Multiple regions:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="p">[</span>
<span class="w">    </span><span class="p">{</span><span class="nt">&quot;output_file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;global.dat&quot;</span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="nt">&quot;output_file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;amazon.dat&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;region&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;amazon&quot;</span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="nt">&quot;output_file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;conus.dat&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;region&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;conus&quot;</span><span class="p">}</span>
<span class="p">]</span>
</code></pre></div>

<hr />
<h3>6. Performance Optimization</h3>
<p><strong>Parallel processing:</strong><br />
- Script uses all CPU cores automatically<br />
- One process per year<br />
- Scales well with more cores</p>
<p><strong>Efficient configuration:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Good: One JSON with multiple outputs</span>
<span class="p">[</span>
<span class="w">    </span><span class="p">{</span><span class="nt">&quot;output_file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;control.dat&quot;</span><span class="p">,</span><span class="w"> </span><span class="err">...</span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="nt">&quot;output_file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;scenario.dat&quot;</span><span class="p">,</span><span class="w"> </span><span class="err">...</span><span class="p">}</span>
<span class="p">]</span>

<span class="c1">// Less efficient: Multiple script calls</span>
<span class="err">py</span><span class="kc">t</span><span class="err">ho</span><span class="kc">n</span><span class="w"> </span><span class="err">scrip</span><span class="kc">t</span><span class="err">.py</span><span class="w"> </span><span class="err">co</span><span class="kc">nf</span><span class="err">ig</span><span class="mf">1.</span><span class="err">jso</span><span class="kc">n</span>
<span class="err">py</span><span class="kc">t</span><span class="err">ho</span><span class="kc">n</span><span class="w"> </span><span class="err">scrip</span><span class="kc">t</span><span class="err">.py</span><span class="w"> </span><span class="err">co</span><span class="kc">nf</span><span class="err">ig</span><span class="mf">2.</span><span class="err">jso</span><span class="kc">n</span>
</code></pre></div>

<hr />
<h3>7. Data Validation</h3>
<p><strong>After extraction, verify:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;output.csv&#39;</span><span class="p">)</span>  <span class="c1"># or read_fwf for .dat</span>

<span class="c1"># Check dimensions</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Shape: </span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="c1"># Expected: 86 rows for 2015-2100</span>

<span class="c1"># Check for missing values</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>

<span class="c1"># Check value ranges</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">describe</span><span class="p">())</span>

<span class="c1"># Verify temporal continuity</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
<span class="c1"># Should be consecutive years</span>
</code></pre></div>

<p><strong>Check totals:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Total harvest should equal sum of individual harvests</span>
<span class="n">harvest_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="s1">&#39;HARVEST_&#39;</span> <span class="ow">in</span> <span class="n">col</span> <span class="ow">and</span> <span class="n">col</span> <span class="o">!=</span> <span class="s1">&#39;HARVEST_AREA (km^2)&#39;</span><span class="p">]</span>
<span class="n">calculated_total</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">harvest_cols</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">reported_total</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;HARVEST_AREA (km^2)&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Match: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">calculated_total</span><span class="p">,</span><span class="w"> </span><span class="n">reported_total</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<hr />
<h3>8. Reproducibility</h3>
<p><strong>Document your extraction:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;comment&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Harvest and grazing for control simulation&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;date_extracted&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2026-01-24&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;simulation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;SSP245_ZATM_BGC_without_feedbacks&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;simulation_path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/lcrc/group/e3sm/.../run&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="err">...</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Version control configurations:</strong></p>
<div class="codehilite"><pre><span></span><code>git<span class="w"> </span>add<span class="w"> </span>configs/
git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;Add surfdata extraction configs for control simulation&quot;</span>
</code></pre></div>

<hr />
<h2>Comparison with h0 Extraction Script</h2>
<h3>Key Differences</h3>
<table>
<thead>
<tr>
<th>Feature</th>
<th>e3sm_extract_time_series_h0.py</th>
<th>e3sm_extract_time_series_surfdata_iesm_dyn.py</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Input Files</strong></td>
<td>Multiple monthly NetCDF files (elm.h0.<em>, eam.h0.</em>)</td>
<td>Single NetCDF file (surfdata_iESM_dyn.nc)</td>
</tr>
<tr>
<td><strong>Temporal Resolution</strong></td>
<td>Monthly</td>
<td>Annual</td>
</tr>
<tr>
<td><strong>Variables</strong></td>
<td>Climate, carbon cycle (100+ available)</td>
<td>Human land management (6 main variables)</td>
</tr>
<tr>
<td><strong>File Type Config</strong></td>
<td><code>netcdf_substrings</code> (nested list)</td>
<td>Not needed (always surfdata file)</td>
</tr>
<tr>
<td><strong>Variables Config</strong></td>
<td><code>variables</code> (nested list, one per file type)</td>
<td><code>variables</code> (simple list)</td>
</tr>
<tr>
<td><strong>Aggregation Config</strong></td>
<td><code>lat_lon_aggregation_types</code> parameter</td>
<td>Always area-weighted sum</td>
</tr>
<tr>
<td><strong>Processing</strong></td>
<td>Optional (<code>process_variables</code>)</td>
<td>Automatic (always converts fractions to areas)</td>
</tr>
<tr>
<td><strong>Parallel Processing</strong></td>
<td>One process per file (per month per file type)</td>
<td>One process per year</td>
</tr>
<tr>
<td><strong>Output Frequency</strong></td>
<td>Monthly rows</td>
<td>Annual rows</td>
</tr>
</tbody>
</table>
<h3>When to Use Each Script</h3>
<p><strong>Use h0 script when:</strong><br />
- Need climate variables (temperature, precipitation)<br />
- Need carbon cycle fluxes (GPP, NPP, NBP)<br />
- Need monthly resolution<br />
- Analyzing atmosphere or land model outputs</p>
<p><strong>Use surfdata script when:</strong><br />
- Need human land management data<br />
- Need grazing information<br />
- Need wood harvest information<br />
- Analyzing E3SM-GCAM coupled simulations<br />
- Annual resolution sufficient</p>
<h3>Example Workflow Using Both Scripts</h3>
<div class="codehilite"><pre><span></span><code><span class="mf">1.</span><span class="w"> </span><span class="n">Extract</span><span class="w"> </span><span class="n">climate</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">carbon</span><span class="w"> </span><span class="n">cycle</span><span class="w"> </span><span class="p">(</span><span class="n">monthly</span><span class="p">):</span>
<span class="w">   </span><span class="n">python</span><span class="w"> </span><span class="n">e3sm_extract_time_series_h0</span><span class="mf">.</span><span class="n">py</span><span class="w"> </span><span class="n">h0_config</span><span class="mf">.</span><span class="n">json</span>
<span class="w">   </span><span class="err">→</span><span class="w"> </span><span class="n">Output</span><span class="p">:</span><span class="w"> </span><span class="n">Monthly</span><span class="w"> </span><span class="n">GPP</span><span class="p">,</span><span class="w"> </span><span class="n">NPP</span><span class="p">,</span><span class="w"> </span><span class="n">temperature</span><span class="p">,</span><span class="w"> </span><span class="n">precipitation</span>

<span class="mf">2.</span><span class="w"> </span><span class="n">Extract</span><span class="w"> </span><span class="n">human</span><span class="w"> </span><span class="n">land</span><span class="w"> </span><span class="n">management</span><span class="w"> </span><span class="p">(</span><span class="n">annual</span><span class="p">):</span>
<span class="w">   </span><span class="n">python</span><span class="w"> </span><span class="n">e3sm_extract_time_series_surfdata_iesm_dyn</span><span class="mf">.</span><span class="n">py</span><span class="w"> </span><span class="n">surfdata_config</span><span class="mf">.</span><span class="n">json</span>
<span class="w">   </span><span class="err">→</span><span class="w"> </span><span class="n">Output</span><span class="p">:</span><span class="w"> </span><span class="n">Annual</span><span class="w"> </span><span class="n">grazing</span><span class="p">,</span><span class="w"> </span><span class="n">harvest</span><span class="w"> </span><span class="n">areas</span>

<span class="mf">3.</span><span class="w"> </span><span class="n">Analyze</span><span class="w"> </span><span class="kr">toget</span><span class="n">her</span><span class="p">:</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Monthly</span><span class="w"> </span><span class="n">climate</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">carbon</span><span class="w"> </span><span class="n">dynamics</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Annual</span><span class="w"> </span><span class="n">human</span><span class="w"> </span><span class="n">activities</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Correlate</span><span class="w"> </span><span class="n">human</span><span class="w"> </span><span class="n">activities</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">ecosystem</span><span class="w"> </span><span class="n">responses</span>
</code></pre></div>

<hr />
<h2>Integration with Other Scripts</h2>
<h3>Typical E3SM-GCAM Analysis Workflow</h3>
<div class="codehilite"><pre><span></span><code><span class="mf">1.</span><span class="w"> </span><span class="kr">Run</span><span class="w"> </span><span class="n">E3SM</span><span class="o">-</span><span class="n">GCAM</span><span class="w"> </span><span class="n">coupled</span><span class="w"> </span><span class="n">simulation</span>
<span class="w">   </span><span class="err">↓</span><span class="w"> </span><span class="p">(</span><span class="n">Produces</span><span class="w"> </span><span class="n">surfdata_iESM_dyn</span><span class="mf">.</span><span class="n">nc</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">monthly</span><span class="w"> </span><span class="n">h0</span><span class="w"> </span><span class="n">files</span><span class="p">)</span>

<span class="mf">2</span><span class="n">a</span><span class="mf">.</span><span class="w"> </span><span class="n">e3sm_extract_time_series_h0</span><span class="mf">.</span><span class="n">py</span>
<span class="w">    </span><span class="err">↓</span><span class="w"> </span><span class="p">(</span><span class="n">Extract</span><span class="w"> </span><span class="n">climate</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">carbon</span><span class="w"> </span><span class="n">cycle</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">monthly</span><span class="p">)</span>

<span class="mf">2</span><span class="n">b</span><span class="mf">.</span><span class="w"> </span><span class="n">e3sm_extract_time_series_surfdata_iesm_dyn</span><span class="mf">.</span><span class="n">py</span><span class="w">  </span><span class="err">←</span><span class="w"> </span><span class="n">THIS</span><span class="w"> </span><span class="n">SCRIPT</span>
<span class="w">    </span><span class="err">↓</span><span class="w"> </span><span class="p">(</span><span class="n">Extract</span><span class="w"> </span><span class="n">harvest</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">grazing</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">annual</span><span class="p">)</span>

<span class="mf">3.</span><span class="w"> </span><span class="n">Combine</span><span class="w"> </span><span class="n">analyses</span><span class="p">:</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Plot</span><span class="w"> </span><span class="n">harvest</span><span class="w"> </span><span class="n">trends</span><span class="w"> </span><span class="n">over</span><span class="w"> </span><span class="n">time</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Correlate</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">carbon</span><span class="w"> </span><span class="n">cycle</span><span class="w"> </span><span class="n">changes</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Compare</span><span class="w"> </span><span class="n">regional</span><span class="w"> </span><span class="n">impacts</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="nb">Val</span><span class="n">idate</span><span class="w"> </span><span class="n">coupling</span><span class="w"> </span><span class="n">between</span><span class="w"> </span><span class="n">E3SM</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">GCAM</span>
</code></pre></div>

<h3>Downstream Analysis</h3>
<p><strong>Time Series Plotting:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;harvest_grazing.csv&#39;</span><span class="p">)</span>

<span class="c1"># Plot total harvest over time</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;HARVEST_AREA (km^2)&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Year&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Total Harvest Area (km²)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Global Forest Harvest&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>

<p><strong>Regional Comparison:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Load global and regional data</span>
<span class="n">df_global</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;global_harvest.csv&#39;</span><span class="p">)</span>
<span class="n">df_amazon</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;amazon_harvest.csv&#39;</span><span class="p">)</span>

<span class="c1"># Calculate Amazon fraction</span>
<span class="n">amazon_fraction</span> <span class="o">=</span> <span class="n">df_amazon</span><span class="p">[</span><span class="s1">&#39;HARVEST_AREA (km^2)&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">df_global</span><span class="p">[</span><span class="s1">&#39;HARVEST_AREA (km^2)&#39;</span><span class="p">]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_global</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">],</span> <span class="n">amazon_fraction</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Year&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Amazon </span><span class="si">% o</span><span class="s1">f Global Harvest&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>

<p><strong>Statistical Analysis:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">scipy</span><span class="w"> </span><span class="kn">import</span> <span class="n">stats</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;harvest_grazing.csv&#39;</span><span class="p">)</span>

<span class="c1"># Test for trend</span>
<span class="n">slope</span><span class="p">,</span> <span class="n">intercept</span><span class="p">,</span> <span class="n">r_value</span><span class="p">,</span> <span class="n">p_value</span><span class="p">,</span> <span class="n">std_err</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">linregress</span><span class="p">(</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;HARVEST_AREA (km^2)&#39;</span><span class="p">]</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Harvest trend: </span><span class="si">{</span><span class="n">slope</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> km²/year, p=</span><span class="si">{</span><span class="n">p_value</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2>Appendix: Complete Variable Reference</h2>
<h3>Available in surfdata_iESM_dyn.nc</h3>
<table>
<thead>
<tr>
<th>Variable</th>
<th>Units</th>
<th>Description</th>
<th>Output After Processing</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>GRAZING</code></td>
<td>Fraction (0-1)</td>
<td>Grazing intensity on grasslands</td>
<td><code>GRAZING_AREA (km^2)</code></td>
</tr>
<tr>
<td><code>HARVEST_VH1</code></td>
<td>Fraction (0-1)</td>
<td>Very heavy harvest intensity 1</td>
<td><code>HARVEST_VH1_AREA (km^2)</code></td>
</tr>
<tr>
<td><code>HARVEST_VH2</code></td>
<td>Fraction (0-1)</td>
<td>Very heavy harvest intensity 2</td>
<td><code>HARVEST_VH2_AREA (km^2)</code></td>
</tr>
<tr>
<td><code>HARVEST_SH1</code></td>
<td>Fraction (0-1)</td>
<td>Secondary heavy harvest 1</td>
<td><code>HARVEST_SH1_AREA (km^2)</code></td>
</tr>
<tr>
<td><code>HARVEST_SH2</code></td>
<td>Fraction (0-1)</td>
<td>Secondary heavy harvest 2</td>
<td><code>HARVEST_SH2_AREA (km^2)</code></td>
</tr>
<tr>
<td><code>HARVEST_SH3</code></td>
<td>Fraction (0-1)</td>
<td>Secondary heavy harvest 3</td>
<td><code>HARVEST_SH3_AREA (km^2)</code></td>
</tr>
<tr>
<td><code>PCT_NATVEG</code></td>
<td>Percent (0-100)</td>
<td>Natural vegetation cover</td>
<td><code>FRAC_VEG</code> (fraction, 0-1)</td>
</tr>
<tr>
<td><code>PCT_NAT_PFT</code></td>
<td>Percent (0-100)</td>
<td>PFT percentages</td>
<td>Individual and aggregated PFT areas</td>
</tr>
</tbody>
</table>
<h3>Automatically Generated Output Columns</h3>
<table>
<thead>
<tr>
<th>Column</th>
<th>Units</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Year</code></td>
<td>Year</td>
<td>Year of data</td>
</tr>
<tr>
<td><code>FRAC_VEG</code></td>
<td>Fraction (0-1)</td>
<td>Vegetation fraction (area-weighted mean)</td>
</tr>
<tr>
<td><code>AREA (km^2)</code></td>
<td>km²</td>
<td>Total gridcell area (global or regional sum)</td>
</tr>
<tr>
<td><code>PFT_1_AREA (km^2)</code> ... <code>PFT_16_AREA (km^2)</code></td>
<td>km²</td>
<td>Individual PFT areas</td>
</tr>
<tr>
<td><code>BARE_AREA (km^2)</code></td>
<td>km²</td>
<td>Bare soil area</td>
</tr>
<tr>
<td><code>FOREST_AREA (km^2)</code></td>
<td>km²</td>
<td>Total forest area (PFTs 1-8)</td>
</tr>
<tr>
<td><code>SHRUB_AREA (km^2)</code></td>
<td>km²</td>
<td>Total shrub area (PFTs 9-11)</td>
</tr>
<tr>
<td><code>GRASS_AREA (km^2)</code></td>
<td>km²</td>
<td>Total grass area (PFTs 12-14)</td>
</tr>
<tr>
<td><code>CROP_AREA (km^2)</code></td>
<td>km²</td>
<td>Crop area (PFT 15)</td>
</tr>
<tr>
<td><code>GRAZING_AREA (km^2)</code></td>
<td>km²</td>
<td>Grazed grassland area</td>
</tr>
<tr>
<td><code>HARVEST_*_AREA (km^2)</code></td>
<td>km²</td>
<td>Harvested forest area by type</td>
</tr>
<tr>
<td><code>HARVEST_AREA (km^2)</code></td>
<td>km²</td>
<td>Total harvested area (sum of all types)</td>
</tr>
</tbody>
</table>
<hr />
<h2>References</h2>
<ul>
<li>E3SM Documentation: <a href="https://e3sm.org/">https://e3sm.org/</a></li>
<li>E3SM-GCAM Coupling: DiVittorio et al. (2025). "E3SM-GCAM coupling methodology and applications." <em>Journal of Advances in Modeling Earth Systems</em>. <a href="https://agupubs.onlinelibrary.wiley.com/doi/full/10.1029/2024MS004806">DOI: 10.1029/2024MS004806</a></li>
<li>GitHub Repository: <a href="https://github.com/philipmyint/e3sm--gcam_analysis">https://github.com/philipmyint/e3sm--gcam_analysis</a></li>
<li>xarray Documentation: <a href="https://xarray.pydata.org/">https://xarray.pydata.org/</a></li>
</ul>
<hr />
<h2>Contact</h2>
<p>For questions or issues:<br />
- <strong>Philip Myint</strong>: myint1@llnl.gov<br />
- <strong>Dalei Hao</strong>: dalei.hao@pnnl.gov</p>
<hr />
<h2>Version Information</h2>
<p><strong>Script:</strong> e3sm_extract_time_series_surfdata_iesm_dyn.py<br />
<strong>Utility Modules:</strong> utility_e3sm_netcdf.py, utility_constants.py, utility_dataframes.py, utility_functions.py<br />
<strong>Documentation Version:</strong> 1.0<br />
<strong>Last Updated:</strong> January 2026<br />
<strong>Python Version:</strong> 3.7+<br />
<strong>xarray Version:</strong> 0.16+</p>
<hr />
<p><em>This documentation provides comprehensive guidance for using the <code>e3sm_extract_time_series_surfdata_iesm_dyn.py</code> script to extract annual time series data of human land management activities (grazing and harvest) from E3SM-GCAM coupled simulation surface data files.</em></p>
        
        <footer>
            <p>
                Comprehensive documentation for E3SM surfdata (human component) time series extraction<br>
                <strong>Script:</strong> e3sm_extract_time_series_surfdata_iesm_dyn.py<br>
                <strong>Utility Modules:</strong> utility_e3sm_netcdf.py, utility_constants.py<br>
                <strong>Authors:</strong> Philip Myint (myint1@llnl.gov) and Dalei Hao (dalei.hao@pnnl.gov)<br>
                <strong>Documentation Version:</strong> 1.0<br>
                <strong>Last Updated:</strong> January 2026
            </p>
        </footer>
    </div>
</body>
</html>
