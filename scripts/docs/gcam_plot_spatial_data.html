<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GCAM Spatial Data Plotting Script Documentation</title>
    <style>
/* 
 * Documentation Stylesheet for GCAM Synthetic Data Generation Script
 * A modern, colorful design with good readability
 */

/* ===== ROOT VARIABLES ===== */
:root {
    /* Color Palette */
    --primary-blue: #2563eb;
    --primary-blue-light: #3b82f6;
    --primary-blue-dark: #1e40af;
    --accent-green: #10b981;
    --accent-orange: #f59e0b;
    --accent-purple: #8b5cf6;
    --accent-red: #ef4444;
    
    /* Background Colors */
    --bg-main: #f8fafc;
    --bg-code: #1e293b;
    --bg-code-inline: #e2e8f0;
    --bg-table-header: #1e40af;
    --bg-table-row-even: #f1f5f9;
    --bg-table-row-odd: #ffffff;
    --bg-note: #fef3c7;
    --bg-warning: #fee2e2;
    --bg-info: #dbeafe;
    --bg-success: #d1fae5;
    
    /* Text Colors */
    --text-main: #1e293b;
    --text-secondary: #64748b;
    --text-code: #e2e8f0;
    --text-link: #2563eb;
    --text-link-hover: #1e40af;
    
    /* Border Colors */
    --border-light: #e2e8f0;
    --border-medium: #cbd5e1;
    --border-dark: #94a3b8;
    
    /* Spacing */
    --spacing-xs: 0.25rem;
    --spacing-sm: 0.5rem;
    --spacing-md: 1rem;
    --spacing-lg: 1.5rem;
    --spacing-xl: 2rem;
    --spacing-2xl: 3rem;
}

/* ===== BASE STYLES ===== */
* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}

body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    line-height: 1.7;
    color: var(--text-main);
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    padding: var(--spacing-xl) var(--spacing-md);
    font-size: 16px;
}

/* Main Container */
.container {
    max-width: 1200px;
    margin: 0 auto;
    background: var(--bg-main);
    padding: var(--spacing-2xl);
    border-radius: 12px;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
}

/* ===== TYPOGRAPHY ===== */
h1 {
    font-size: 2.5rem;
    color: var(--primary-blue-dark);
    margin-bottom: var(--spacing-xl);
    padding-bottom: var(--spacing-md);
    border-bottom: 4px solid var(--primary-blue);
    font-weight: 700;
    background: linear-gradient(135deg, var(--primary-blue) 0%, var(--accent-purple) 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

h2 {
    font-size: 2rem;
    color: var(--primary-blue);
    margin-top: var(--spacing-2xl);
    margin-bottom: var(--spacing-lg);
    padding-left: var(--spacing-md);
    border-left: 5px solid var(--accent-green);
    font-weight: 600;
}

h3 {
    font-size: 1.5rem;
    color: var(--primary-blue-dark);
    margin-top: var(--spacing-xl);
    margin-bottom: var(--spacing-md);
    font-weight: 600;
    display: flex;
    align-items: center;
}

h3::before {
    content: "▸";
    color: var(--accent-orange);
    margin-right: var(--spacing-sm);
    font-size: 1.2rem;
}

h4 {
    font-size: 1.25rem;
    color: var(--accent-purple);
    margin-top: var(--spacing-lg);
    margin-bottom: var(--spacing-sm);
    font-weight: 600;
}

p {
    margin-bottom: var(--spacing-md);
    color: var(--text-main);
}

/* ===== LINKS ===== */
a {
    color: var(--text-link);
    text-decoration: none;
    font-weight: 500;
    border-bottom: 2px solid transparent;
    transition: all 0.3s ease;
}

a:hover {
    color: var(--text-link-hover);
    border-bottom-color: var(--text-link-hover);
}

/* ===== LISTS ===== */
ul, ol {
    margin-left: var(--spacing-xl);
    margin-bottom: var(--spacing-md);
}

li {
    margin-bottom: var(--spacing-sm);
    padding-left: var(--spacing-sm);
}

ul li::marker {
    color: var(--accent-green);
    font-size: 1.2em;
}

ol li::marker {
    color: var(--primary-blue);
    font-weight: 600;
}

/* ===== CODE BLOCKS ===== */
code {
    font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
    font-size: 0.9em;
    padding: var(--spacing-xs) var(--spacing-sm);
    background: var(--bg-code-inline);
    color: var(--accent-red);
    border-radius: 4px;
    font-weight: 500;
}

pre {
    background: var(--bg-code);
    color: var(--text-code);
    padding: var(--spacing-lg);
    border-radius: 8px;
    overflow-x: auto;
    margin: var(--spacing-lg) 0;
    border-left: 4px solid var(--accent-green);
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

pre code {
    background: transparent;
    color: var(--text-code);
    padding: 0;
    font-size: 0.95em;
    line-height: 1.5;
}

/* ===== TABLES ===== */
table {
    width: 100%;
    border-collapse: collapse;
    margin: var(--spacing-xl) 0;
    background: white;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

thead {
    background: linear-gradient(135deg, var(--primary-blue) 0%, var(--primary-blue-dark) 100%);
    color: white;
}

th {
    padding: var(--spacing-md);
    text-align: left;
    font-weight: 600;
    font-size: 1.05em;
    border-bottom: 3px solid var(--accent-orange);
}

td {
    padding: var(--spacing-md);
    border-bottom: 1px solid var(--border-light);
}

tbody tr:nth-child(even) {
    background: var(--bg-table-row-even);
}

tbody tr:nth-child(odd) {
    background: var(--bg-table-row-odd);
}

tbody tr:hover {
    background: #e0f2fe;
    transform: scale(1.01);
    transition: all 0.2s ease;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
}

/* ===== BLOCKQUOTES ===== */
blockquote {
    margin: var(--spacing-lg) 0;
    padding: var(--spacing-md) var(--spacing-lg);
    background: var(--bg-info);
    border-left: 5px solid var(--primary-blue);
    border-radius: 0 8px 8px 0;
    font-style: italic;
    color: var(--primary-blue-dark);
}

/* ===== HORIZONTAL RULES ===== */
hr {
    border: none;
    height: 3px;
    background: linear-gradient(90deg, var(--accent-green) 0%, var(--primary-blue) 50%, var(--accent-purple) 100%);
    margin: var(--spacing-2xl) 0;
    border-radius: 2px;
}

/* ===== SPECIAL BOXES ===== */
.note {
    background: var(--bg-note);
    border-left: 5px solid var(--accent-orange);
    padding: var(--spacing-md) var(--spacing-lg);
    margin: var(--spacing-lg) 0;
    border-radius: 0 8px 8px 0;
}

.warning {
    background: var(--bg-warning);
    border-left: 5px solid var(--accent-red);
    padding: var(--spacing-md) var(--spacing-lg);
    margin: var(--spacing-lg) 0;
    border-radius: 0 8px 8px 0;
}

.info {
    background: var(--bg-info);
    border-left: 5px solid var(--primary-blue);
    padding: var(--spacing-md) var(--spacing-lg);
    margin: var(--spacing-lg) 0;
    border-radius: 0 8px 8px 0;
}

.success {
    background: var(--bg-success);
    border-left: 5px solid var(--accent-green);
    padding: var(--spacing-md) var(--spacing-lg);
    margin: var(--spacing-lg) 0;
    border-radius: 0 8px 8px 0;
}

/* ===== BADGES ===== */
.badge {
    display: inline-block;
    padding: var(--spacing-xs) var(--spacing-md);
    border-radius: 20px;
    font-size: 0.85em;
    font-weight: 600;
    margin: 0 var(--spacing-xs);
}

.badge-required {
    background: var(--accent-red);
    color: white;
}

.badge-optional {
    background: var(--accent-green);
    color: white;
}

.badge-default {
    background: var(--primary-blue);
    color: white;
}

/* ===== STRONG & EM ===== */
strong {
    color: var(--primary-blue-dark);
    font-weight: 700;
}

em {
    color: var(--accent-purple);
    font-style: italic;
}

/* ===== IMAGES ===== */
img {
    max-width: 100%;
    height: auto;
    border-radius: 8px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    margin: var(--spacing-lg) 0;
}

/* ===== SCROLLBAR STYLING ===== */
::-webkit-scrollbar {
    width: 12px;
    height: 12px;
}

::-webkit-scrollbar-track {
    background: var(--bg-table-row-even);
    border-radius: 10px;
}

::-webkit-scrollbar-thumb {
    background: linear-gradient(135deg, var(--primary-blue) 0%, var(--accent-purple) 100%);
    border-radius: 10px;
}

::-webkit-scrollbar-thumb:hover {
    background: linear-gradient(135deg, var(--primary-blue-dark) 0%, var(--accent-purple) 100%);
}

/* ===== PRINT STYLES ===== */
@media print {
    body {
        background: white;
        padding: 0;
    }
    
    .container {
        box-shadow: none;
        max-width: 100%;
    }
    
    h1, h2, h3 {
        page-break-after: avoid;
    }
    
    pre, table {
        page-break-inside: avoid;
    }
}

/* ===== RESPONSIVE DESIGN ===== */
@media (max-width: 768px) {
    body {
        padding: var(--spacing-md) var(--spacing-sm);
        font-size: 14px;
    }
    
    .container {
        padding: var(--spacing-lg);
    }
    
    h1 {
        font-size: 2rem;
    }
    
    h2 {
        font-size: 1.5rem;
    }
    
    h3 {
        font-size: 1.25rem;
    }
    
    table {
        font-size: 0.9em;
    }
    
    th, td {
        padding: var(--spacing-sm);
    }
}

/* ===== ADDITIONAL UTILITY CLASSES ===== */
.text-center {
    text-align: center;
}

.text-right {
    text-align: right;
}

.margin-top-lg {
    margin-top: var(--spacing-2xl);
}

.margin-bottom-lg {
    margin-bottom: var(--spacing-2xl);
}

.highlight {
    background: linear-gradient(120deg, #fef3c7 0%, #fde68a 100%);
    padding: 0 var(--spacing-xs);
    border-radius: 3px;
}

/* ===== SECTION DIVIDERS ===== */
.section-divider {
    display: flex;
    align-items: center;
    text-align: center;
    margin: var(--spacing-2xl) 0;
}

.section-divider::before,
.section-divider::after {
    content: '';
    flex: 1;
    border-bottom: 2px solid var(--border-medium);
}

.section-divider::before {
    margin-right: var(--spacing-md);
}

.section-divider::after {
    margin-left: var(--spacing-md);
}

/* ===== FOOTER ===== */
footer {
    margin-top: var(--spacing-2xl);
    padding-top: var(--spacing-lg);
    border-top: 2px solid var(--border-light);
    text-align: center;
    color: var(--text-secondary);
    font-size: 0.9em;
}

    </style>
</head>
<body>
    <div class="container">
<h1>GCAM Spatial Data Plotting Script Documentation</h1>
<h2>Overview</h2>
<p><strong>Script Name:</strong> <code>gcam_plot_spatial_data.py</code></p>
<p><strong>Purpose:</strong> Creates spatial (geographic) plots from GCAM (Global Change Analysis Model) output files, displaying data on maps using GCAM region/basin boundaries. The script supports individual scenario plots, ensemble means, absolute differences, and percent differences between scenarios, with optional statistical significance stippling.</p>
<p><strong>Author:</strong> Philip Myint (<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="4f223626213b7e0f2323212361282039">[email&#160;protected]</a>) and Dalei Hao (<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="5135303d34387f39303e11213f3f3d7f363e27">[email&#160;protected]</a>)</p>
<p><strong>Repository:</strong> <a href="https://github.com/philipmyint/e3sm--gcam_analysis">E3SM-GCAM Analysis Scripts</a></p>
<hr />
<h2>Table of Contents</h2>
<ol>
<li><a href="#overview">Overview</a></li>
<li><a href="#installation--requirements">Installation &amp; Requirements</a></li>
<li><a href="#basic-usage">Basic Usage</a></li>
<li><a href="#plot-types">Plot Types</a></li>
<li><a href="#complete-parameter-reference-table">Complete Parameter Reference Table</a></li>
<li><a href="#detailed-parameter-descriptions">Detailed Parameter Descriptions</a></li>
<li><a href="#json-configuration-examples">JSON Configuration Examples</a></li>
<li><a href="#statistical-significance-stippling">Statistical Significance Stippling</a></li>
<li><a href="#colormap-and-colorbar">Colormap and Colorbar</a></li>
<li><a href="#shape-files-and-geographic-data">Shape Files and Geographic Data</a></li>
<li><a href="#output-files">Output Files</a></li>
<li><a href="#troubleshooting">Troubleshooting</a></li>
<li><a href="#best-practices">Best Practices</a></li>
</ol>
<hr />
<h2>Installation &amp; Requirements</h2>
<h3>Required Python Libraries</h3>
<div class="codehilite"><pre><span></span><code>pip<span class="w"> </span>install<span class="w"> </span>pandas<span class="w"> </span>numpy<span class="w"> </span>scipy<span class="w"> </span>matplotlib<span class="w"> </span>geopandas
</code></pre></div>

<h3>Required Utility Modules</h3>
<p>The script imports several utility modules that must be in the same directory or Python path:<br />
- <code>utility_constants</code> - Default constants for plotting<br />
- <code>utility_dataframes</code> - Functions for reading files and performing t-tests<br />
- <code>utility_functions</code> - General utility functions<br />
- <code>utility_gcam</code> - GCAM-specific functions for landtype grouping<br />
- <code>utility_plots</code> - Plotting utility functions (provides default values)</p>
<h3>System Requirements</h3>
<ul>
<li>Python 3.7+</li>
<li>GeoPandas for handling shapefiles</li>
<li>GCAM region/basin boundary shapefiles</li>
<li>LaTeX installation (optional, for publication-quality typography)</li>
</ul>
<hr />
<h2>Basic Usage</h2>
<h3>Command Line Execution</h3>
<div class="codehilite"><pre><span></span><code>python<span class="w"> </span>gcam_plot_spatial_data.py<span class="w"> </span>path/to/config.json
</code></pre></div>

<p><strong>Multiple Configuration Files:</strong></p>
<div class="codehilite"><pre><span></span><code>python<span class="w"> </span>gcam_plot_spatial_data.py<span class="w"> </span>config1.json<span class="w"> </span>config2.json<span class="w"> </span>config3.json
</code></pre></div>

<h3>What the Script Does</h3>
<p>For each configuration block in the JSON file, the script:<br />
1. <strong>Reads</strong> processed GCAM output CSV files<br />
2. <strong>Reads</strong> GCAM region/basin boundary shapefiles<br />
3. <strong>Aggregates</strong> data across time (mean or sum over years)<br />
4. <strong>Aggregates</strong> data spatially (for landtype groups, regions/basins)<br />
5. <strong>Joins</strong> data with geographic boundaries<br />
6. <strong>Creates</strong> spatial maps with color-coded values<br />
7. <strong>Performs</strong> statistical tests (t-tests) when comparing scenarios<br />
8. <strong>Adds</strong> stippling to indicate statistical significance<br />
9. <strong>Generates</strong> publication-quality PDF (and optionally PNG) figures</p>
<hr />
<h2>Plot Types</h2>
<p>The script supports four main plot types:</p>
<h3>1. Single Scenario (<code>plot_type</code> not specified or single scenario)</h3>
<p>Shows absolute values for one scenario.</p>
<p><strong>Use for:</strong><br />
- Displaying baseline conditions<br />
- Showing spatial patterns of a single scenario<br />
- Initial data exploration</p>
<p><strong>Example:</strong> Control scenario commodity prices across GCAM regions</p>
<hr />
<h3>2. Mean (<code>plot_type: "mean"</code>)</h3>
<p>Shows the mean across multiple scenarios (ensemble mean).</p>
<p><strong>Use for:</strong><br />
- Displaying ensemble average<br />
- Reducing noise from individual ensemble members<br />
- Showing central tendency of ensemble</p>
<p><strong>Example:</strong> Mean forest area across 5 ensemble members</p>
<p><strong>Requirements:</strong><br />
- Multiple scenarios in simple list format<br />
- All scenarios averaged together</p>
<hr />
<h3>3. Absolute Difference (<code>plot_type: "absolute_difference"</code> - default)</h3>
<p>Shows the difference between scenarios: Scenario 2 - Scenario 1 (or Ensemble 2 mean - Ensemble 1 mean).</p>
<p><strong>Use for:</strong><br />
- Comparing two scenarios directly<br />
- Showing magnitude of changes<br />
- Identifying regions with largest differences</p>
<p><strong>Example:</strong> Full feedback emissions - Control emissions</p>
<p><strong>Color Interpretation:</strong><br />
- Positive values (red/orange): Scenario 2 &gt; Scenario 1<br />
- Negative values (blue): Scenario 2 &lt; Scenario 1<br />
- Zero (white/yellow): No difference</p>
<hr />
<h3>4. Percent Difference (<code>plot_type: "percent_difference"</code>)</h3>
<p>Shows the percent change: (Scenario 2 - Scenario 1) / Scenario 1 × 100</p>
<p><strong>Use for:</strong><br />
- Comparing relative changes<br />
- Normalizing differences across regions with different baseline values<br />
- Highlighting proportional impacts</p>
<p><strong>Example:</strong> Percent change in land area from Control to Full feedback</p>
<p><strong>Color Interpretation:</strong><br />
- Positive values: Percent increase<br />
- Negative values: Percent decrease<br />
- Zero: No change</p>
<p><strong>Formula:</strong></p>
<div class="codehilite"><pre><span></span><code>percent_difference = ((value_2 - value_1) / value_1) × 100
</code></pre></div>

<hr />
<h2>Complete Parameter Reference Table</h2>
<h3>Required Parameters</h3>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>shape_file</code></td>
<td>string</td>
<td><strong>Yes</strong></td>
<td>Path to GCAM region/basin boundary shapefile</td>
</tr>
<tr>
<td><code>output_file</code></td>
<td>string</td>
<td><strong>Yes</strong></td>
<td>Path to processed CSV file containing GCAM data</td>
</tr>
<tr>
<td><code>scenarios</code></td>
<td>list or nested list</td>
<td><strong>Yes</strong></td>
<td>Scenario names (list) or ensemble members (nested list)</td>
</tr>
</tbody>
</table>
<h3>Data Selection Parameters</h3>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Required</th>
<th>Default</th>
<th>Possible Values</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>categories</code></td>
<td>list</td>
<td>No</td>
<td>All categories</td>
<td>List of category names</td>
<td>Specific categories to plot</td>
</tr>
<tr>
<td><code>categories_to_exclude</code></td>
<td>list</td>
<td>No</td>
<td><code>None</code></td>
<td>List of category names</td>
<td>Categories to exclude</td>
</tr>
<tr>
<td><code>category_label</code></td>
<td>string</td>
<td>No</td>
<td><code>"sector"</code></td>
<td>Column name</td>
<td>Column identifying categories</td>
</tr>
<tr>
<td><code>scenario_label</code></td>
<td>string</td>
<td>No</td>
<td><code>"scenario"</code></td>
<td>Column name</td>
<td>Column identifying scenarios</td>
</tr>
<tr>
<td><code>scenario_sets</code></td>
<td>list</td>
<td>No</td>
<td><code>None</code></td>
<td>List of strings</td>
<td>Names for ensemble groups</td>
</tr>
<tr>
<td><code>notify_scenarios_transposed</code></td>
<td>boolean</td>
<td>No</td>
<td><code>false</code></td>
<td><code>true</code>, <code>false</code></td>
<td>Print console message when scenarios are automatically transposed</td>
</tr>
<tr>
<td><code>year_label</code></td>
<td>string</td>
<td>No</td>
<td><code>"year"</code></td>
<td>Column name</td>
<td>Column identifying years</td>
</tr>
<tr>
<td><code>value_label</code></td>
<td>string</td>
<td>No</td>
<td><code>"value"</code></td>
<td>Column name</td>
<td>Column with numeric data</td>
</tr>
<tr>
<td><code>region_label</code></td>
<td>string</td>
<td>No</td>
<td><code>"region"</code></td>
<td>Column name</td>
<td>Column identifying regions</td>
</tr>
<tr>
<td><code>basin_label</code></td>
<td>string</td>
<td>No</td>
<td><code>"basin"</code></td>
<td>Column name</td>
<td>Column identifying basins</td>
</tr>
<tr>
<td><code>start_year</code></td>
<td>integer</td>
<td>No</td>
<td><code>2070</code></td>
<td>Any year</td>
<td>Start year for time aggregation</td>
</tr>
<tr>
<td><code>end_year</code></td>
<td>integer</td>
<td>No</td>
<td><code>2090</code></td>
<td>Any year</td>
<td>End year for time aggregation</td>
</tr>
<tr>
<td><code>key_columns</code></td>
<td>list</td>
<td>No</td>
<td><code>None</code></td>
<td>List of column names</td>
<td>Columns for grouping</td>
</tr>
</tbody>
</table>
<h3>Geographic Parameters</h3>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Required</th>
<th>Default</th>
<th>Possible Values</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>shape_file</code></td>
<td>string</td>
<td><strong>Yes</strong></td>
<td>-</td>
<td>Valid shapefile path</td>
<td>GCAM boundary shapefile (.shp)</td>
</tr>
<tr>
<td><code>shape_file_region_label</code></td>
<td>string</td>
<td>No</td>
<td><code>"reg_nm"</code></td>
<td>Column name</td>
<td>Region name column in shapefile</td>
</tr>
<tr>
<td><code>shape_file_basin_label</code></td>
<td>string</td>
<td>No</td>
<td><code>"glu_nm"</code></td>
<td>Column name</td>
<td>Basin name column in shapefile</td>
</tr>
</tbody>
</table>
<h3>Aggregation Parameters</h3>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Required</th>
<th>Default</th>
<th>Possible Values</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>mean_or_sum_for_time_aggregation</code></td>
<td>string</td>
<td>No</td>
<td><code>"mean"</code></td>
<td><code>"mean"</code>, <code>"sum"</code></td>
<td>How to aggregate across years</td>
</tr>
<tr>
<td><code>mean_or_sum_if_more_than_one_row_in_same_landtype_group</code></td>
<td>string</td>
<td>No</td>
<td><code>"area_weighted_mean"</code></td>
<td><code>"mean"</code>, <code>"area_weighted_mean"</code>, <code>"sum"</code></td>
<td>Aggregation for landtype groups</td>
</tr>
<tr>
<td><code>mean_or_sum_if_more_than_one_row_in_same_region_and_or_basin</code></td>
<td>string</td>
<td>No</td>
<td><code>"mean"</code></td>
<td><code>"mean"</code>, <code>"sum"</code></td>
<td>Aggregation within region/basin</td>
</tr>
<tr>
<td><code>landtype_groups</code></td>
<td>string</td>
<td>No</td>
<td><code>"modified"</code></td>
<td><code>"modified"</code>, <code>"original"</code></td>
<td>Landtype grouping dictionary</td>
</tr>
<tr>
<td><code>multiplier</code></td>
<td>number</td>
<td>No</td>
<td><code>1</code></td>
<td>Any number</td>
<td>Multiply values (unit conversion)</td>
</tr>
</tbody>
</table>
<h3>Plot Type and Display Parameters</h3>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Required</th>
<th>Default</th>
<th>Possible Values</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>plot_type</code></td>
<td>string</td>
<td>No</td>
<td><code>"absolute_difference"</code></td>
<td><code>"mean"</code>, <code>"absolute_difference"</code>, <code>"percent_difference"</code></td>
<td>Type of spatial plot</td>
</tr>
<tr>
<td><code>plot_directory</code></td>
<td>string</td>
<td>No</td>
<td><code>"./"</code></td>
<td>Valid directory path</td>
<td>Output directory</td>
</tr>
<tr>
<td><code>plot_name</code></td>
<td>string</td>
<td>No</td>
<td>Auto-generated</td>
<td>Filename with .pdf</td>
<td>Plot filename</td>
</tr>
<tr>
<td><code>title</code></td>
<td>string</td>
<td>No</td>
<td>Auto-generated</td>
<td>Any string</td>
<td>Plot title</td>
</tr>
</tbody>
</table>
<h3>Visual Styling Parameters (from utility_plots.py)</h3>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Required</th>
<th>Default</th>
<th>Possible Values</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>width</code></td>
<td>number</td>
<td>No</td>
<td><code>10</code> inches</td>
<td>Positive number</td>
<td>Figure width</td>
</tr>
<tr>
<td><code>height</code></td>
<td>number</td>
<td>No</td>
<td><code>8</code> inches</td>
<td>Positive number</td>
<td>Figure height</td>
</tr>
<tr>
<td><code>use_latex</code></td>
<td>boolean</td>
<td>No</td>
<td><code>false</code></td>
<td><code>true</code>, <code>false</code></td>
<td>LaTeX text rendering</td>
</tr>
<tr>
<td><code>produce_png</code></td>
<td>boolean</td>
<td>No</td>
<td><code>false</code></td>
<td><code>true</code>, <code>false</code></td>
<td>Also create PNG</td>
</tr>
<tr>
<td><code>x_tick_label_size</code></td>
<td>number</td>
<td>No</td>
<td><code>20</code> points</td>
<td>Positive number</td>
<td>X-axis tick font size</td>
</tr>
<tr>
<td><code>y_tick_label_size</code></td>
<td>number</td>
<td>No</td>
<td><code>20</code> points</td>
<td>Positive number</td>
<td>Y-axis tick font size</td>
</tr>
</tbody>
</table>
<h3>Colormap and Colorbar Parameters</h3>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Required</th>
<th>Default</th>
<th>Possible Values</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>cmap</code></td>
<td>string</td>
<td>No</td>
<td><code>"viridis"</code></td>
<td>Matplotlib colormap name</td>
<td>Color scheme for map</td>
</tr>
<tr>
<td><code>cbar_on</code></td>
<td>boolean</td>
<td>No</td>
<td><code>true</code></td>
<td><code>true</code>, <code>false</code></td>
<td>Show colorbar</td>
</tr>
<tr>
<td><code>cbar_limits</code></td>
<td>list</td>
<td>No</td>
<td><code>None</code></td>
<td><code>[min, max]</code></td>
<td>Colorbar value range</td>
</tr>
<tr>
<td><code>linewidth</code></td>
<td>number</td>
<td>No</td>
<td><code>0.5</code></td>
<td>Positive number</td>
<td>Width of boundary lines</td>
</tr>
</tbody>
</table>
<h3>Statistical Significance Parameters</h3>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Required</th>
<th>Default</th>
<th>Possible Values</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>stippling_on</code></td>
<td>boolean</td>
<td>No</td>
<td><code>true</code></td>
<td><code>true</code>, <code>false</code></td>
<td>Show statistical significance</td>
</tr>
<tr>
<td><code>stippling_hatches</code></td>
<td>string</td>
<td>No</td>
<td><code>"xxxx"</code></td>
<td>Matplotlib hatch pattern</td>
<td>Stippling pattern</td>
</tr>
<tr>
<td><code>p_value_threshold</code></td>
<td>number</td>
<td>No</td>
<td><code>0.05</code></td>
<td>0 to 1</td>
<td>Significance threshold</td>
</tr>
<tr>
<td><code>p_value_file</code></td>
<td>string</td>
<td>No</td>
<td><code>"p_values.dat"</code></td>
<td>Filename</td>
<td>P-value output file</td>
</tr>
<tr>
<td><code>p_value_file_print_only_if_below_threshold</code></td>
<td>boolean</td>
<td>No</td>
<td><code>true</code></td>
<td><code>true</code>, <code>false</code></td>
<td>Only print significant values</td>
</tr>
</tbody>
</table>
<hr />
<h2>Detailed Parameter Descriptions</h2>
<h3>Core Required Parameters</h3>
<h4><code>shape_file</code></h4>
<p><strong>Type:</strong> String (file path)<br />
<strong>Required:</strong> Yes<br />
<strong>Description:</strong> Path to GCAM region/basin boundary shapefile.</p>
<p><strong>Examples:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nt">&quot;shape_file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;./../2025_DiVittorio_et_al_gcam/gcam_boundaries_moirai_3p1_0p5arcmin_wgs84/reg_glu_boundaries_moirai_combined_3p1_0p5arcmin.shp&quot;</span>
</code></pre></div>

<p><strong>Requirements:</strong><br />
- Must be a valid shapefile (.shp) with associated files (.shx, .dbf, .prj)<br />
- Must contain GCAM region and/or basin boundaries<br />
- Must have columns matching <code>shape_file_region_label</code> and <code>shape_file_basin_label</code></p>
<p><strong>Common GCAM Shapefiles:</strong><br />
- Combined region + basin boundaries: <code>reg_glu_boundaries_moirai_combined_3p1_0p5arcmin.shp</code><br />
- Region-only boundaries: <code>reg_boundaries_moirai_3p1_0p5arcmin.shp</code><br />
- Basin-only boundaries: <code>glu_boundaries_moirai_3p1_0p5arcmin.shp</code></p>
<hr />
<h4><code>output_file</code></h4>
<p><strong>Type:</strong> String (file path)<br />
<strong>Required:</strong> Yes<br />
<strong>Description:</strong> Path to processed CSV file containing GCAM output data.</p>
<p><strong>Examples:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nt">&quot;output_file&quot;</span><span class="p">:</span><span class="w"> </span><span class="nt">&quot;./../2025_DiVittorio_et_al_gcam/ag_commodity_prices_processed.csv&quot;</span>
<span class="nt">&quot;output_file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;./data/land_allocation_processed.csv&quot;</span>
</code></pre></div>

<p><strong>Requirements:</strong><br />
- CSV format with headers<br />
- Must have columns for: scenario, region/basin, year, category (if applicable), value<br />
- Processed using <code>gcam_process_extracted_data.py</code></p>
<hr />
<h4><code>scenarios</code></h4>
<p><strong>Type:</strong> List of strings OR nested list<br />
<strong>Required:</strong> Yes<br />
<strong>Description:</strong> Scenarios to plot or compare.</p>
<p><strong>Format 1 - Single or Multiple Scenarios (Simple List):</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nt">&quot;scenarios&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;Control&quot;</span><span class="p">]</span>
<span class="nt">&quot;scenarios&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;Control&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Full feedback&quot;</span><span class="p">]</span>
<span class="nt">&quot;scenarios&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;Control&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Control_2&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Control_3&quot;</span><span class="p">]</span>
</code></pre></div>

<p><strong>Format 2 - Ensemble Comparison (Nested List):</strong></p>
<p>Users can specify ensemble scenarios in <strong>either of two formats</strong>. The script automatically detects and handles both formats using the <code>transpose_scenarios_if_needed()</code> function in <code>utility_functions.py</code>.</p>
<p><strong>Format 2A - Organized by Scenario Set (Recommended):</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nt">&quot;scenarios&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">[</span><span class="s2">&quot;Control&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Control_2&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Control_3&quot;</span><span class="p">],</span>
<span class="w">    </span><span class="p">[</span><span class="s2">&quot;Full feedback&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Full feedback_2&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Full feedback_3&quot;</span><span class="p">]</span>
<span class="p">],</span>
<span class="nt">&quot;scenario_sets&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;Control&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Full feedback&quot;</span><span class="p">]</span>
</code></pre></div>

<p>Each inner list contains all ensemble members for one scenario set. This format is more intuitive as it groups related scenarios together.</p>
<p><strong>Format 2B - Organized by Ensemble Member (Alternative):</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nt">&quot;scenarios&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">[</span><span class="s2">&quot;Control&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Full feedback&quot;</span><span class="p">],</span>
<span class="w">    </span><span class="p">[</span><span class="s2">&quot;Control_2&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Full feedback_2&quot;</span><span class="p">],</span>
<span class="w">    </span><span class="p">[</span><span class="s2">&quot;Control_3&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Full feedback_3&quot;</span><span class="p">]</span>
<span class="p">],</span>
<span class="nt">&quot;scenario_sets&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;Control&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Full feedback&quot;</span><span class="p">]</span>
</code></pre></div>

<p>Each inner list is one ensemble member.</p>
<p><strong>Behavior by Plot Type:</strong><br />
- <strong>Single scenario:</strong> Shows absolute values<br />
- <strong>Multiple scenarios (list) + <code>plot_type: "mean"</code>:</strong> Shows ensemble mean<br />
- <strong>Multiple scenarios (list):</strong> Shows absolute or percent difference (2nd - 1st)<br />
- <strong>Nested list:</strong> Compares ensemble means (Set 2 mean - Set 1 mean)</p>
<p><strong>Important Notes:</strong><br />
- The <code>scenario_sets</code> parameter helps the script detect which format you're using<br />
- Scenario names do not need to follow any specific naming convention</p>
<hr />
<h3>Year Range Parameters</h3>
<h4><code>start_year</code> and <code>end_year</code></h4>
<p><strong>Type:</strong> Integer<br />
<strong>Required:</strong> No<br />
<strong>Defaults:</strong> <code>start_year: 2070</code>, <code>end_year: 2090</code></p>
<p><strong>Description:</strong> Define temporal range for aggregation. Data between these years is aggregated (mean or sum) to create the spatial plot.</p>
<p><strong>Example:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nt">&quot;start_year&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2080</span><span class="p">,</span>
<span class="nt">&quot;end_year&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2100</span>
</code></pre></div>

<p><strong>Usage:</strong><br />
- Shorter range: More specific time period, less temporal averaging<br />
- Longer range: More stable estimates, reduces year-to-year variability<br />
- Single year: Set both to same value</p>
<hr />
<h3>Aggregation Parameters</h3>
<h4><code>mean_or_sum_for_time_aggregation</code></h4>
<p><strong>Type:</strong> String<br />
<strong>Required:</strong> No<br />
<strong>Default:</strong> <code>"mean"</code><br />
<strong>Possible Values:</strong> <code>"mean"</code>, <code>"sum"</code></p>
<p><strong>Description:</strong> How to aggregate data across the year range.</p>
<p><strong>Use Cases:</strong><br />
- <code>"mean"</code> - Average across years (prices, scalars, rates)<br />
- <code>"sum"</code> - Total across years (cumulative emissions, production)</p>
<p><strong>Example:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nt">&quot;mean_or_sum_for_time_aggregation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;mean&quot;</span>
</code></pre></div>

<hr />
<h4><code>mean_or_sum_if_more_than_one_row_in_same_region_and_or_basin</code></h4>
<p><strong>Type:</strong> String<br />
<strong>Required:</strong> No<br />
<strong>Default:</strong> <code>"mean"</code><br />
<strong>Possible Values:</strong> <code>"mean"</code>, <code>"sum"</code></p>
<p><strong>Description:</strong> How to aggregate when multiple data rows exist for the same geographic unit.</p>
<p><strong>Use Cases:</strong><br />
- <code>"mean"</code> - Average values (e.g., average price across crops in a region)<br />
- <code>"sum"</code> - Total values (e.g., total land area across all landtypes)</p>
<hr />
<h4><code>mean_or_sum_if_more_than_one_row_in_same_landtype_group</code></h4>
<p><strong>Type:</strong> String<br />
<strong>Required:</strong> No<br />
<strong>Default:</strong> <code>"area_weighted_mean"</code><br />
<strong>Possible Values:</strong> <code>"mean"</code>, <code>"area_weighted_mean"</code>, <code>"sum"</code></p>
<p><strong>Description:</strong> How to aggregate when grouping landtypes (e.g., all crops into "crop" group).</p>
<p><strong>Use Cases:</strong><br />
- <code>"area_weighted_mean"</code> - Weighted average by land area<br />
- <code>"mean"</code> - Simple average<br />
- <code>"sum"</code> - Total (for areas, production)</p>
<hr />
<h3>Plot Type Parameter</h3>
<h4><code>plot_type</code></h4>
<p><strong>Type:</strong> String<br />
<strong>Required:</strong> No<br />
<strong>Default:</strong> <code>"absolute_difference"</code><br />
<strong>Possible Values:</strong> <code>"mean"</code>, <code>"absolute_difference"</code>, <code>"percent_difference"</code></p>
<p><strong>Description:</strong> Type of spatial plot to create.</p>
<p><strong><code>"mean"</code></strong> - Ensemble mean<br />
- Requires: Multiple scenarios in simple list<br />
- Shows: Average across all scenarios<br />
- Use for: Central tendency of ensemble</p>
<p><strong><code>"absolute_difference"</code></strong> - Absolute difference (default)<br />
- Requires: 2 scenarios or 2 ensemble sets<br />
- Shows: Scenario2 - Scenario1<br />
- Use for: Magnitude of change</p>
<p><strong><code>"percent_difference"</code></strong> - Percent difference<br />
- Requires: 2 scenarios or 2 ensemble sets<br />
- Shows: (Scenario2 - Scenario1) / Scenario1 × 100<br />
- Use for: Relative/normalized change</p>
<p><strong>Example:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nt">&quot;plot_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;percent_difference&quot;</span>
</code></pre></div>

<hr />
<h3>Colormap Parameters</h3>
<h4><code>cmap</code></h4>
<p><strong>Type:</strong> String<br />
<strong>Required:</strong> No<br />
<strong>Default:</strong> <code>"viridis"</code></p>
<p><strong>Description:</strong> Matplotlib colormap for coloring the map.</p>
<p><strong>Common Colormaps:</strong></p>
<p><strong>Sequential (for single-valued data):</strong><br />
- <code>"viridis"</code> - Blue to yellow (perceptually uniform, colorblind-friendly)<br />
- <code>"plasma"</code> - Purple to yellow<br />
- <code>"cividis"</code> - Blue to yellow (optimized for colorblind)<br />
- <code>"Blues"</code>, <code>"Reds"</code>, <code>"Greens"</code> - Single hue gradients</p>
<p><strong>Diverging (for difference plots):</strong><br />
- <code>"RdBu"</code> - Red (positive) to Blue (negative)<br />
- <code>"RdBu_r"</code> - Reversed: Blue (positive) to Red (negative)<br />
- <code>"RdYlBu"</code> - Red-Yellow-Blue<br />
- <code>"BrBG"</code> - Brown (positive) to Blue-Green (negative)<br />
- <code>"PiYG"</code> - Pink (positive) to Green (negative)</p>
<p><strong>Example:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nt">&quot;cmap&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;RdBu_r&quot;</span>
</code></pre></div>

<p><strong>Best Practices:</strong><br />
- Use diverging colormaps for difference/percent difference plots<br />
- Use sequential colormaps for absolute value plots<br />
- Consider colorblind accessibility</p>
<hr />
<h4><code>cbar_limits</code></h4>
<p><strong>Type:</strong> List of two numbers<br />
<strong>Required:</strong> No<br />
<strong>Default:</strong> <code>None</code> (auto-scaled)</p>
<p><strong>Description:</strong> Manually set colorbar value range.</p>
<p><strong>Example:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nt">&quot;cbar_limits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">-20</span><span class="p">,</span><span class="w"> </span><span class="mi">60</span><span class="p">]</span>
</code></pre></div>

<p><strong>Usage:</strong><br />
- Ensures consistent scaling across multiple plots<br />
- Prevents outliers from dominating color scale<br />
- Useful for comparison across categories<br />
- For symmetric diverging: use [-X, X]</p>
<p><strong>Auto-scaling behavior:</strong><br />
- Scales to data min/max<br />
- May differ between plots<br />
- Outliers can compress color range</p>
<hr />
<h4><code>cbar_on</code></h4>
<p><strong>Type:</strong> Boolean<br />
<strong>Required:</strong> No<br />
<strong>Default:</strong> <code>true</code></p>
<p><strong>Description:</strong> Whether to display colorbar.</p>
<p><strong>Example:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nt">&quot;cbar_on&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
</code></pre></div>

<p><strong>Use Cases:</strong><br />
- <code>false</code> - For panel plots with shared colorbar<br />
- <code>false</code> - When colorbar added separately<br />
- <code>true</code> - Standard single plots</p>
<hr />
<h3>Stippling Parameters</h3>
<h4><code>stippling_on</code></h4>
<p><strong>Type:</strong> Boolean<br />
<strong>Required:</strong> No<br />
<strong>Default:</strong> <code>true</code></p>
<p><strong>Description:</strong> Whether to show statistical significance stippling on difference plots.</p>
<p><strong>Example:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nt">&quot;stippling_on&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
</code></pre></div>

<p><strong>Behavior:</strong><br />
- Automatically applied to absolute_difference and percent_difference plots<br />
- Performs t-test for each region/basin<br />
- Adds hatching pattern where p &lt; threshold<br />
- Only relevant when comparing scenarios/ensembles</p>
<hr />
<h4><code>stippling_hatches</code></h4>
<p><strong>Type:</strong> String<br />
<strong>Required:</strong> No<br />
<strong>Default:</strong> <code>"xxxx"</code></p>
<p><strong>Description:</strong> Matplotlib hatch pattern for stippling.</p>
<p><strong>Common Patterns:</strong><br />
- <code>"xxxx"</code> - Dense X pattern (default)<br />
- <code>"////"</code> - Diagonal lines<br />
- <code>"\\\\\\\\"</code>- Reverse diagonal lines<br />
- <code>"...."</code> - Dots<br />
- <code>"++++"</code> - Plus signs<br />
- <code>"||||"</code> - Vertical lines</p>
<p><strong>Example:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nt">&quot;stippling_hatches&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;////&quot;</span>
</code></pre></div>

<hr />
<h3>Shape File Label Parameters</h3>
<h4><code>shape_file_region_label</code> and <code>shape_file_basin_label</code></h4>
<p><strong>Type:</strong> String<br />
<strong>Required:</strong> No<br />
<strong>Defaults:</strong> <code>"reg_nm"</code> (region), <code>"glu_nm"</code> (basin)</p>
<p><strong>Description:</strong> Column names in shapefile containing region and basin names.</p>
<p><strong>Example:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nt">&quot;shape_file_region_label&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;region_name&quot;</span><span class="p">,</span>
<span class="nt">&quot;shape_file_basin_label&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;basin_name&quot;</span>
</code></pre></div>

<p><strong>Requirements:</strong><br />
- Must match actual column names in shapefile<br />
- Values must match region/basin names in CSV data<br />
- Case-sensitive</p>
<p><strong>Verification:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">geopandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">gpd</span>
<span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s1">&#39;your_shapefile.shp&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">gdf</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2>JSON Configuration Examples</h2>
<h3>Example 1: Single Scenario Map</h3>
<p><strong>Purpose:</strong> Display agricultural commodity prices for Control scenario</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;shape_file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;./../2025_DiVittorio_et_al_gcam/gcam_boundaries_moirai_3p1_0p5arcmin_wgs84/reg_glu_boundaries_moirai_combined_3p1_0p5arcmin.shp&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;output_file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;./../2025_DiVittorio_et_al_gcam/ag_commodity_prices_processed.csv&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;scenarios&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;Control&quot;</span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;categories&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;BioenergyCrop&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Rice&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;SugarCrop&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Soybean&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Wheat&quot;</span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;plot_directory&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;./../2025_DiVittorio_et_al_gcam/spatial_plots&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;plot_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;spatial_ag_commodity_control_only.pdf&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;use_latex&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>What it does:</strong><br />
- Shows absolute values for Control scenario<br />
- Creates separate maps for 5 crops<br />
- Averages over default years (2070-2090)<br />
- Uses viridis colormap (default)</p>
<hr />
<h3>Example 2: Vegetation Scalars with Custom Labels</h3>
<p><strong>Purpose:</strong> Display EHC vegetation scalars with custom column names</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;shape_file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;./../2025_DiVittorio_et_al_gcam/gcam_boundaries_moirai_3p1_0p5arcmin_wgs84/reg_glu_boundaries_moirai_combined_3p1_0p5arcmin.shp&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;output_file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;./../2025_DiVittorio_et_al_gcam/scalars_control+full_feedback.csv&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;scenarios&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;Control&quot;</span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;categories&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;BioenergyCrop&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Rice&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;SugarCrop&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Soybean&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Wheat&quot;</span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;plot_directory&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;./../2025_DiVittorio_et_al_gcam/spatial_plots&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;plot_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;spatial_vegetation_scalars_control_only.pdf&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;category_label&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;landtype&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;value_label&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;vegetation&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;vegetation scalars&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;use_latex&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>What it does:</strong><br />
- Uses "landtype" column instead of default "sector"<br />
- Uses "vegetation" column instead of default "value"<br />
- Custom plot title</p>
<hr />
<h3>Example 3: Land Allocation with Landtype Groups</h3>
<p><strong>Purpose:</strong> Show forest area with landtype aggregation and summation</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;shape_file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;./../2025_DiVittorio_et_al_gcam/gcam_boundaries_moirai_3p1_0p5arcmin_wgs84/reg_glu_boundaries_moirai_combined_3p1_0p5arcmin.shp&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;output_file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;./../2025_DiVittorio_et_al_gcam/land_allocation_processed.csv&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;scenarios&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;Control&quot;</span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;categories&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;forest&quot;</span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;plot_directory&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;./../2025_DiVittorio_et_al_gcam/spatial_plots&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;plot_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;spatial_land_allocation_forest_control_only.pdf&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;category_label&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;landtype&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;mean_or_sum_if_more_than_one_row_in_same_landtype_group&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sum&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;mean_or_sum_if_more_than_one_row_in_same_region_and_or_basin&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sum&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;key_columns&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;scenario&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;region&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;basin&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;year&quot;</span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Forest area (thousands km$^2$)&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;use_latex&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>What it does:</strong><br />
- Aggregates all forest types into "forest" group<br />
- Sums areas within landtype group<br />
- Sums across regions/basins<br />
- LaTeX title with superscript</p>
<hr />
<h3>Example 4: Ensemble Mean</h3>
<p><strong>Purpose:</strong> Show mean forest area across ensemble members</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;shape_file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;./../2025_DiVittorio_et_al_gcam/gcam_boundaries_moirai_3p1_0p5arcmin_wgs84/reg_glu_boundaries_moirai_combined_3p1_0p5arcmin.shp&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;output_file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;./../2025_DiVittorio_et_al_gcam/land_allocation_processed_ensemble.csv&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;scenarios&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;Control&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Control_2&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Control_3&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Control_4&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Control_5&quot;</span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;categories&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;forest&quot;</span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;plot_directory&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;./../2025_DiVittorio_et_al_gcam/spatial_plots&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;plot_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;spatial_land_allocation_forest_mean.pdf&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;plot_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;mean&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;category_label&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;landtype&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;mean_or_sum_if_more_than_one_row_in_same_landtype_group&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sum&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;mean_or_sum_if_more_than_one_row_in_same_region_and_or_basin&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sum&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;key_columns&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;scenario&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;region&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;basin&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;year&quot;</span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Forest area (thousands km$^2$)&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;use_latex&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>What it does:</strong><br />
- Averages forest area across 5 ensemble members<br />
- Reduces ensemble variability<br />
- Shows central tendency</p>
<hr />
<h3>Example 5: Absolute Difference (Default)</h3>
<p><strong>Purpose:</strong> Show absolute difference in forest area between scenarios</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;shape_file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;./../2025_DiVittorio_et_al_gcam/gcam_boundaries_moirai_3p1_0p5arcmin_wgs84/reg_glu_boundaries_moirai_combined_3p1_0p5arcmin.shp&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;output_file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;./../2025_DiVittorio_et_al_gcam/land_allocation_processed_ensemble.csv&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;scenarios&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;Control&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Control_2&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Control_3&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Control_4&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Control_5&quot;</span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;categories&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;forest&quot;</span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;plot_directory&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;./../2025_DiVittorio_et_al_gcam/spatial_plots&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;plot_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;spatial_land_allocation_forest_absolute_difference.pdf&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;category_label&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;landtype&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;mean_or_sum_if_more_than_one_row_in_same_landtype_group&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sum&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;mean_or_sum_if_more_than_one_row_in_same_region_and_or_basin&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sum&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;key_columns&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;scenario&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;region&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;basin&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;year&quot;</span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Forest area (thousands km$^2$)&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;use_latex&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>What it does:</strong><br />
- Compares 2nd scenario minus 1st scenario (Control_2 - Control)<br />
- Note: plot_type defaults to "absolute_difference"<br />
- Shows where and how much forest area changes</p>
<hr />
<h3>Example 6: Percent Difference</h3>
<p><strong>Purpose:</strong> Show percent change in forest area</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;shape_file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;./../2025_DiVittorio_et_al_gcam/gcam_boundaries_moirai_3p1_0p5arcmin_wgs84/reg_glu_boundaries_moirai_combined_3p1_0p5arcmin.shp&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;output_file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;./../2025_DiVittorio_et_al_gcam/land_allocation_processed_ensemble.csv&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;scenarios&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;Control&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Control_2&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Control_3&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Control_4&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Control_5&quot;</span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;categories&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;forest&quot;</span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;plot_directory&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;./../2025_DiVittorio_et_al_gcam/spatial_plots&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;plot_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;spatial_land_allocation_forest_percent_difference.pdf&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;plot_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;percent_difference&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;category_label&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;landtype&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;mean_or_sum_if_more_than_one_row_in_same_landtype_group&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sum&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;mean_or_sum_if_more_than_one_row_in_same_region_and_or_basin&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sum&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;key_columns&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;scenario&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;region&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;basin&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;year&quot;</span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Forest area&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;use_latex&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>What it does:</strong><br />
- Shows percent change: (Control_2 - Control) / Control × 100<br />
- Title automatically gets "% difference" appended<br />
- Normalizes by baseline values</p>
<hr />
<h3>Example 7: Ensemble Comparison</h3>
<p><strong>Purpose:</strong> Compare ensemble means between two scenario groups</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;shape_file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;./../2025_DiVittorio_et_al_gcam/gcam_boundaries_moirai_3p1_0p5arcmin_wgs84/reg_glu_boundaries_moirai_combined_3p1_0p5arcmin.shp&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;output_file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;./../2025_DiVittorio_et_al_gcam/land_allocation_processed_ensemble.csv&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;scenarios&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">[</span><span class="s2">&quot;Control&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Full feedback&quot;</span><span class="p">],</span>
<span class="w">        </span><span class="p">[</span><span class="s2">&quot;Control_2&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Full feedback_2&quot;</span><span class="p">],</span>
<span class="w">        </span><span class="p">[</span><span class="s2">&quot;Control_3&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Full feedback_3&quot;</span><span class="p">],</span>
<span class="w">        </span><span class="p">[</span><span class="s2">&quot;Control_4&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Full feedback_4&quot;</span><span class="p">],</span>
<span class="w">        </span><span class="p">[</span><span class="s2">&quot;Control_5&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Full feedback_5&quot;</span><span class="p">]</span>
<span class="w">    </span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;categories&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;forest&quot;</span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;plot_directory&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;./../2025_DiVittorio_et_al_gcam/spatial_plots&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;plot_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;spatial_land_allocation_forest_ensemble_absolute_difference.pdf&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;category_label&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;landtype&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;mean_or_sum_if_more_than_one_row_in_same_landtype_group&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sum&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;mean_or_sum_if_more_than_one_row_in_same_region_and_or_basin&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sum&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;key_columns&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;scenario&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;region&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;basin&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;year&quot;</span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Forest area (thousands km$^2$)&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;use_latex&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>What it does:</strong><br />
- Calculates mean of Control ensemble (Control, Control_2, ...)<br />
- Calculates mean of Full feedback ensemble (Full feedback, Full feedback_2, ...)<br />
- Shows difference: Full feedback mean - Control mean<br />
- Performs t-tests and adds stippling</p>
<hr />
<h3>Example 8: Percent Difference with Custom Colorbar</h3>
<p><strong>Purpose:</strong> Show percent change in vegetation scalars with fixed color scale</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;shape_file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;./../2025_DiVittorio_et_al_gcam/gcam_boundaries_moirai_3p1_0p5arcmin_wgs84/reg_glu_boundaries_moirai_combined_3p1_0p5arcmin.shp&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;output_file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;./../2025_DiVittorio_et_al_gcam/scalars_control+full_feedback_ensemble.csv&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;scenarios&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">[</span><span class="s2">&quot;Control&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Full feedback&quot;</span><span class="p">],</span>
<span class="w">        </span><span class="p">[</span><span class="s2">&quot;Control_2&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Full feedback_2&quot;</span><span class="p">],</span>
<span class="w">        </span><span class="p">[</span><span class="s2">&quot;Control_3&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Full feedback_3&quot;</span><span class="p">],</span>
<span class="w">        </span><span class="p">[</span><span class="s2">&quot;Control_4&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Full feedback_4&quot;</span><span class="p">],</span>
<span class="w">        </span><span class="p">[</span><span class="s2">&quot;Control_5&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Full feedback_5&quot;</span><span class="p">]</span>
<span class="w">    </span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;categories&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;BioenergyCrop&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Rice&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;SugarCrop&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Soybean&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Wheat&quot;</span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;plot_directory&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;./../2025_DiVittorio_et_al_gcam/spatial_plots&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;plot_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;spatial_vegetation_scalars_ensemble_percent_difference.pdf&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;plot_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;percent_difference&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;cbar_limits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">-20</span><span class="p">,</span><span class="w"> </span><span class="mi">60</span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;category_label&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;landtype&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;value_label&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;vegetation&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;vegetation scalars&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;use_latex&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>What it does:</strong><br />
- Ensemble comparison with percent difference<br />
- Fixed colorbar from -20% to +60%<br />
- Ensures consistent scaling across crops<br />
- Custom value column</p>
<hr />
<h3>Example 9: No Stippling</h3>
<p><strong>Purpose:</strong> Show differences without statistical significance markers</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;shape_file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;./../2025_DiVittorio_et_al_gcam/gcam_boundaries_moirai_3p1_0p5arcmin_wgs84/reg_glu_boundaries_moirai_combined_3p1_0p5arcmin.shp&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;output_file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;./../2025_DiVittorio_et_al_gcam/scalars_control+full_feedback_ensemble.csv&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;scenarios&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">[</span><span class="s2">&quot;Control&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Full feedback&quot;</span><span class="p">],</span>
<span class="w">        </span><span class="p">[</span><span class="s2">&quot;Control_2&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Full feedback_2&quot;</span><span class="p">],</span>
<span class="w">        </span><span class="p">[</span><span class="s2">&quot;Control_3&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Full feedback_3&quot;</span><span class="p">],</span>
<span class="w">        </span><span class="p">[</span><span class="s2">&quot;Control_4&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Full feedback_4&quot;</span><span class="p">],</span>
<span class="w">        </span><span class="p">[</span><span class="s2">&quot;Control_5&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Full feedback_5&quot;</span><span class="p">]</span>
<span class="w">    </span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;categories&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;BioenergyCrop&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Rice&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;SugarCrop&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Soybean&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Wheat&quot;</span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;plot_directory&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;./../2025_DiVittorio_et_al_gcam/spatial_plots&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;plot_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;spatial_vegetation_scalars_ensemble_absolute_difference_no_stippling.pdf&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;category_label&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;landtype&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;value_label&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;vegetation&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;vegetation scalars&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;stippling_on&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;use_latex&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>What it does:</strong><br />
- Disables statistical significance stippling<br />
- Cleaner visual appearance<br />
- Useful when significance not needed or clutters plot</p>
<hr />
<h2>Statistical Significance Stippling</h2>
<h3>How It Works</h3>
<p><strong>For Difference Plots:</strong><br />
When comparing scenarios or ensembles, the script:<br />
1. Performs independent t-test for each region/basin<br />
2. Compares data from scenario 1 vs scenario 2 (or ensemble 1 vs ensemble 2)<br />
3. Calculates p-value for each region/basin<br />
4. Adds hatching pattern where p &lt; threshold</p>
<p><strong>Sample Sizes:</strong><br />
- Individual scenarios: n = number of years in range<br />
- Ensemble comparison: n = number of ensemble members × number of years</p>
<p><strong>Statistical Test:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># For each region/basin</span>
<span class="n">data_1</span> <span class="o">=</span> <span class="n">values</span> <span class="kn">from</span><span class="w"> </span><span class="nn">scenario</span><span class="o">/</span><span class="n">ensemble</span> <span class="mi">1</span>
<span class="n">data_2</span> <span class="o">=</span> <span class="n">values</span> <span class="kn">from</span><span class="w"> </span><span class="nn">scenario</span><span class="o">/</span><span class="n">ensemble</span> <span class="mi">2</span>
<span class="n">t_statistic</span><span class="p">,</span> <span class="n">p_value</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">ttest_ind</span><span class="p">(</span><span class="n">data_1</span><span class="p">,</span> <span class="n">data_2</span><span class="p">)</span>

<span class="k">if</span> <span class="n">p_value</span> <span class="o">&lt;</span> <span class="n">p_value_threshold</span><span class="p">:</span>
    <span class="c1"># Add stippling to this region</span>
</code></pre></div>

<h3>Interpreting Stippling</h3>
<p><strong>Stippled regions:</strong> Difference is statistically significant (p &lt; 0.05 default)<br />
- Unlikely difference occurred by chance<br />
- Strong evidence of real difference between scenarios</p>
<p><strong>Non-stippled regions:</strong> Difference is not statistically significant<br />
- Could be due to chance/variability<br />
- Insufficient evidence of real difference<br />
- Doesn't mean no difference exists</p>
<h3>Controlling Stippling</h3>
<p><strong>Enable/Disable:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nt">&quot;stippling_on&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">  </span><span class="c1">// Show stippling (default)</span>
<span class="nt">&quot;stippling_on&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">  </span><span class="c1">// No stippling</span>
</code></pre></div>

<p><strong>Change Threshold:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nt">&quot;p_value_threshold&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.05</span><span class="p">,</span><span class="w">  </span><span class="c1">// Standard</span>
<span class="nt">&quot;p_value_threshold&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.01</span><span class="p">,</span><span class="w">  </span><span class="c1">// More stringent</span>
<span class="nt">&quot;p_value_threshold&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.1</span><span class="w">    </span><span class="c1">// More lenient</span>
</code></pre></div>

<p><strong>Change Pattern:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nt">&quot;stippling_hatches&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;xxxx&quot;</span><span class="p">,</span><span class="w">  </span><span class="c1">// Dense X (default)</span>
<span class="nt">&quot;stippling_hatches&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;////&quot;</span><span class="w">   </span><span class="c1">// Diagonal lines</span>
</code></pre></div>

<h3>P-Value Output File</h3>
<p><strong>Location:</strong> <code>plot_directory/p_values.dat</code></p>
<p><strong>Content:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="o">============================================================</span>
<span class="nl">Plot:</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">plots</span><span class="o">/</span><span class="n">spatial_forest</span><span class="p">.</span><span class="n">pdf</span>
<span class="o">------------------------------------------------------------</span>
<span class="n">category</span><span class="o">=</span><span class="n">forest</span><span class="p">,</span><span class="w"> </span><span class="n">region</span><span class="o">=</span><span class="nl">USA:</span><span class="w"> </span><span class="n">p</span><span class="o">=</span><span class="mf">0.0234</span><span class="w"> </span><span class="o">*</span>
<span class="n">category</span><span class="o">=</span><span class="n">forest</span><span class="p">,</span><span class="w"> </span><span class="n">region</span><span class="o">=</span><span class="nl">China:</span><span class="w"> </span><span class="n">p</span><span class="o">=</span><span class="mf">0.3421</span>
<span class="n">category</span><span class="o">=</span><span class="n">forest</span><span class="p">,</span><span class="w"> </span><span class="n">region</span><span class="o">=</span><span class="nl">Brazil:</span><span class="w"> </span><span class="n">p</span><span class="o">=</span><span class="mf">0.0012</span><span class="w"> </span><span class="o">**</span>
<span class="o">============================================================</span>
</code></pre></div>

<hr />
<h2>Colormap and Colorbar</h2>
<h3>Choosing Colormaps</h3>
<p><strong>For Single Scenario (Absolute Values):</strong><br />
- Use sequential colormaps<br />
- Examples: <code>"viridis"</code>, <code>"plasma"</code>, <code>"cividis"</code>, <code>"Blues"</code><br />
- Low to high progression</p>
<p><strong>For Difference Plots:</strong><br />
- Use diverging colormaps<br />
- Examples: <code>"RdBu_r"</code>, <code>"RdYlBu"</code>, <code>"BrBG"</code>, <code>"PiYG"</code><br />
- Center at zero<br />
- Clearly distinguish positive vs negative</p>
<p><strong>Colorblind-Friendly:</strong><br />
- <code>"viridis"</code>, <code>"plasma"</code>, <code>"cividis"</code> - Sequential<br />
- <code>"RdBu"</code> - Diverging (but challenging)<br />
- Avoid <code>"jet"</code> rainbow colormap</p>
<h3>Setting Colorbar Limits</h3>
<p><strong>Auto-scaling (default):</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nt">&quot;cbar_limits&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
</code></pre></div>

<ul>
<li>Scales to data min/max</li>
<li>Different for each plot</li>
<li>Outliers can compress range</li>
</ul>
<p><strong>Manual limits:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nt">&quot;cbar_limits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">-100</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">]</span>
</code></pre></div>

<ul>
<li>Consistent across plots</li>
<li>Good for comparisons</li>
<li>May clip outliers</li>
</ul>
<p><strong>For symmetric diverging:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nt">&quot;cbar_limits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">-50</span><span class="p">,</span><span class="w"> </span><span class="mi">50</span><span class="p">]</span><span class="w">  </span><span class="c1">// Symmetric around zero</span>
</code></pre></div>

<p><strong>For percent difference:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nt">&quot;cbar_limits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">-20</span><span class="p">,</span><span class="w"> </span><span class="mi">60</span><span class="p">]</span><span class="w">  </span><span class="c1">// Asymmetric if needed</span>
</code></pre></div>

<hr />
<h2>Shape Files and Geographic Data</h2>
<h3>GCAM Boundary Shapefiles</h3>
<p><strong>Structure:</strong><br />
GCAM uses a hierarchical geographic structure:<br />
- <strong>Regions:</strong> 32 political/economic regions (e.g., USA, China, EU-15)<br />
- <strong>Basins:</strong> ~235 water basins (GLUs - Geographic Land Units)<br />
- <strong>Region-Basin combinations:</strong> Intersections of regions and basins</p>
<p><strong>Required Files:</strong><br />
A shapefile consists of multiple files:<br />
- <code>.shp</code> - Feature geometry<br />
- <code>.shx</code> - Shape index<br />
- <code>.dbf</code> - Attribute data<br />
- <code>.prj</code> - Projection information</p>
<p>All must be present in the same directory.</p>
<h3>Shapefile Attributes</h3>
<p><strong>Typical Columns:</strong><br />
- <code>reg_nm</code> - Region name (default for <code>shape_file_region_label</code>)<br />
- <code>glu_nm</code> - Basin name (default for <code>shape_file_basin_label</code>)<br />
- <code>reg_id</code> - Region ID number<br />
- <code>glu_id</code> - Basin ID number<br />
- <code>geometry</code> - Geographic boundaries</p>
<p><strong>Verify Attributes:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">geopandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">gpd</span>
<span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s1">&#39;your_shapefile.shp&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">gdf</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">gdf</span><span class="p">[[</span><span class="s1">&#39;reg_nm&#39;</span><span class="p">,</span> <span class="s1">&#39;glu_nm&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</code></pre></div>

<h3>Joining Data with Shapefile</h3>
<p>The script automatically:<br />
1. Reads shapefile<br />
2. Aggregates CSV data by region/basin<br />
3. Joins data to shapefile using region/basin names<br />
4. Handles missing data (regions with no data shown in gray/white)</p>
<p><strong>Requirements:</strong><br />
- Region/basin names in CSV must match shapefile<br />
- Case-sensitive matching<br />
- Whitespace matters</p>
<hr />
<h2>Output Files</h2>
<h3>Plot Files</h3>
<p><strong>PDF Format (default):</strong><br />
- Vector graphics (scalable)<br />
- High resolution<br />
- Small file size<br />
- Publication quality</p>
<p><strong>PNG Format (optional via <code>produce_png: true</code>):</strong><br />
- Raster graphics<br />
- Fixed resolution<br />
- Larger file size<br />
- Web/presentation use</p>
<p><strong>File Naming:</strong><br />
- Default: <code>spatial_[output_file_name].pdf</code><br />
- Custom: Specified by <code>plot_name</code></p>
<h3>P-Value Files</h3>
<p><strong>Location:</strong> <code>plot_directory/p_values.dat</code></p>
<p><strong>Generated for:</strong> Difference and percent difference plots with multiple scenarios/ensembles</p>
<p><strong>Content:</strong><br />
- Plot filename<br />
- P-values for each region/basin<br />
- Significance markers (*)</p>
<hr />
<h2>Troubleshooting</h2>
<h3>Issue 1: Shapefile Not Found</h3>
<p><strong>Error:</strong> <code>FileNotFoundError</code> or <code>DriverError</code></p>
<p><strong>Solutions:</strong><br />
- Verify shapefile path is correct<br />
- Ensure all shapefile components (.shp, .shx, .dbf, .prj) are present<br />
- Use absolute paths if unsure<br />
- Check file permissions</p>
<hr />
<h3>Issue 2: No Data on Map</h3>
<p><strong>Symptom:</strong> Map shows boundaries but no colors/all white</p>
<p><strong>Causes:</strong><br />
- Region/basin names don't match between CSV and shapefile<br />
- No data after aggregation<br />
- All values are NaN</p>
<p><strong>Solutions:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Check CSV region names</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;your_file.csv&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;region&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>

<span class="c1"># Check shapefile region names</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">geopandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">gpd</span>
<span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s1">&#39;your_shapefile.shp&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">gdf</span><span class="p">[</span><span class="s1">&#39;reg_nm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>

<span class="c1"># Compare - must match exactly</span>
</code></pre></div>

<hr />
<h3>Issue 3: Colorbar Range Issues</h3>
<p><strong>Symptom:</strong> All regions same color or very compressed range</p>
<p><strong>Cause:</strong> Outliers or inappropriate auto-scaling</p>
<p><strong>Solutions:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Set manual limits</span>
<span class="nt">&quot;cbar_limits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">-100</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">]</span>

<span class="c1">// Or remove outliers first in data processing</span>
</code></pre></div>

<hr />
<h3>Issue 4: Stippling Too Dense</h3>
<p><strong>Symptom:</strong> Hatching pattern overwhelming or obscuring colors</p>
<p><strong>Solutions:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Use lighter pattern</span>
<span class="nt">&quot;stippling_hatches&quot;</span><span class="p">:</span><span class="w"> </span><span class="nt">&quot;..&quot;</span><span class="w">  </span><span class="c1">// Sparse dots</span>

<span class="c1">// Or disable</span>
<span class="nt">&quot;stippling_on&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>

<span class="c1">// Or increase threshold (fewer significant regions)</span>
<span class="nt">&quot;p_value_threshold&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.01</span>
</code></pre></div>

<hr />
<h3>Issue 5: LaTeX Errors</h3>
<p><strong>Error:</strong> <code>RuntimeError: Failed to process string with tex</code></p>
<p><strong>Solutions:</strong><br />
- Install LaTeX or set <code>"use_latex": false</code><br />
- Check title for special characters<br />
- Escape LaTeX special characters</p>
<p><strong>Example:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Wrong</span>
<span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="nt">&quot;Area (km^2)&quot;</span>

<span class="c1">// Correct</span>
<span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Area (thousands km$^2$)&quot;</span>
</code></pre></div>

<hr />
<h3>Issue 6: Memory Issues with Large Shapefiles</h3>
<p><strong>Symptom:</strong> Slow performance or out of memory errors</p>
<p><strong>Solutions:</strong><br />
- Use simplified shapefiles (lower resolution)<br />
- Process fewer categories at once<br />
- Reduce figure size<br />
- Close other applications</p>
<hr />
<h2>Best Practices</h2>
<h3>1. Colormap Selection</h3>
<p><strong>Guidelines:</strong><br />
- <strong>Sequential for absolute values:</strong> Single scenario, ensemble mean<br />
- <strong>Diverging for differences:</strong> Absolute difference, percent difference<br />
- <strong>Consistent colors:</strong> Use same colormap across related figures<br />
- <strong>Accessibility:</strong> Choose colorblind-friendly options</p>
<p><strong>Recommendations:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Absolute values</span>
<span class="nt">&quot;cmap&quot;</span><span class="p">:</span><span class="w"> </span><span class="nt">&quot;viridis&quot;</span><span class="w">  </span><span class="c1">// Default, good choice</span>

<span class="c1">// Positive differences expected</span>
<span class="nt">&quot;cmap&quot;</span><span class="p">:</span><span class="w"> </span><span class="nt">&quot;YlOrRd&quot;</span><span class="w">  </span><span class="c1">// Yellow to red</span>

<span class="c1">// Differences (positive and negative)</span>
<span class="nt">&quot;cmap&quot;</span><span class="p">:</span><span class="w"> </span><span class="nt">&quot;RdBu_r&quot;</span><span class="w">  </span><span class="c1">// Red (positive) to Blue (negative)</span>

<span class="c1">// Percent differences</span>
<span class="nt">&quot;cmap&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;RdYlGn_r&quot;</span><span class="w">  </span><span class="c1">// Red (negative) to Green (positive)</span>
</code></pre></div>

<hr />
<h3>2. Time Range Selection</h3>
<p><strong>Consider:</strong><br />
- <strong>Longer range (20-30 years):</strong> More stable, averages out variability<br />
- <strong>Shorter range (5-10 years):</strong> More specific, but may be noisier<br />
- <strong>End-of-century (2080-2100):</strong> Common for long-term projections<br />
- <strong>Mid-century (2040-2060):</strong> Transition period</p>
<p><strong>Example:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Long-term average</span>
<span class="nt">&quot;start_year&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2070</span><span class="p">,</span>
<span class="nt">&quot;end_year&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2100</span>

<span class="c1">// Specific decade</span>
<span class="nt">&quot;start_year&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2090</span><span class="p">,</span>
<span class="nt">&quot;end_year&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2100</span>

<span class="c1">// Single year</span>
<span class="nt">&quot;start_year&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2100</span><span class="p">,</span>
<span class="nt">&quot;end_year&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2100</span>
</code></pre></div>

<hr />
<h3>3. Statistical Rigor</h3>
<p><strong>For Ensemble Comparisons:</strong><br />
- Use adequate ensemble size (5+ members preferred)<br />
- Be aware of multiple testing issues<br />
- Consider adjusted thresholds</p>
<p><strong>Bonferroni Correction:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1">// If testing 20 regions</span>
<span class="nt">&quot;p_value_threshold&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.0025</span><span class="w">  </span><span class="c1">// 0.05 / 20</span>
</code></pre></div>

<p><strong>Reporting:</strong><br />
- Always report threshold used<br />
- Report all comparisons, not just significant<br />
- Consider effect size alongside significance</p>
<hr />
<h3>4. Figure Quality</h3>
<p><strong>For Publications:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;width&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;height&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;use_latex&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;produce_png&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;linewidth&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.3</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>For Presentations:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;width&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;height&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;use_latex&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;produce_png&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;linewidth&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.5</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;stippling_on&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">  </span><span class="c1">// Cleaner for projector</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>For Posters:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;width&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">14</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;height&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;use_latex&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;produce_png&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;linewidth&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.8</span>
<span class="p">}</span>
</code></pre></div>

<hr />
<h3>5. Organization</h3>
<p><strong>Directory Structure:</strong></p>
<div class="codehilite"><pre><span></span><code>project/
├── data/
│   ├── processed/
│   └── shapefiles/
├── plots/
│   ├── spatial/
│   │   ├── absolute/
│   │   ├── percent/
│   │   └── means/
│   └── statistics/
└── configs/
    └── spatial_configs.json
</code></pre></div>

<p><strong>File Naming:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="n">spatial_</span><span class="o">[</span><span class="n">variable</span><span class="o">]</span><span class="n">_</span><span class="o">[</span><span class="n">scenario</span><span class="o">]</span><span class="n">_</span><span class="o">[</span><span class="n">plottype</span><span class="o">]</span><span class="p">.</span><span class="n">pdf</span>

<span class="nl">Examples</span><span class="p">:</span>
<span class="n">spatial_forest_control_only</span><span class="p">.</span><span class="n">pdf</span>
<span class="n">spatial_emissions_ensemble_percent_difference</span><span class="p">.</span><span class="n">pdf</span>
<span class="n">spatial_scalars_mean</span><span class="p">.</span><span class="n">pdf</span>
</code></pre></div>

<hr />
<h3>6. Reproducibility</h3>
<p><strong>Document Settings:</strong><br />
- Save configuration files<br />
- Note shapefile version/source<br />
- Record data processing steps<br />
- Version control configs</p>
<p><strong>Configuration Comments:</strong><br />
Use external documentation since JSON doesn't support comments:</p>
<div class="codehilite"><pre><span></span><code>config_notes.txt:
<span class="k">-</span> spatial_forest.json: Forest area comparison for paper Figure 3
<span class="k">-</span> Used Moirai 3.1 boundaries at 0.5 arcmin resolution
<span class="k">-</span> Years 2070-2090 average for end-of-century projection
<span class="k">-</span> RdBu_r colormap with symmetric ±100 limits
</code></pre></div>

<hr />
<h2>Integration with Other Scripts</h2>
<h3>Typical Workflow</h3>
<div class="codehilite"><pre><span></span><code><span class="mf">1.</span><span class="w"> </span><span class="n">gcam_extract_csv_from_project_files</span><span class="mf">.</span><span class="n">R</span>
<span class="w">   </span><span class="err">↓</span><span class="w"> </span><span class="p">(</span><span class="n">Extract</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">GCAM</span><span class="w"> </span><span class="n">project</span><span class="w"> </span><span class="n">files</span><span class="p">)</span>

<span class="mf">2.</span><span class="w"> </span><span class="n">gcam_process_extracted_data</span><span class="mf">.</span><span class="n">py</span>
<span class="w">   </span><span class="err">↓</span><span class="w"> </span><span class="p">(</span><span class="n">Clean</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="ow">or</span><span class="n">ganize</span><span class="p">)</span>

<span class="mf">3.</span><span class="w"> </span><span class="n">gcam_add_areas_to_files</span><span class="mf">.</span><span class="n">py</span><span class="w"> </span><span class="p">(</span><span class="n">optional</span><span class="p">)</span>
<span class="w">   </span><span class="err">↓</span><span class="w"> </span><span class="p">(</span><span class="n">Add</span><span class="w"> </span><span class="n">land</span><span class="w"> </span><span class="n">area</span><span class="w"> </span><span class="kd">data</span><span class="p">)</span>

<span class="mf">4.</span><span class="w"> </span><span class="n">gcam_plot_spatial_data</span><span class="mf">.</span><span class="n">py</span><span class="w">  </span><span class="err">←</span><span class="w"> </span><span class="n">THIS</span><span class="w"> </span><span class="n">SCRIPT</span>
<span class="w">   </span><span class="err">↓</span><span class="w"> </span><span class="p">(</span><span class="n">Create</span><span class="w"> </span><span class="n">spatial</span><span class="w"> </span><span class="n">maps</span><span class="p">)</span>

<span class="mf">5.</span><span class="w"> </span><span class="n">Analysis</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">publication</span>
</code></pre></div>

<h3>Complementary Visualizations</h3>
<p><strong>Together with:</strong><br />
- <strong>Time series plots</strong> (<code>gcam_plot_time_series.py</code>) - Temporal evolution<br />
- <strong>Box plots</strong> (<code>gcam_plot_box_and_whiskers.py</code>) - Distributions<br />
- <strong>Spatial plots</strong> (this script) - Geographic patterns</p>
<p><strong>Provides:</strong><br />
- Temporal: How does it change over time?<br />
- Statistical: What's the distribution/variability?<br />
- Spatial: Where do changes occur?</p>
<hr />
<h2>Appendix: Complete Default Values</h2>
<h3>From gcam_plot_spatial_data.py</h3>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
    <span class="s1">&#39;basin_label&#39;</span><span class="p">:</span> <span class="s1">&#39;basin&#39;</span><span class="p">,</span>
    <span class="s1">&#39;category_label&#39;</span><span class="p">:</span> <span class="s1">&#39;sector&#39;</span><span class="p">,</span>
    <span class="s1">&#39;cbar_limits&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
    <span class="s1">&#39;cbar_on&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="s1">&#39;cmap&#39;</span><span class="p">:</span> <span class="s1">&#39;viridis&#39;</span><span class="p">,</span>
    <span class="s1">&#39;end_year&#39;</span><span class="p">:</span> <span class="mi">2090</span><span class="p">,</span>
    <span class="s1">&#39;height&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>  <span class="c1"># inches (from utility_plots.py)</span>
    <span class="s1">&#39;key_columns&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
    <span class="s1">&#39;landtype_groups&#39;</span><span class="p">:</span> <span class="s1">&#39;modified&#39;</span><span class="p">,</span>
    <span class="s1">&#39;linewidth&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
    <span class="s1">&#39;multiplier&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s1">&#39;mean_or_sum_for_time_aggregation&#39;</span><span class="p">:</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span>
    <span class="s1">&#39;mean_or_sum_if_more_than_one_row_in_same_landtype_group&#39;</span><span class="p">:</span> <span class="s1">&#39;area_weighted_mean&#39;</span><span class="p">,</span>
    <span class="s1">&#39;mean_or_sum_if_more_than_one_row_in_same_region_and_or_basin&#39;</span><span class="p">:</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span>
    <span class="s1">&#39;p_value_file&#39;</span><span class="p">:</span> <span class="s1">&#39;p_values.dat&#39;</span><span class="p">,</span>
    <span class="s1">&#39;p_value_file_print_only_if_below_threshold&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="s1">&#39;p_value_threshold&#39;</span><span class="p">:</span> <span class="mf">0.05</span><span class="p">,</span>
    <span class="s1">&#39;plot_directory&#39;</span><span class="p">:</span> <span class="s1">&#39;./&#39;</span><span class="p">,</span>
    <span class="s1">&#39;plot_type&#39;</span><span class="p">:</span> <span class="s1">&#39;absolute_difference&#39;</span><span class="p">,</span>
    <span class="s1">&#39;produce_png&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>  <span class="c1"># from utility_plots.py</span>
    <span class="s1">&#39;region_label&#39;</span><span class="p">:</span> <span class="s1">&#39;region&#39;</span><span class="p">,</span>
    <span class="s1">&#39;scenario_label&#39;</span><span class="p">:</span> <span class="s1">&#39;scenario&#39;</span><span class="p">,</span>
    <span class="s1">&#39;scenario_sets&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
    <span class="s1">&#39;shape_file_basin_label&#39;</span><span class="p">:</span> <span class="s1">&#39;glu_nm&#39;</span><span class="p">,</span>
    <span class="s1">&#39;shape_file_region_label&#39;</span><span class="p">:</span> <span class="s1">&#39;reg_nm&#39;</span><span class="p">,</span>
    <span class="s1">&#39;start_year&#39;</span><span class="p">:</span> <span class="mi">2070</span><span class="p">,</span>
    <span class="s1">&#39;stippling_hatches&#39;</span><span class="p">:</span> <span class="s1">&#39;xxxx&#39;</span><span class="p">,</span>
    <span class="s1">&#39;stippling_on&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="s1">&#39;use_latex&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>  <span class="c1"># from utility_plots.py</span>
    <span class="s1">&#39;value_label&#39;</span><span class="p">:</span> <span class="s1">&#39;value&#39;</span><span class="p">,</span>
    <span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>  <span class="c1"># inches (from utility_plots.py)</span>
    <span class="s1">&#39;x_tick_label_size&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>  <span class="c1"># points (from utility_plots.py)</span>
    <span class="s1">&#39;y_tick_label_size&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>  <span class="c1"># points (from utility_plots.py)</span>
    <span class="s1">&#39;year_label&#39;</span><span class="p">:</span> <span class="s1">&#39;year&#39;</span>
<span class="p">}</span>
</code></pre></div>

<hr />
<h2>References</h2>
<ul>
<li>DiVittorio et al. (2025). "E3SM-GCAM coupling methodology and applications." <em>Journal of Advances in Modeling Earth Systems</em>. <a href="https://agupubs.onlinelibrary.wiley.com/doi/full/10.1029/2024MS004806">DOI: 10.1029/2024MS004806</a></li>
<li>GitHub Repository: <a href="https://github.com/philipmyint/e3sm--gcam_analysis">https://github.com/philipmyint/e3sm--gcam_analysis</a></li>
<li>GeoPandas Documentation: <a href="https://geopandas.org/">https://geopandas.org/</a></li>
<li>Matplotlib Colormaps: <a href="https://matplotlib.org/stable/gallery/color/colormap_reference.html">https://matplotlib.org/stable/gallery/color/colormap_reference.html</a></li>
</ul>
<hr />
<h2>Contact</h2>
<p>For questions or issues:<br />
- <strong>Philip Myint</strong>: <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="533e2a3a3d2762133f3f3d3f7d343c25">[email&#160;protected]</a><br />
- <strong>Dalei Hao</strong>: <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="2e4a4f424b4700464f416e5e40404200494158">[email&#160;protected]</a></p>
<hr />
<h2>Version Information</h2>
<p><strong>Script:</strong> gcam_plot_spatial_data.py<br />
<strong>Utility Module:</strong> utility_plots.py<br />
<strong>Documentation Version:</strong> 1.0<br />
<strong>Last Updated:</strong> January 2026<br />
<strong>Python Version:</strong> 3.7+<br />
<strong>GeoPandas Version:</strong> 0.8+</p>
<hr />
<p><em>This documentation provides comprehensive guidance for using the <code>gcam_plot_spatial_data.py</code> script to create geographic visualizations of GCAM output data with statistical analysis and publication-quality cartographic displays.</em></p>
        
        <footer>
            <p>
                Comprehensive documentatio