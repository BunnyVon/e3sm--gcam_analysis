<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GCAM Synthetic Data Generation Script Documentation</title>
    <style>
/* 
 * Documentation Stylesheet for GCAM Synthetic Data Generation Script
 * A modern, colorful design with good readability
 */

/* ===== ROOT VARIABLES ===== */
:root {
    /* Color Palette */
    --primary-blue: #2563eb;
    --primary-blue-light: #3b82f6;
    --primary-blue-dark: #1e40af;
    --accent-green: #10b981;
    --accent-orange: #f59e0b;
    --accent-purple: #8b5cf6;
    --accent-red: #ef4444;
    
    /* Background Colors */
    --bg-main: #f8fafc;
    --bg-code: #1e293b;
    --bg-code-inline: #e2e8f0;
    --bg-table-header: #1e40af;
    --bg-table-row-even: #f1f5f9;
    --bg-table-row-odd: #ffffff;
    --bg-note: #fef3c7;
    --bg-warning: #fee2e2;
    --bg-info: #dbeafe;
    --bg-success: #d1fae5;
    
    /* Text Colors */
    --text-main: #1e293b;
    --text-secondary: #64748b;
    --text-code: #e2e8f0;
    --text-link: #2563eb;
    --text-link-hover: #1e40af;
    
    /* Border Colors */
    --border-light: #e2e8f0;
    --border-medium: #cbd5e1;
    --border-dark: #94a3b8;
    
    /* Spacing */
    --spacing-xs: 0.25rem;
    --spacing-sm: 0.5rem;
    --spacing-md: 1rem;
    --spacing-lg: 1.5rem;
    --spacing-xl: 2rem;
    --spacing-2xl: 3rem;
}

/* ===== BASE STYLES ===== */
* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}

body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    line-height: 1.7;
    color: var(--text-main);
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    padding: var(--spacing-xl) var(--spacing-md);
    font-size: 16px;
}

/* Main Container */
.container {
    max-width: 1200px;
    margin: 0 auto;
    background: var(--bg-main);
    padding: var(--spacing-2xl);
    border-radius: 12px;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
}

/* ===== TYPOGRAPHY ===== */
h1 {
    font-size: 2.5rem;
    color: var(--primary-blue-dark);
    margin-bottom: var(--spacing-xl);
    padding-bottom: var(--spacing-md);
    border-bottom: 4px solid var(--primary-blue);
    font-weight: 700;
    background: linear-gradient(135deg, var(--primary-blue) 0%, var(--accent-purple) 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

h2 {
    font-size: 2rem;
    color: var(--primary-blue);
    margin-top: var(--spacing-2xl);
    margin-bottom: var(--spacing-lg);
    padding-left: var(--spacing-md);
    border-left: 5px solid var(--accent-green);
    font-weight: 600;
}

h3 {
    font-size: 1.5rem;
    color: var(--primary-blue-dark);
    margin-top: var(--spacing-xl);
    margin-bottom: var(--spacing-md);
    font-weight: 600;
    display: flex;
    align-items: center;
}

h3::before {
    content: "▸";
    color: var(--accent-orange);
    margin-right: var(--spacing-sm);
    font-size: 1.2rem;
}

h4 {
    font-size: 1.25rem;
    color: var(--accent-purple);
    margin-top: var(--spacing-lg);
    margin-bottom: var(--spacing-sm);
    font-weight: 600;
}

p {
    margin-bottom: var(--spacing-md);
    color: var(--text-main);
}

/* ===== LINKS ===== */
a {
    color: var(--text-link);
    text-decoration: none;
    font-weight: 500;
    border-bottom: 2px solid transparent;
    transition: all 0.3s ease;
}

a:hover {
    color: var(--text-link-hover);
    border-bottom-color: var(--text-link-hover);
}

/* ===== LISTS ===== */
ul, ol {
    margin-left: var(--spacing-xl);
    margin-bottom: var(--spacing-md);
}

li {
    margin-bottom: var(--spacing-sm);
    padding-left: var(--spacing-sm);
}

ul li::marker {
    color: var(--accent-green);
    font-size: 1.2em;
}

ol li::marker {
    color: var(--primary-blue);
    font-weight: 600;
}

/* ===== CODE BLOCKS ===== */
code {
    font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
    font-size: 0.9em;
    padding: var(--spacing-xs) var(--spacing-sm);
    background: var(--bg-code-inline);
    color: var(--accent-red);
    border-radius: 4px;
    font-weight: 500;
}

pre {
    background: var(--bg-code);
    color: var(--text-code);
    padding: var(--spacing-lg);
    border-radius: 8px;
    overflow-x: auto;
    margin: var(--spacing-lg) 0;
    border-left: 4px solid var(--accent-green);
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

pre code {
    background: transparent;
    color: var(--text-code);
    padding: 0;
    font-size: 0.95em;
    line-height: 1.5;
}

/* ===== TABLES ===== */
table {
    width: 100%;
    border-collapse: collapse;
    margin: var(--spacing-xl) 0;
    background: white;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

thead {
    background: linear-gradient(135deg, var(--primary-blue) 0%, var(--primary-blue-dark) 100%);
    color: white;
}

th {
    padding: var(--spacing-md);
    text-align: left;
    font-weight: 600;
    font-size: 1.05em;
    border-bottom: 3px solid var(--accent-orange);
}

td {
    padding: var(--spacing-md);
    border-bottom: 1px solid var(--border-light);
}

tbody tr:nth-child(even) {
    background: var(--bg-table-row-even);
}

tbody tr:nth-child(odd) {
    background: var(--bg-table-row-odd);
}

tbody tr:hover {
    background: #e0f2fe;
    transform: scale(1.01);
    transition: all 0.2s ease;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
}

/* ===== BLOCKQUOTES ===== */
blockquote {
    margin: var(--spacing-lg) 0;
    padding: var(--spacing-md) var(--spacing-lg);
    background: var(--bg-info);
    border-left: 5px solid var(--primary-blue);
    border-radius: 0 8px 8px 0;
    font-style: italic;
    color: var(--primary-blue-dark);
}

/* ===== HORIZONTAL RULES ===== */
hr {
    border: none;
    height: 3px;
    background: linear-gradient(90deg, var(--accent-green) 0%, var(--primary-blue) 50%, var(--accent-purple) 100%);
    margin: var(--spacing-2xl) 0;
    border-radius: 2px;
}

/* ===== SPECIAL BOXES ===== */
.note {
    background: var(--bg-note);
    border-left: 5px solid var(--accent-orange);
    padding: var(--spacing-md) var(--spacing-lg);
    margin: var(--spacing-lg) 0;
    border-radius: 0 8px 8px 0;
}

.warning {
    background: var(--bg-warning);
    border-left: 5px solid var(--accent-red);
    padding: var(--spacing-md) var(--spacing-lg);
    margin: var(--spacing-lg) 0;
    border-radius: 0 8px 8px 0;
}

.info {
    background: var(--bg-info);
    border-left: 5px solid var(--primary-blue);
    padding: var(--spacing-md) var(--spacing-lg);
    margin: var(--spacing-lg) 0;
    border-radius: 0 8px 8px 0;
}

.success {
    background: var(--bg-success);
    border-left: 5px solid var(--accent-green);
    padding: var(--spacing-md) var(--spacing-lg);
    margin: var(--spacing-lg) 0;
    border-radius: 0 8px 8px 0;
}

/* ===== BADGES ===== */
.badge {
    display: inline-block;
    padding: var(--spacing-xs) var(--spacing-md);
    border-radius: 20px;
    font-size: 0.85em;
    font-weight: 600;
    margin: 0 var(--spacing-xs);
}

.badge-required {
    background: var(--accent-red);
    color: white;
}

.badge-optional {
    background: var(--accent-green);
    color: white;
}

.badge-default {
    background: var(--primary-blue);
    color: white;
}

/* ===== STRONG & EM ===== */
strong {
    color: var(--primary-blue-dark);
    font-weight: 700;
}

em {
    color: var(--accent-purple);
    font-style: italic;
}

/* ===== IMAGES ===== */
img {
    max-width: 100%;
    height: auto;
    border-radius: 8px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    margin: var(--spacing-lg) 0;
}

/* ===== SCROLLBAR STYLING ===== */
::-webkit-scrollbar {
    width: 12px;
    height: 12px;
}

::-webkit-scrollbar-track {
    background: var(--bg-table-row-even);
    border-radius: 10px;
}

::-webkit-scrollbar-thumb {
    background: linear-gradient(135deg, var(--primary-blue) 0%, var(--accent-purple) 100%);
    border-radius: 10px;
}

::-webkit-scrollbar-thumb:hover {
    background: linear-gradient(135deg, var(--primary-blue-dark) 0%, var(--accent-purple) 100%);
}

/* ===== PRINT STYLES ===== */
@media print {
    body {
        background: white;
        padding: 0;
    }
    
    .container {
        box-shadow: none;
        max-width: 100%;
    }
    
    h1, h2, h3 {
        page-break-after: avoid;
    }
    
    pre, table {
        page-break-inside: avoid;
    }
}

/* ===== RESPONSIVE DESIGN ===== */
@media (max-width: 768px) {
    body {
        padding: var(--spacing-md) var(--spacing-sm);
        font-size: 14px;
    }
    
    .container {
        padding: var(--spacing-lg);
    }
    
    h1 {
        font-size: 2rem;
    }
    
    h2 {
        font-size: 1.5rem;
    }
    
    h3 {
        font-size: 1.25rem;
    }
    
    table {
        font-size: 0.9em;
    }
    
    th, td {
        padding: var(--spacing-sm);
    }
}

/* ===== ADDITIONAL UTILITY CLASSES ===== */
.text-center {
    text-align: center;
}

.text-right {
    text-align: right;
}

.margin-top-lg {
    margin-top: var(--spacing-2xl);
}

.margin-bottom-lg {
    margin-bottom: var(--spacing-2xl);
}

.highlight {
    background: linear-gradient(120deg, #fef3c7 0%, #fde68a 100%);
    padding: 0 var(--spacing-xs);
    border-radius: 3px;
}

/* ===== SECTION DIVIDERS ===== */
.section-divider {
    display: flex;
    align-items: center;
    text-align: center;
    margin: var(--spacing-2xl) 0;
}

.section-divider::before,
.section-divider::after {
    content: '';
    flex: 1;
    border-bottom: 2px solid var(--border-medium);
}

.section-divider::before {
    margin-right: var(--spacing-md);
}

.section-divider::after {
    margin-left: var(--spacing-md);
}

/* ===== FOOTER ===== */
footer {
    margin-top: var(--spacing-2xl);
    padding-top: var(--spacing-lg);
    border-top: 2px solid var(--border-light);
    text-align: center;
    color: var(--text-secondary);
    font-size: 0.9em;
}

    </style>
</head>
<body>
    <div class="container">
<h1>GCAM Synthetic Data Generation Script Documentation</h1>
<h2>Overview</h2>
<p><strong>Script Name:</strong> <code>gcam_produce_synthetic_data.py</code></p>
<p><strong>Purpose:</strong> Generates synthetic ensemble sets of time series data by applying random perturbations to base GCAM (Global Change Analysis Model) simulation outputs. This script is designed for testing and validation purposes, allowing users to create multiple variations of existing time series data to simulate ensemble runs.</p>
<p><strong>Author:</strong> Philip Myint (myint1@llnl.gov) and Dalei Hao (dalei.hao@pnnl.gov)</p>
<p><strong>Repository:</strong> <a href="https://github.com/philipmyint/e3sm--gcam_analysis">E3SM-GCAM Analysis Scripts</a></p>
<hr />
<h2>Script Description</h2>
<p>The <code>gcam_produce_synthetic_data.py</code> script reads base time series data from CSV or fixed-width format (.dat) files and creates synthetic variations by applying controlled random perturbations. Each synthetic time series maintains the general pattern of the original data while introducing realistic variability through multiplicative factors.</p>
<h3>Key Features</h3>
<ul>
<li><strong>Parallel Processing:</strong> Utilizes Python's multiprocessing capabilities to generate synthetic data for multiple files simultaneously</li>
<li><strong>Flexible Input Formats:</strong> Supports both CSV and fixed-width format (.dat) files</li>
<li><strong>Controlled Perturbations:</strong> Applies base multipliers combined with random variations to maintain data consistency</li>
<li><strong>Scenario Management:</strong> Processes multiple scenarios within each file independently</li>
<li><strong>Automatic Output Naming:</strong> Generates ensemble files with intuitive naming conventions</li>
</ul>
<h3>Workflow</h3>
<ol>
<li>Reads base time series data from input files</li>
<li>For each scenario in the file:<br />
   - Creates multiple synthetic variations<br />
   - Applies base multipliers (ranging from 1.02 to 1.05)<br />
   - Adds random perturbations (±2%)<br />
   - Multiplies specified data columns by these combined factors</li>
<li>Concatenates all variations with the original data</li>
<li>Outputs results to a new ensemble file</li>
</ol>
<hr />
<h2>Function Documentation</h2>
<h3><code>produce_synthetic_time_series(inputs)</code></h3>
<p><strong>Purpose:</strong> Core function that generates synthetic ensemble time series from a base dataset.</p>
<p><strong>Parameters:</strong><br />
- <code>inputs</code> (list): A list containing five elements:<br />
  1. <code>file</code> (str): Path to the input file containing base time series data<br />
  2. <code>scenarios</code> (list): List of scenario names present in the file<br />
  3. <code>scenario_label</code> (str): Column name identifying scenarios in the dataframe<br />
  4. <code>columns_to_modify</code> (list): Column names containing numerical data to perturb<br />
  5. <code>num_synthetic_sets_in_ensemble</code> (int): Total number of time series including the base</p>
<p><strong>Returns:</strong> None (writes output to file)</p>
<p><strong>Process:</strong><br />
1. Loads data from the specified file<br />
2. Creates a copy for the ensemble dataset<br />
3. Generates base multipliers linearly spaced between 1.02 and 1.05<br />
4. For each scenario and each synthetic variation:<br />
   - Applies base multiplier plus random variation (±2%)<br />
   - Creates new scenario label (e.g., <code>scenario_2</code>, <code>scenario_3</code>, etc.)<br />
   - Multiplies specified columns by the combined multiplier<br />
5. Outputs to CSV or fixed-width format file with <code>_ensemble</code> suffix</p>
<p><strong>Output Naming Convention:</strong><br />
- CSV input: <code>original_name.csv</code> → <code>original_name_ensemble.csv</code><br />
- DAT input: <code>original_name.dat</code> → <code>original_name_ensemble.dat</code><br />
- Other formats: <code>original_name</code> → <code>original_name_ensemble</code></p>
<hr />
<h2>Main Execution Block</h2>
<p>The script's main execution block (runs when <code>if __name__ == '__main__':</code>) processes multiple GCAM output files in parallel.</p>
<h3>Default Configuration</h3>
<p>The script is pre-configured to process six different GCAM output files from the DiVittorio et al. 2025 study:</p>
<ol>
<li><strong>Agricultural commodity prices</strong> (<code>ag_commodity_prices_processed.csv</code>)</li>
<li><strong>CO2 emissions by region</strong> (<code>co2_emissions_regions_processed.csv</code>)</li>
<li><strong>CO2 emissions by sector</strong> (<code>co2_emissions_sectors_processed.csv</code>)</li>
<li><strong>Land allocation</strong> (<code>land_allocation_processed.csv</code>)</li>
<li><strong>Land allocation with original crop names</strong> (<code>land_allocation_processed_original_crop_names.csv</code>)</li>
<li><strong>Vegetation and soil scalars</strong> (<code>scalars_control+full_feedback.csv</code>)</li>
</ol>
<hr />
<h2>Input Parameters Table</h2>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Default Value</th>
<th>Possible Values</th>
<th>Required?</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>files</code></td>
<td>List of 6 CSV file paths</td>
<td>Any valid file path(s) to CSV or .dat files</td>
<td>Yes</td>
<td>List of input files containing base time series data</td>
</tr>
<tr>
<td><code>columns_to_modify</code></td>
<td><code>[['value'], ['value'], ['value'], ['value'], ['value'], ['vegetation', 'soil']]</code></td>
<td>Any valid column name(s) from the input files</td>
<td>Yes</td>
<td>Columns containing numerical data to be perturbed for each file</td>
</tr>
<tr>
<td><code>scenario_labels</code></td>
<td><code>['scenario', 'scenario', 'scenario', 'scenario', 'scenario', 'scenario']</code></td>
<td>Any valid column name identifying scenarios</td>
<td>Yes</td>
<td>Column name that identifies different scenarios in each file</td>
</tr>
<tr>
<td><code>num_variations_for_each_scenario</code></td>
<td><code>[5, 5, 5, 5, 5, 5]</code></td>
<td>Any positive integer ≥ 1</td>
<td>Yes</td>
<td>Total number of time series (including base) for each file</td>
</tr>
<tr>
<td><code>base_multipliers</code></td>
<td><code>np.linspace(1.02, 1.05, num_synthetic_sets_in_ensemble)</code></td>
<td>Any array of positive float values</td>
<td>No</td>
<td>Base multiplicative factors applied to data (hardcoded in function)</td>
</tr>
<tr>
<td><code>random_multipliers</code></td>
<td><code>np.random.uniform(low=-0.02, high=0.02, size=len(df_this_scenario))</code></td>
<td>Any range of float values</td>
<td>No</td>
<td>Random perturbations added to base multipliers (hardcoded in function)</td>
</tr>
<tr>
<td><code>processes</code></td>
<td><code>multiprocessing.cpu_count()</code></td>
<td>Any positive integer ≤ CPU count</td>
<td>No</td>
<td>Number of parallel processes to use</td>
</tr>
</tbody>
</table>
<hr />
<h2>Detailed Parameter Descriptions</h2>
<h3>Files Configuration</h3>
<p><strong>Default Files:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="n">files</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;./../2025_DiVittorio_et_al_gcam/ag_commodity_prices_processed.csv&quot;</span><span class="p">,</span>
    <span class="s2">&quot;./../2025_DiVittorio_et_al_gcam/co2_emissions_regions_processed.csv&quot;</span><span class="p">,</span>
    <span class="s2">&quot;./../2025_DiVittorio_et_al_gcam/co2_emissions_sectors_processed.csv&quot;</span><span class="p">,</span>
    <span class="s2">&quot;./../2025_DiVittorio_et_al_gcam/land_allocation_processed.csv&quot;</span><span class="p">,</span>
    <span class="s2">&quot;./../2025_DiVittorio_et_al_gcam/land_allocation_processed_original_crop_names.csv&quot;</span><span class="p">,</span>
    <span class="s2">&quot;./../2025_DiVittorio_et_al_gcam/scalars_control+full_feedback.csv&quot;</span>
<span class="p">]</span>
</code></pre></div>

<p><strong>Customization:</strong> Users can modify this list to include any CSV or .dat files containing GCAM time series data. All files must contain a column identifying scenarios.</p>
<h3>Columns to Modify</h3>
<p><strong>Default Configuration:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="n">columns_to_modify</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">],</span>      <span class="c1"># For agricultural commodity prices</span>
    <span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">],</span>      <span class="c1"># For regional CO2 emissions</span>
    <span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">],</span>      <span class="c1"># For sectoral CO2 emissions</span>
    <span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">],</span>      <span class="c1"># For land allocation</span>
    <span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">],</span>      <span class="c1"># For land allocation (original crop names)</span>
    <span class="p">[</span><span class="s1">&#39;vegetation&#39;</span><span class="p">,</span> <span class="s1">&#39;soil&#39;</span><span class="p">]</span>  <span class="c1"># For vegetation and soil scalars</span>
<span class="p">]</span>
</code></pre></div>

<p><strong>Customization:</strong> Each sub-list corresponds to one file in the <code>files</code> list. Users must specify which columns contain numerical data that should be perturbed. Column names must exactly match those in the input files.</p>
<h3>Scenario Labels</h3>
<p><strong>Default Configuration:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="n">scenario_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;scenario&#39;</span><span class="p">,</span> <span class="s1">&#39;scenario&#39;</span><span class="p">,</span> <span class="s1">&#39;scenario&#39;</span><span class="p">,</span> <span class="s1">&#39;scenario&#39;</span><span class="p">,</span> <span class="s1">&#39;scenario&#39;</span><span class="p">,</span> <span class="s1">&#39;scenario&#39;</span><span class="p">]</span>
</code></pre></div>

<p><strong>Customization:</strong> Each element corresponds to one file. The value should be the exact column name that identifies different scenarios in that file (e.g., 'scenario', 'case_name', 'simulation_id').</p>
<h3>Number of Variations</h3>
<p><strong>Default Configuration:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="n">num_variations_for_each_scenario</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
</code></pre></div>

<p><strong>Interpretation:</strong> For each file, this creates 5 total time series (1 original + 4 synthetic variations). The synthetic variations are numbered 2, 3, 4, 5, etc.</p>
<p><strong>Customization:</strong> Users can specify different numbers for each file. For example, <code>[10, 5, 3, 5, 5, 8]</code> would create:<br />
- 10 total variations for file 1 (1 base + 9 synthetic)<br />
- 5 total variations for file 2 (1 base + 4 synthetic)<br />
- 3 total variations for file 3 (1 base + 2 synthetic)<br />
- And so on...</p>
<hr />
<h2>Perturbation Methodology</h2>
<h3>Base Multipliers</h3>
<p>The script generates base multipliers using:</p>
<div class="codehilite"><pre><span></span><code><span class="n">base_multipliers</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">1.02</span><span class="p">,</span> <span class="mf">1.05</span><span class="p">,</span> <span class="n">num_synthetic_sets_in_ensemble</span><span class="p">)</span>
</code></pre></div>

<p><strong>Effect:</strong> Creates systematic variation with multipliers ranging from 1.02 (2% increase) to 1.05 (5% increase), evenly distributed across the number of synthetic sets.</p>
<p><strong>Example:</strong> For 4 synthetic variations:<br />
- Variation 1: base multiplier = 1.02<br />
- Variation 2: base multiplier = 1.03<br />
- Variation 3: base multiplier = 1.04<br />
- Variation 4: base multiplier = 1.05</p>
<h3>Random Perturbations</h3>
<p>Additional random variation is added:</p>
<div class="codehilite"><pre><span></span><code><span class="n">random_multipliers</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">low</span><span class="o">=-</span><span class="mf">0.02</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">df_this_scenario</span><span class="p">))</span>
</code></pre></div>

<p><strong>Effect:</strong> Adds ±2% random variation to each data point, creating realistic noise and variability within each synthetic time series.</p>
<h3>Combined Effect</h3>
<p>Final multiplier for each data point:</p>
<div class="codehilite"><pre><span></span><code>final_multiplier = base_multiplier + random_perturbation
</code></pre></div>

<p><strong>Range:</strong> Approximately 1.00 to 1.07 (with variation between -2% and +7% relative to original values)</p>
<hr />
<h2>Usage Instructions</h2>
<h3>Running the Script</h3>
<p>Since this script is designed for testing purposes and does not use JSON configuration files, users must modify the script directly to customize behavior.</p>
<p><strong>Command Line Execution:</strong></p>
<div class="codehilite"><pre><span></span><code>python<span class="w"> </span>gcam_produce_synthetic_data.py
</code></pre></div>

<p><strong>Note:</strong> Unlike other scripts in the repository, this does not accept JSON file arguments.</p>
<h3>Modifying Input Files</h3>
<p>To process different files, edit the <code>files</code> list in the main execution block:</p>
<div class="codehilite"><pre><span></span><code><span class="n">files</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;path/to/your/file1.csv&quot;</span><span class="p">,</span>
    <span class="s2">&quot;path/to/your/file2.dat&quot;</span><span class="p">,</span>
    <span class="c1"># Add more files as needed</span>
<span class="p">]</span>
</code></pre></div>

<h3>Adjusting Perturbation Parameters</h3>
<p>To modify the perturbation behavior, users can edit the function directly:</p>
<p><strong>Change base multiplier range:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Original:</span>
<span class="n">base_multipliers</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">1.02</span><span class="p">,</span> <span class="mf">1.05</span><span class="p">,</span> <span class="n">num_synthetic_sets_in_ensemble</span><span class="p">)</span>

<span class="c1"># Example modification (1% to 3% increase):</span>
<span class="n">base_multipliers</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">1.01</span><span class="p">,</span> <span class="mf">1.03</span><span class="p">,</span> <span class="n">num_synthetic_sets_in_ensemble</span><span class="p">)</span>
</code></pre></div>

<p><strong>Change random perturbation range:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Original:</span>
<span class="n">random_multipliers</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">low</span><span class="o">=-</span><span class="mf">0.02</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">df_this_scenario</span><span class="p">))</span>

<span class="c1"># Example modification (±5% random variation):</span>
<span class="n">random_multipliers</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">low</span><span class="o">=-</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">df_this_scenario</span><span class="p">))</span>
</code></pre></div>

<h3>Adjusting Number of Variations</h3>
<p>Modify the <code>num_variations_for_each_scenario</code> list:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Original (5 variations for each file):</span>
<span class="n">num_variations_for_each_scenario</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span>

<span class="c1"># Custom (different numbers for each file):</span>
<span class="n">num_variations_for_each_scenario</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>

<span class="c1"># Same number for all files:</span>
<span class="n">num_variations_for_each_scenario</span> <span class="o">=</span> <span class="p">[</span><span class="mi">15</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2>Output Files</h2>
<h3>Output Format</h3>
<p>The script preserves the input file format:<br />
- <strong>CSV input</strong> → CSV output with comma separation<br />
- <strong>DAT input</strong> → Fixed-width format output<br />
- <strong>Other formats</strong> → Fixed-width format output</p>
<h3>Output Structure</h3>
<p>Each output file contains:<br />
1. <strong>Original data:</strong> All rows from the base time series<br />
2. <strong>Synthetic variations:</strong> New rows for each synthetic scenario</p>
<p><strong>Example scenario naming:</strong><br />
- Original scenario: <code>control</code><br />
- Synthetic variations: <code>control_2</code>, <code>control_3</code>, <code>control_4</code>, <code>control_5</code></p>
<h3>File Size Considerations</h3>
<p>Output files will be approximately N times larger than input files, where N is the number of variations specified in <code>num_variations_for_each_scenario</code>.</p>
<p><strong>Example:</strong> If the input file has 1,000 rows and 5 variations are requested, the output will have approximately 5,000 rows (1,000 original + 4,000 synthetic).</p>
<hr />
<h2>Performance Considerations</h2>
<h3>Multiprocessing</h3>
<p>The script uses all available CPU cores by default:</p>
<div class="codehilite"><pre><span></span><code><span class="k">with</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span><span class="n">processes</span><span class="o">=</span><span class="n">multiprocessing</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">())</span> <span class="k">as</span> <span class="n">pool</span><span class="p">:</span>
    <span class="n">pool</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">produce_synthetic_time_series</span><span class="p">,</span> <span class="n">inputs</span><span class="p">)</span>
</code></pre></div>

<p><strong>Advantages:</strong><br />
- Processes multiple files simultaneously<br />
- Significantly reduces execution time for large ensembles<br />
- Scales well with available hardware</p>
<p><strong>Timing Information:</strong><br />
The script prints execution time for each file and total execution time:</p>
<div class="codehilite"><pre><span></span><code><span class="nv">Elapsed</span><span class="w"> </span><span class="nv">time</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">producing</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">synthetic</span><span class="w"> </span><span class="nv">data</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">file1</span>.<span class="nv">csv</span>:<span class="w"> </span><span class="mi">12</span>.<span class="mi">45</span><span class="w"> </span><span class="nv">seconds</span>
<span class="nv">Elapsed</span><span class="w"> </span><span class="nv">time</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">producing</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">synthetic</span><span class="w"> </span><span class="nv">data</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">file2</span>.<span class="nv">csv</span>:<span class="w"> </span><span class="mi">8</span>.<span class="mi">32</span><span class="w"> </span><span class="nv">seconds</span>
...
<span class="nv">Elapsed</span><span class="w"> </span><span class="nv">time</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">producing</span><span class="w"> </span><span class="nv">all</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">synthetic</span><span class="w"> </span><span class="nv">data</span>:<span class="w"> </span><span class="mi">45</span>.<span class="mi">67</span><span class="w"> </span><span class="nv">seconds</span>
</code></pre></div>

<h3>Memory Requirements</h3>
<p>Memory usage depends on:<br />
- Size of input files<br />
- Number of scenarios per file<br />
- Number of variations requested</p>
<p><strong>Estimation:</strong> Peak memory ≈ (file size) × (num_variations) × (number of simultaneous processes)</p>
<hr />
<h2>Dependencies</h2>
<h3>Required Python Modules</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">multiprocessing</span>  <span class="c1"># Standard library</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>      <span class="c1"># Install: pip install numpy</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>     <span class="c1"># Install: pip install pandas</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>            <span class="c1"># Standard library</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">utility_dataframes</span><span class="w"> </span><span class="kn">import</span> <span class="n">read_file_into_dataframe</span><span class="p">,</span> <span class="n">write_dataframe_to_fwf</span>  <span class="c1"># Custom module</span>
</code></pre></div>

<h3>Custom Utility Functions</h3>
<p>The script requires two custom functions from <code>utility_dataframes.py</code>:</p>
<ol>
<li>
<p><strong><code>read_file_into_dataframe(file)</code></strong><br />
   - Reads CSV or fixed-width format files into pandas DataFrame<br />
   - Automatically detects file format</p>
</li>
<li>
<p><strong><code>write_dataframe_to_fwf(new_file, df_ensemble)</code></strong><br />
   - Writes DataFrame to fixed-width format file<br />
   - Maintains proper column alignment</p>
</li>
</ol>
<p><strong>Note:</strong> These utility functions must be available in the Python path.</p>
<hr />
<h2>Important Notes and Warnings</h2>
<h3>1. Testing Purpose Only</h3>
<p>This script is designed for <strong>testing and validation purposes only</strong>. It should not be used when actual ensemble simulation data are available, as it creates synthetic data rather than processing real GCAM outputs.</p>
<h3>2. Data Integrity</h3>
<p>The perturbations applied are multiplicative, meaning:<br />
- Relative relationships between data points are partially preserved<br />
- Negative values will become more negative (multiplied by factors &gt;1)<br />
- Zero values remain zero</p>
<h3>3. Scenario Numbering</h3>
<p>Synthetic scenarios start from <code>_2</code> to avoid confusion with the base time series:<br />
- Base scenario: <code>scenario_name</code><br />
- Synthetic variations: <code>scenario_name_2</code>, <code>scenario_name_3</code>, etc.</p>
<h3>4. No JSON Configuration</h3>
<p>Unlike most other scripts in the repository, this script <strong>does not use JSON configuration files</strong>. All modifications must be made directly in the Python script.</p>
<h3>5. File Overwriting</h3>
<p>The script creates new files with <code>_ensemble</code> suffix. Original files are not modified. However, if ensemble files already exist, they will be overwritten without warning.</p>
<h3>6. Random Seed</h3>
<p>The script does not set a random seed, meaning each execution will produce different random perturbations. For reproducible results, add at the beginning of the script:</p>
<div class="codehilite"><pre><span></span><code><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>  <span class="c1"># Or any integer</span>
</code></pre></div>

<hr />
<h2>Example Workflow</h2>
<h3>Typical Usage Scenario</h3>
<ol>
<li><strong>Prepare base time series files</strong> from GCAM extraction and processing scripts</li>
<li><strong>Edit the script</strong> to specify desired files and parameters</li>
<li><strong>Run the script</strong> to generate synthetic ensemble</li>
<li><strong>Use ensemble files</strong> for testing plotting and analysis scripts</li>
</ol>
<h3>Example Modification</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Customize for 3 files with 10 variations each</span>
<span class="n">files</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;my_emissions_data.csv&quot;</span><span class="p">,</span>
    <span class="s2">&quot;my_land_use_data.csv&quot;</span><span class="p">,</span>
    <span class="s2">&quot;my_prices_data.csv&quot;</span>
<span class="p">]</span>

<span class="n">columns_to_modify</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="s1">&#39;emissions&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;area&#39;</span><span class="p">,</span> <span class="s1">&#39;yield&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span>
<span class="p">]</span>

<span class="n">scenario_labels</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;scenario&#39;</span><span class="p">,</span>
    <span class="s1">&#39;case_id&#39;</span><span class="p">,</span>
    <span class="s1">&#39;run_name&#39;</span>
<span class="p">]</span>

<span class="n">num_variations_for_each_scenario</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>
</code></pre></div>

<hr />
<h2>Troubleshooting</h2>
<h3>Common Issues</h3>
<p><strong>Issue:</strong> <code>FileNotFoundError</code><br />
- <strong>Cause:</strong> Incorrect file path<br />
- <strong>Solution:</strong> Verify file paths are correct and files exist</p>
<p><strong>Issue:</strong> <code>KeyError</code> when modifying columns<br />
- <strong>Cause:</strong> Column name doesn't exist in the file<br />
- <strong>Solution:</strong> Check column names match exactly (case-sensitive)</p>
<p><strong>Issue:</strong> Memory error<br />
- <strong>Cause:</strong> Too many variations or files too large<br />
- <strong>Solution:</strong> Reduce number of variations or process fewer files at once</p>
<p><strong>Issue:</strong> Slow execution<br />
- <strong>Cause:</strong> Large files or insufficient CPU cores<br />
- <strong>Solution:</strong> Reduce number of variations or process files sequentially</p>
<hr />
<h2>Related Scripts</h2>
<p>This script is part of the E3SM-GCAM analysis toolkit. Related scripts include:</p>
<ul>
<li><strong><code>gcam_extract_csv_from_project_files.R</code></strong>: Extracts data from GCAM project files</li>
<li><strong><code>gcam_process_extracted_data.py</code></strong>: Processes extracted CSV files</li>
<li><strong><code>gcam_plot_time_series.py</code></strong>: Plots time series from GCAM data</li>
<li><strong><code>e3sm_produce_synthetic_spatial_data.py</code></strong>: E3SM equivalent for spatial data</li>
<li><strong><code>e3sm_produce_synthetic_time_series.py</code></strong>: E3SM equivalent for time series</li>
</ul>
<hr />
<h2>References</h2>
<ul>
<li>DiVittorio et al. (2025). "E3SM-GCAM coupling methodology and applications." <em>Journal of Advances in Modeling Earth Systems</em>. <a href="https://agupubs.onlinelibrary.wiley.com/doi/full/10.1029/2024MS004806">DOI: 10.1029/2024MS004806</a></li>
<li>GitHub Repository: <a href="https://github.com/philipmyint/e3sm--gcam_analysis">https://github.com/philipmyint/e3sm--gcam_analysis</a></li>
</ul>
<hr />
<h2>Contact</h2>
<p>For questions or issues:<br />
- <strong>Philip Myint</strong>: myint1@llnl.gov<br />
- <strong>Dalei Hao</strong>: dalei.hao@pnnl.gov</p>
<hr />
<h2>Version History</h2>
<ul>
<li><strong>Current Version:</strong> As documented in repository (January 2025)</li>
<li><strong>Last Updated:</strong> January 2026</li>
</ul>
<hr />
<p><em>This documentation is intended to help users understand and modify the <code>gcam_produce_synthetic_data.py</code> script for creating synthetic GCAM ensemble datasets for testing purposes.</em></p>
        
        <footer>
            <p>
                Documentation generated for the E3SM-GCAM Analysis Scripts<br>
                <strong>Authors:</strong> Philip Myint (myint1@llnl.gov) and Dalei Hao (dalei.hao@pnnl.gov)<br>
                <strong>Last Updated:</strong> January 2026
            </p>
        </footer>
    </div>
</body>
</html>
